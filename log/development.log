DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (108.8ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (0.6ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (9.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (8.4ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to DeviseTokenAuthCreateUsers (20230819204134)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "provider" character varying DEFAULT 'email' NOT NULL, "uid" character varying DEFAULT '' NOT NULL, "encrypted_password" character varying DEFAULT '' NOT NULL, "reset_password_token" character varying, "reset_password_sent_at" timestamp(6), "allow_password_change" boolean DEFAULT FALSE, "remember_created_at" timestamp(6), "confirmation_token" character varying, "confirmed_at" timestamp(6), "confirmation_sent_at" timestamp(6), "unconfirmed_email" character varying, "name" character varying, "nickname" character varying, "image" character varying, "email" character varying, "tokens" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_uid_and_provider" ON "users" ("uid", "provider")[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_confirmation_token" ON "users" ("confirmation_token")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230819204134"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddRoleToUsers (20230821020342)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "users" ADD "role" integer[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821020342"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePosts (20230821021958)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.5ms)[0m  [1m[35mCREATE TABLE "posts" ("id" bigserial primary key, "title" character varying, "content" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821021958"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateActiveStorageTables (20230821023831)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.6ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key")[0m
  [1m[35m (8.5ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id")[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id")[0m
  [1m[35m (7.7ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821023831"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.2ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (9.1ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateCategories (20230928093441)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.5ms)[0m  [1m[35mCREATE TABLE "categories" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093441"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrders (20230928093450)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.5ms)[0m  [1m[35mCREATE TABLE "orders" ("id" bigserial primary key, "user_id" bigint NOT NULL, "status" character varying, "total_amount" decimal, "shipping_address" text, "payment_details" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_f868b47f6a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX "index_orders_on_user_id" ON "orders" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093450"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.4ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (15.7ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX "index_products_on_category_id" ON "products" ("category_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093423"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.7ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_order_id" ON "order_items" ("order_id")[0m
  [1m[35m (4.1ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_product_id" ON "order_items" ("product_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093507"]]
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCarts (20230928093648)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.2ms)[0m  [1m[35mCREATE TABLE "carts" ("id" bigserial primary key, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_ea59a35211"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE INDEX "index_carts_on_user_id" ON "carts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093648"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAddresses (20230928093657)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.8ms)[0m  [1m[35mCREATE TABLE "addresses" ("id" bigserial primary key, "user_id" bigint NOT NULL, "address_type" character varying, "street" character varying, "city" character varying, "state" character varying, "postal_code" character varying, "country" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_48c9e0c5a2"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE INDEX "index_addresses_on_user_id" ON "addresses" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093657"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateReceipts (20230928094034)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "receipts" ("id" bigserial primary key, "order_id" bigint NOT NULL, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_de8c1572cc"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_b2d4d3fa14"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_order_id" ON "receipts" ("order_id")[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_user_id" ON "receipts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928094034"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "development"], ["created_at", "2023-09-28 10:42:47.188783"], ["updated_at", "2023-09-28 10:42:47.188783"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/categories/1/posts" for 127.0.0.1 at 2023-09-28 15:44:31 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [GET] "/categories/1/posts"):
  
Started GET "/categories/1/posts" for 127.0.0.1 at 2023-09-28 15:44:32 +0300
  
ActionController::RoutingError (No route matches [GET] "/categories/1/posts"):
  
Started GET "/product/new" for 127.0.0.1 at 2023-09-28 15:44:51 +0300
  
ActionController::RoutingError (No route matches [GET] "/product/new"):
  
Started GET "/product/new" for 127.0.0.1 at 2023-09-28 15:45:14 +0300
  
ActionController::RoutingError (No route matches [GET] "/product/new"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/product/new" for 127.0.0.1 at 2023-09-28 15:45:25 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [GET] "/product/new"):
  
Started GET "/product" for 127.0.0.1 at 2023-09-28 15:47:59 +0300
  
ActionController::RoutingError (No route matches [GET] "/product"):
  
Started GET "/products" for 127.0.0.1 at 2023-09-28 15:48:12 +0300
  
ActionController::RoutingError (No route matches [GET] "/products"):
  
Started GET "/create_product" for 127.0.0.1 at 2023-09-28 15:48:41 +0300
  
ActionController::RoutingError (No route matches [GET] "/create_product"):
  
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 15:49:52 +0300
  
ActionController::RoutingError (No route matches [POST] "/create_product"):
  
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 15:50:08 +0300
Processing by ProductsController#create as */*
  Parameters: {"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "color"=>"Blue", "category_id"=>1}
Completed 400 Bad Request in 3ms (ActiveRecord: 0.0ms | Allocations: 2129)


  
ActionController::ParameterMissing (param is missing or the value is empty: product):
  
app/controllers/products_controller.rb:19:in `product_params'
app/controllers/products_controller.rb:5:in `create'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 15:50:17 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "color"=>"Blue", "category_id"=>1}
Completed 400 Bad Request in 2ms (ActiveRecord: 0.0ms | Allocations: 2131)


  
ActionController::ParameterMissing (param is missing or the value is empty: product):
  
app/controllers/products_controller.rb:19:in `product_params'
app/controllers/products_controller.rb:5:in `create'
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 15:52:56 +0300
Processing by ProductsController#create as */*
  Parameters: {"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "color"=>"Blue", "category_id"=>1}
Completed 400 Bad Request in 2ms (ActiveRecord: 0.0ms | Allocations: 1605)


  
ActionController::ParameterMissing (param is missing or the value is empty: product):
  
app/controllers/products_controller.rb:18:in `product_params'
app/controllers/products_controller.rb:5:in `create'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 15:53:03 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "color"=>"Blue", "category_id"=>1}
Completed 400 Bad Request in 3ms (ActiveRecord: 0.0ms | Allocations: 2131)


  
ActionController::ParameterMissing (param is missing or the value is empty: product):
  
app/controllers/products_controller.rb:18:in `product_params'
app/controllers/products_controller.rb:5:in `create'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 15:53:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "color"=>"Blue", "category_id"=>1}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
Completed 500 Internal Server Error in 46ms (ActiveRecord: 7.3ms | Allocations: 30510)


  
ActionView::MissingTemplate (Missing template products/new, application/new with {:locale=>[:en], :formats=>[:html, :text, :js, :css, :ics, :csv, :vcf, :vtt, :png, :jpeg, :gif, :bmp, :tiff, :svg, :mpeg, :mp3, :ogg, :m4a, :webm, :mp4, :otf, :ttf, :woff, :woff2, :xml, :rss, :atom, :yaml, :multipart_form, :url_encoded_form, :json, :pdf, :zip, :gzip], :variants=>[], :handlers=>[:raw, :erb, :html, :builder, :ruby]}.

Searched in:
  * "/home/markpaul/projects/skyva-api/app/views"
  * "/home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/devise_token_auth-1.2.2/app/views"
  * "/home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/devise-4.9.2/app/views"

Did you mean?  devise/confirmations/new
               devise/registrations/new
               devise/sessions/new
               devise/unlocks/new
               devise/passwords/new
               devise/registrations/edit):
  
app/controllers/products_controller.rb:10:in `create'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 15:55:00 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "color"=>"Blue", "category_id"=>1}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mCategory Load (0.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
Completed 500 Internal Server Error in 35ms (ActiveRecord: 7.3ms | Allocations: 30496)


  
ActionView::MissingTemplate (Missing template products/index, application/index with {:locale=>[:en], :formats=>[:html, :text, :js, :css, :ics, :csv, :vcf, :vtt, :png, :jpeg, :gif, :bmp, :tiff, :svg, :mpeg, :mp3, :ogg, :m4a, :webm, :mp4, :otf, :ttf, :woff, :woff2, :xml, :rss, :atom, :yaml, :multipart_form, :url_encoded_form, :json, :pdf, :zip, :gzip], :variants=>[], :handlers=>[:raw, :erb, :html, :builder, :ruby]}.

Searched in:
  * "/home/markpaul/projects/skyva-api/app/views"
  * "/home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/devise_token_auth-1.2.2/app/views"
  * "/home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/devise-4.9.2/app/views"

Did you mean?  layouts/mailer
               layouts/application
               devise/confirmations/new
               devise/registrations/new
               devise_token_auth/omniauth_external_window
               devise/sessions/new):
  
app/controllers/products_controller.rb:13:in `create'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 15:56:11 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "color"=>"Blue", "category_id"=>1}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
Completed 422 Unprocessable Entity in 55ms (Views: 0.2ms | ActiveRecord: 5.6ms | Allocations: 38855)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.5ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Clothing"], ["description", "Ut porro autem rem."], ["created_at", "2023-09-28 13:19:00.548681"], ["updated_at", "2023-09-28 13:19:00.548681"]]
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Baby"], ["description", "Quae expedita delectus architecto."], ["created_at", "2023-09-28 13:19:00.553383"], ["updated_at", "2023-09-28 13:19:00.553383"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Movies"], ["description", "Quis quos impedit itaque."], ["created_at", "2023-09-28 13:19:00.556464"], ["updated_at", "2023-09-28 13:19:00.556464"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Home"], ["description", "At sapiente autem est."], ["created_at", "2023-09-28 13:19:00.559598"], ["updated_at", "2023-09-28 13:19:00.559598"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Grocery"], ["description", "Aperiam et nisi rerum."], ["created_at", "2023-09-28 13:19:00.562562"], ["updated_at", "2023-09-28 13:19:00.562562"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Clothes"], ["description", "Clothing category"], ["created_at", "2023-09-28 13:19:00.565438"], ["updated_at", "2023-09-28 13:19:00.565438"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Shoes"], ["description", "Footwear category"], ["created_at", "2023-09-28 13:19:00.568329"], ["updated_at", "2023-09-28 13:19:00.568329"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.1ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Jewelry"], ["description", "Jewelry category"], ["created_at", "2023-09-28 13:19:00.571154"], ["updated_at", "2023-09-28 13:19:00.571154"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories"[0m
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 16:19:56 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "color"=>"Blue", "category_id"=>1}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["category_id", 1], ["created_at", "2023-09-28 13:19:56.383571"], ["updated_at", "2023-09-28 13:19:56.383571"]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
Completed 201 Created in 34ms (Views: 0.6ms | ActiveRecord: 13.7ms | Allocations: 11506)


Started POST "/create_product" for 127.0.0.1 at 2023-09-28 16:22:54 +0300
Error occurred while parsing request parameters.
Contents:

{
  "product": {
    "name": "New Product",
    "description": "A description of the new product",
    "price": 29.99,
    "size": "Medium",
    "brand":"LV"
    "color": "Blue",
    "category_id": 1
  }
}
Processing by ProductsController#create as */*
Completed 400 Bad Request in 0ms (ActiveRecord: 0.0ms | Allocations: 135)


  
ActionDispatch::Http::Parameters::ParseError (Error occurred while parsing request parameters):
  
app/controllers/products_controller.rb:19:in `product_params'
app/controllers/products_controller.rb:5:in `create'
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 16:23:01 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
[31mUnpermitted parameter: :brand. Context: { controller: ProductsController, action: create, request: #<ActionDispatch::Request:0x00007f83cc011cb8>, params: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "brand"=>"LV", "color"=>"Blue", "category_id"=>1}, "controller"=>"products", "action"=>"create"} }[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mProduct Create (0.3ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["category_id", 1], ["created_at", "2023-09-28 13:23:01.273960"], ["updated_at", "2023-09-28 13:23:01.273960"]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
Completed 201 Created in 14ms (Views: 0.5ms | ActiveRecord: 9.0ms | Allocations: 2952)


Started POST "/create_product" for 127.0.0.1 at 2023-09-28 16:24:36 +0300
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/products_controller.rb:19: syntax error, unexpected ':', expecting ')'
...:size,:brand, :stock_quantity :color, :category_id)
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/products_controller.rb:19: syntax error, unexpected ')', expecting '.' or &. or :: or '['
..._quantity :color, :category_id)
...                              ^
):
  
app/controllers/products_controller.rb:19: syntax error, unexpected ':', expecting ')'
app/controllers/products_controller.rb:19: syntax error, unexpected ')', expecting '.' or &. or :: or '['
app/controllers/products_controller.rb:19: syntax error, unexpected ':', expecting ')'
app/controllers/products_controller.rb:19: syntax error, unexpected ')', expecting '.' or &. or :: or '['
Started POST "/create_product" for 127.0.0.1 at 2023-09-28 16:24:45 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["category_id", 1], ["created_at", "2023-09-28 13:24:45.811032"], ["updated_at", "2023-09-28 13:24:45.811032"]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
Completed 201 Created in 28ms (Views: 0.4ms | ActiveRecord: 14.8ms | Allocations: 9068)


Started POST "/create_product" for 127.0.0.1 at 2023-09-28 16:25:20 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-09-28 13:25:20.973240"], ["updated_at", "2023-09-28 13:25:20.973240"]]
  ↳ app/controllers/products_controller.rb:7:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:7:in `create'
Completed 201 Created in 14ms (Views: 0.4ms | ActiveRecord: 9.4ms | Allocations: 2895)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-09-28 16:26:05 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
Completed 401 Unauthorized in 6ms (Views: 0.2ms | ActiveRecord: 1.5ms | Allocations: 2983)


Started POST "/auth" for 127.0.0.1 at 2023-09-28 16:26:46 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaulmuthuara2@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthuara2@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaulmuthuara2@gmail.com"], ["created_at", "2023-09-28 13:26:47.232574"], ["updated_at", "2023-09-28 13:26:47.232574"]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (8.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  ↳ app/controllers/auth/registrations_controller.rb:9:in `block in create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mUser Update (0.6ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = $1, "role" = $2 WHERE "users"."id" = $3[0m  [["updated_at", "2023-09-28 13:26:47.245066"], ["role", 1], ["id", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Update (0.4ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-09-28 13:26:47.309963"], ["id", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
Completed 200 OK in 332ms (Views: 0.2ms | ActiveRecord: 15.9ms | Allocations: 28934)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 10:42:11 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>123, "quantity"=>2}
Completed 201 Created in 0ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 195)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (8.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
  [1m[36mCategory Load (8.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5017.7ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (8.1ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Clothes"], ["description", "Clothing category"], ["created_at", "2023-10-02 08:15:46.901613"], ["updated_at", "2023-10-02 08:15:46.901613"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Shoes"], ["description", "Footwear category"], ["created_at", "2023-10-02 08:15:46.920843"], ["updated_at", "2023-10-02 08:15:46.920843"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Jewelry"], ["description", "Jewelry category"], ["created_at", "2023-10-02 08:15:46.924147"], ["updated_at", "2023-10-02 08:15:46.924147"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "men"], ["description", "mens clothing"], ["created_at", "2023-10-02 08:15:46.927264"], ["updated_at", "2023-10-02 08:15:46.927264"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "women"], ["description", "women clothing"], ["created_at", "2023-10-02 08:15:46.930359"], ["updated_at", "2023-10-02 08:15:46.930359"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.4ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Clothes"], ["description", "Clothing category"], ["created_at", "2023-10-02 08:20:37.018451"], ["updated_at", "2023-10-02 08:20:37.018451"]]
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.3ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Shoes"], ["description", "Footwear category"], ["created_at", "2023-10-02 08:20:37.029868"], ["updated_at", "2023-10-02 08:20:37.029868"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Jewelry"], ["description", "Jewelry category"], ["created_at", "2023-10-02 08:20:37.033799"], ["updated_at", "2023-10-02 08:20:37.033799"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Men"], ["description", "Men's clothing"], ["created_at", "2023-10-02 08:20:37.036972"], ["updated_at", "2023-10-02 08:20:37.036972"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Women"], ["description", "Women's clothing"], ["created_at", "2023-10-02 08:20:37.040020"], ["updated_at", "2023-10-02 08:20:37.040020"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateBrands (20231002082120)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.2ms)[0m  [1m[35mCREATE TABLE "brands" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002082120"]]
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.3ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Clothes"], ["description", "Clothing category"], ["created_at", "2023-10-02 08:21:48.746845"], ["updated_at", "2023-10-02 08:21:48.746845"]]
  [1m[36mTRANSACTION (8.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Shoes"], ["description", "Footwear category"], ["created_at", "2023-10-02 08:21:48.757915"], ["updated_at", "2023-10-02 08:21:48.757915"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Jewelry"], ["description", "Jewelry category"], ["created_at", "2023-10-02 08:21:48.761072"], ["updated_at", "2023-10-02 08:21:48.761072"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.1ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Men"], ["description", "Men's clothing"], ["created_at", "2023-10-02 08:21:48.763954"], ["updated_at", "2023-10-02 08:21:48.763954"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Women"], ["description", "Women's clothing"], ["created_at", "2023-10-02 08:21:48.766815"], ["updated_at", "2023-10-02 08:21:48.766815"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.5ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Kirlin, Greenfelder and Kreiger"], ["description", "Reiciendis aut iste eos."], ["created_at", "2023-10-02 08:21:49.752101"], ["updated_at", "2023-10-02 08:21:49.752101"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.3ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Mosciski, Harris and Fritsch"], ["description", "Repudiandae ut qui earum."], ["created_at", "2023-10-02 08:21:49.756496"], ["updated_at", "2023-10-02 08:21:49.756496"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.3ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Torphy-Adams"], ["description", "Cum non enim reiciendis."], ["created_at", "2023-10-02 08:21:49.759941"], ["updated_at", "2023-10-02 08:21:49.759941"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.2ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Turcotte-Schiller"], ["description", "Laudantium laboriosam est iusto."], ["created_at", "2023-10-02 08:21:49.763302"], ["updated_at", "2023-10-02 08:21:49.763302"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.2ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Quitzon LLC"], ["description", "Ipsam aut tenetur omnis."], ["created_at", "2023-10-02 08:21:49.766549"], ["updated_at", "2023-10-02 08:21:49.766549"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (25.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (107.2ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (0.3ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (16.6ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (8.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to DeviseTokenAuthCreateUsers (20230819204134)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "provider" character varying DEFAULT 'email' NOT NULL, "uid" character varying DEFAULT '' NOT NULL, "encrypted_password" character varying DEFAULT '' NOT NULL, "reset_password_token" character varying, "reset_password_sent_at" timestamp(6), "allow_password_change" boolean DEFAULT FALSE, "remember_created_at" timestamp(6), "confirmation_token" character varying, "confirmed_at" timestamp(6), "confirmation_sent_at" timestamp(6), "unconfirmed_email" character varying, "name" character varying, "nickname" character varying, "image" character varying, "email" character varying, "tokens" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_uid_and_provider" ON "users" ("uid", "provider")[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_confirmation_token" ON "users" ("confirmation_token")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230819204134"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddRoleToUsers (20230821020342)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "users" ADD "role" integer[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821020342"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePosts (20230821021958)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.6ms)[0m  [1m[35mCREATE TABLE "posts" ("id" bigserial primary key, "title" character varying, "content" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821021958"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateActiveStorageTables (20230821023831)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.3ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key")[0m
  [1m[35m (8.9ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id")[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id")[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (3.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821023831"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (16.4ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateCategories (20230928093441)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (9.6ms)[0m  [1m[35mCREATE TABLE "categories" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093441"]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrders (20230928093450)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.2ms)[0m  [1m[35mCREATE TABLE "orders" ("id" bigserial primary key, "user_id" bigint NOT NULL, "status" character varying, "total_amount" decimal, "shipping_address" text, "payment_details" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_f868b47f6a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE INDEX "index_orders_on_user_id" ON "orders" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093450"]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.6ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX "index_products_on_category_id" ON "products" ("category_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093423"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.8ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_order_id" ON "order_items" ("order_id")[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_product_id" ON "order_items" ("product_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093507"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCarts (20230928093648)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "carts" ("id" bigserial primary key, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_ea59a35211"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX "index_carts_on_user_id" ON "carts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093648"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAddresses (20230928093657)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.0ms)[0m  [1m[35mCREATE TABLE "addresses" ("id" bigserial primary key, "user_id" bigint NOT NULL, "address_type" character varying, "street" character varying, "city" character varying, "state" character varying, "postal_code" character varying, "country" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_48c9e0c5a2"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE INDEX "index_addresses_on_user_id" ON "addresses" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093657"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateReceipts (20230928094034)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE TABLE "receipts" ("id" bigserial primary key, "order_id" bigint NOT NULL, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_de8c1572cc"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_b2d4d3fa14"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_order_id" ON "receipts" ("order_id")[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_user_id" ON "receipts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928094034"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateBrands (20231002082120)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "brands" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002082120"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "development"], ["created_at", "2023-10-02 08:49:05.210492"], ["updated_at", "2023-10-02 08:49:05.210492"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.6ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Clothes"], ["description", "Clothing category"], ["created_at", "2023-10-02 08:49:21.954607"], ["updated_at", "2023-10-02 08:49:21.954607"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.3ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Shoes"], ["description", "Footwear category"], ["created_at", "2023-10-02 08:49:21.959237"], ["updated_at", "2023-10-02 08:49:21.959237"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Jewelry"], ["description", "Jewelry category"], ["created_at", "2023-10-02 08:49:21.962589"], ["updated_at", "2023-10-02 08:49:21.962589"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Men"], ["description", "Men's clothing"], ["created_at", "2023-10-02 08:49:21.965720"], ["updated_at", "2023-10-02 08:49:21.965720"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Women"], ["description", "Women's clothing"], ["created_at", "2023-10-02 08:49:21.969128"], ["updated_at", "2023-10-02 08:49:21.969128"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.5ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Balistreri LLC"], ["description", "Quam nesciunt quidem a."], ["created_at", "2023-10-02 08:49:22.952879"], ["updated_at", "2023-10-02 08:49:22.952879"]]
  [1m[36mTRANSACTION (8.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.5ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Kulas, Hahn and Schimmel"], ["description", "Quam est commodi cumque."], ["created_at", "2023-10-02 08:49:22.964296"], ["updated_at", "2023-10-02 08:49:22.964296"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.4ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Sporer, Waelchi and Weber"], ["description", "Autem pariatur earum itaque."], ["created_at", "2023-10-02 08:49:22.968567"], ["updated_at", "2023-10-02 08:49:22.968567"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.3ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Luettgen-Anderson"], ["description", "Id enim tenetur neque."], ["created_at", "2023-10-02 08:49:22.972648"], ["updated_at", "2023-10-02 08:49:22.972648"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.3ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Lockman LLC"], ["description", "Possimus cupiditate vel nihil."], ["created_at", "2023-10-02 08:49:22.976689"], ["updated_at", "2023-10-02 08:49:22.976689"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mBrand Load (0.2ms)[0m  [1m[34mSELECT "brands".* FROM "brands"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 14:42:56 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>123, "quantity"=>2}
Completed 201 Created in 1ms (Views: 0.5ms | ActiveRecord: 0.0ms | Allocations: 195)


Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:03:04 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>123, "quantity"=>2}
Filter chain halted as :authenticate_user! rendered or redirected
Completed 401 Unauthorized in 1086ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 720948)


Started POST "/auth" for 127.0.0.1 at 2023-10-02 15:09:45 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaulmuthuara2@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthuara2@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaulmuthuara2@gmail.com"], ["created_at", "2023-10-02 12:09:45.361342"], ["updated_at", "2023-10-02 12:09:45.361342"]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (8.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  ↳ app/controllers/auth/registrations_controller.rb:9:in `block in create'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mUser Update (0.8ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = $1, "role" = $2 WHERE "users"."id" = $3[0m  [["updated_at", "2023-10-02 12:09:45.374827"], ["role", 1], ["id", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Update (0.6ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-02 12:09:45.448535"], ["id", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (5.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
Completed 200 OK in 373ms (Views: 0.2ms | ActiveRecord: 29.7ms | Allocations: 36030)


Started POST "/auth" for 127.0.0.1 at 2023-10-02 15:10:01 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaulmuthuara3@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthuara3@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaulmuthuara3@gmail.com"], ["created_at", "2023-10-02 12:10:01.793426"], ["updated_at", "2023-10-02 12:10:01.793426"]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  ↳ app/controllers/auth/registrations_controller.rb:9:in `block in create'
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-02 12:10:01.861658"], ["id", 2]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
Completed 200 OK in 324ms (Views: 0.2ms | ActiveRecord: 5.6ms | Allocations: 6157)


Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:10:27 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>123, "quantity"=>2}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 74ms (ActiveRecord: 0.5ms | Allocations: 5462)


  
NoMethodError (undefined method `cart' for #<User:0x00007f2cb5903920>):
  
app/controllers/carts_controller.rb:11:in `add_to_cart'
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:10:35 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 10ms (ActiveRecord: 0.2ms | Allocations: 5232)


  
NoMethodError (undefined method `cart' for #<User:0x00007f2cb53f3c78>):
  
app/controllers/carts_controller.rb:11:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:10:43 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 94ms (ActiveRecord: 4.4ms | Allocations: 29653)


  
NoMethodError (undefined method `cart' for #<User:0x00007fb9183bf7a8>):
  
app/controllers/carts_controller.rb:11:in `add_to_cart'
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:13:25 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
Completed 500 Internal Server Error in 108ms (ActiveRecord: 5.9ms | Allocations: 29067)


  
NoMethodError (undefined method `add_product' for #<Cart id: nil, user_id: 2, created_at: nil, updated_at: nil>):
  
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:13:40 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
Completed 500 Internal Server Error in 123ms (ActiveRecord: 9.7ms | Allocations: 48191)


  
NoMethodError (undefined method `add_product' for #<Cart id: nil, user_id: 2, created_at: nil, updated_at: nil>):
  
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:17:07 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
Completed 500 Internal Server Error in 115ms (ActiveRecord: 8.1ms | Allocations: 48186)


  
NoMethodError (undefined method `add_product' for #<Cart id: nil, user_id: 2, created_at: nil, updated_at: nil>):
  
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:18:46 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
Completed 500 Internal Server Error in 116ms (ActiveRecord: 5.9ms | Allocations: 48533)


  
NameError (Rails couldn't find a valid model for CartItem association. Please provide the :class_name option on the association declaration. If :class_name is already provided, make sure it's an ActiveRecord::Base subclass.):
  
app/models/cart.rb:8:in `add_product'
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:21:52 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
Completed 500 Internal Server Error in 114ms (ActiveRecord: 7.1ms | Allocations: 48513)


  
NameError (Rails couldn't find a valid model for CartItem association. Please provide the :class_name option on the association declaration. If :class_name is already provided, make sure it's an ActiveRecord::Base subclass.):
  
app/models/cart.rb:9:in `add_product'
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:46:41 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
Completed 500 Internal Server Error in 124ms (ActiveRecord: 6.4ms | Allocations: 48196)


  
NoMethodError (undefined method `add_product' for #<Cart id: nil, user_id: 2, created_at: nil, updated_at: nil>):
  
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:48:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
Completed 404 Not Found in 116ms (ActiveRecord: 9.2ms | Allocations: 51395)


  
ActiveRecord::RecordNotFound (Couldn't find Product with 'id'=1):
  
app/models/cart.rb:15:in `add_product'
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products"[0m
Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:49:47 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
Filter chain halted as :require_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 215)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-02 15:51:34 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
Completed 401 Unauthorized in 1126ms (Views: 0.6ms | ActiveRecord: 0.4ms | Allocations: 722432)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-02 15:51:42 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura1@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura1@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
Completed 401 Unauthorized in 3ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 1014)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-02 15:52:01 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura2@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura2@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
Completed 401 Unauthorized in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 1014)


Started GET "/auth/sign_in" for 127.0.0.1 at 2023-10-02 15:53:20 +0300
Processing by DeviseTokenAuth::SessionsController#new as */*
  Parameters: {"email"=>"markpaulmuthaura2@gmail.com", "password"=>"[FILTERED]"}
Completed 405 Method Not Allowed in 0ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 114)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-02 15:53:25 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura2@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura2@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
Completed 401 Unauthorized in 4ms (Views: 0.3ms | ActiveRecord: 0.4ms | Allocations: 1000)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-02 15:53:31 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura3@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura3@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
Completed 401 Unauthorized in 3ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 1000)


Started POST "/auth" for 127.0.0.1 at 2023-10-02 15:54:10 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaulmuthuara3@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthuara3@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
Completed 422 Unprocessable Entity in 232ms (Views: 0.3ms | ActiveRecord: 1.8ms | Allocations: 3941)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-02 15:54:25 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthuara2@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthuara2@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Update (0.7ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-02 12:54:26.283800"], ["id", 1]]
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 325ms (Views: 0.2ms | ActiveRecord: 10.8ms | Allocations: 7030)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:50 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:50.733425"], ["updated_at", "2023-10-02 12:54:50.733425"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 95ms (Views: 0.4ms | ActiveRecord: 12.1ms | Allocations: 22996)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:57 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:57.131296"], ["updated_at", "2023-10-02 12:54:57.131296"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.5ms | ActiveRecord: 10.4ms | Allocations: 4668)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:58 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:58.653861"], ["updated_at", "2023-10-02 12:54:58.653861"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.4ms | ActiveRecord: 10.5ms | Allocations: 4671)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:58 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:58.865746"], ["updated_at", "2023-10-02 12:54:58.865746"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.4ms | ActiveRecord: 10.1ms | Allocations: 4676)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:59 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:59.027394"], ["updated_at", "2023-10-02 12:54:59.027394"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 13ms (Views: 0.3ms | ActiveRecord: 3.2ms | Allocations: 4664)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:59 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:59.182791"], ["updated_at", "2023-10-02 12:54:59.182791"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 21ms (Views: 0.6ms | ActiveRecord: 10.5ms | Allocations: 4658)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:59 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.1ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:59.349684"], ["updated_at", "2023-10-02 12:54:59.349684"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.4ms | ActiveRecord: 9.8ms | Allocations: 4681)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:59 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:59.487332"], ["updated_at", "2023-10-02 12:54:59.487332"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.4ms | ActiveRecord: 9.9ms | Allocations: 4668)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:59 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:59.638410"], ["updated_at", "2023-10-02 12:54:59.638410"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.4ms | ActiveRecord: 9.8ms | Allocations: 4674)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:59 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:59.791045"], ["updated_at", "2023-10-02 12:54:59.791045"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 12ms (Views: 0.5ms | ActiveRecord: 3.0ms | Allocations: 4666)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:54:59 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:54:59.957028"], ["updated_at", "2023-10-02 12:54:59.957028"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.4ms | ActiveRecord: 10.2ms | Allocations: 4679)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:00 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:00.114091"], ["updated_at", "2023-10-02 12:55:00.114091"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.5ms | ActiveRecord: 10.0ms | Allocations: 4676)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:00 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:00.275649"], ["updated_at", "2023-10-02 12:55:00.275649"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 22ms (Views: 0.5ms | ActiveRecord: 10.2ms | Allocations: 4660)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:00 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:00.447708"], ["updated_at", "2023-10-02 12:55:00.447708"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.4ms | ActiveRecord: 9.9ms | Allocations: 4668)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:00 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:00.602983"], ["updated_at", "2023-10-02 12:55:00.602983"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.5ms | ActiveRecord: 10.2ms | Allocations: 4656)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:00 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:00.767481"], ["updated_at", "2023-10-02 12:55:00.767481"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 13ms (Views: 0.7ms | ActiveRecord: 2.7ms | Allocations: 4668)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:00 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:00.931251"], ["updated_at", "2023-10-02 12:55:00.931251"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.5ms | ActiveRecord: 10.1ms | Allocations: 4670)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:01 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:01.102366"], ["updated_at", "2023-10-02 12:55:01.102366"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.3ms | ActiveRecord: 10.3ms | Allocations: 4664)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:01 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:01.303353"], ["updated_at", "2023-10-02 12:55:01.303353"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.6ms | ActiveRecord: 10.0ms | Allocations: 4665)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:01 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:01.477823"], ["updated_at", "2023-10-02 12:55:01.477823"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 13ms (Views: 0.3ms | ActiveRecord: 2.6ms | Allocations: 4668)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:01 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:01.627958"], ["updated_at", "2023-10-02 12:55:01.627958"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 11ms (Views: 0.4ms | ActiveRecord: 2.5ms | Allocations: 4664)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:01 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:01.795609"], ["updated_at", "2023-10-02 12:55:01.795609"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 11ms (Views: 0.3ms | ActiveRecord: 2.5ms | Allocations: 4662)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:02 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:02.369472"], ["updated_at", "2023-10-02 12:55:02.369472"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 16ms (Views: 0.4ms | ActiveRecord: 3.2ms | Allocations: 4658)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:02 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:02.633818"], ["updated_at", "2023-10-02 12:55:02.633818"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.4ms | ActiveRecord: 10.1ms | Allocations: 4666)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:02 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:02.989601"], ["updated_at", "2023-10-02 12:55:02.989601"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 28ms (Views: 0.4ms | ActiveRecord: 10.1ms | Allocations: 4668)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:03 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:03.590272"], ["updated_at", "2023-10-02 12:55:03.590272"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.5ms | ActiveRecord: 10.0ms | Allocations: 4661)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:04 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.3ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:04.125702"], ["updated_at", "2023-10-02 12:55:04.125702"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.3ms | ActiveRecord: 9.6ms | Allocations: 4678)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:04 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:04.754213"], ["updated_at", "2023-10-02 12:55:04.754213"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.5ms | ActiveRecord: 10.3ms | Allocations: 4672)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:05 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:05.307754"], ["updated_at", "2023-10-02 12:55:05.307754"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.4ms | ActiveRecord: 10.1ms | Allocations: 4673)


Started POST "/create_product" for 127.0.0.1 at 2023-10-02 15:55:05 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-02 12:55:05.931862"], ["updated_at", "2023-10-02 12:55:05.931862"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 23ms (Views: 0.5ms | ActiveRecord: 10.2ms | Allocations: 4660)


Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:55:25 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
Completed 500 Internal Server Error in 9ms (ActiveRecord: 0.8ms | Allocations: 4467)


  
NameError (Rails couldn't find a valid model for CartItem association. Please provide the :class_name option on the association declaration. If :class_name is already provided, make sure it's an ActiveRecord::Base subclass.):
  
app/models/cart.rb:18:in `add_product'
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:56:30 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
Completed 500 Internal Server Error in 125ms (ActiveRecord: 9.4ms | Allocations: 68934)


  
NameError (Rails couldn't find a valid model for CartItem association. Please provide the :class_name option on the association declaration. If :class_name is already provided, make sure it's an ActiveRecord::Base subclass.):
  
app/models/cart.rb:18:in `add_product'
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:57:31 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
Completed 422 Unprocessable Entity in 146ms (ActiveRecord: 12.0ms | Allocations: 72275)


  
ActiveRecord::RecordNotSaved (You cannot call create unless the parent is saved):
  
app/models/cart.rb:25:in `add_product'
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 15:59:06 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
Completed 500 Internal Server Error in 136ms (ActiveRecord: 10.6ms | Allocations: 86352)


  
ActiveModel::UnknownAttributeError (unknown attribute 'cart_id' for OrderItem.):
  
app/models/cart.rb:25:in `add_product'
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:00:14 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
Completed 500 Internal Server Error in 137ms (ActiveRecord: 12.3ms | Allocations: 87517)


  
ActiveModel::UnknownAttributeError (unknown attribute 'cart_id' for OrderItem.):
  
app/models/cart.rb:25:in `add_product'
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:01:20 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
  
AbstractController::ActionNotFound (The action 'add_to_cart' could not be found for CartsController
Did you mean?  add_product):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:01:33 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:16:in `add_product'
Completed 500 Internal Server Error in 137ms (ActiveRecord: 11.3ms | Allocations: 87547)


  
ActiveModel::UnknownAttributeError (unknown attribute 'cart_id' for OrderItem.):
  
app/models/cart.rb:26:in `add_product'
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to AddCartReferenceToOrderItems (20231002130233)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "order_items" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (11.4ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_cart_id" ON "order_items" ("cart_id")[0m
  [1m[35m (1.2ms)[0m  [1m[35mALTER TABLE "order_items" ADD CONSTRAINT "fk_rails_59f7f23852"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002130233"]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:02:56 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:16:in `add_product'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1258ms (Views: 0.2ms | ActiveRecord: 12.0ms | Allocations: 812363)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:06:53 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 92ms (ActiveRecord: 4.4ms | Allocations: 27636)


  
SyntaxError (/home/markpaul/projects/skyva-api/app/models/cart.rb:32: else without rescue is useless
    else
    ^~~~
/home/markpaul/projects/skyva-api/app/models/cart.rb:43: syntax error, unexpected `end', expecting end-of-input):
  
app/models/cart.rb:32: else without rescue is useless
app/models/cart.rb:43: syntax error, unexpected `end', expecting end-of-input
app/models/cart.rb:32: else without rescue is useless
app/models/cart.rb:43: syntax error, unexpected `end', expecting end-of-input
app/controllers/carts_controller.rb:11:in `add_to_cart'
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:07:36 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 74ms (ActiveRecord: 3.4ms | Allocations: 6562)


  
SyntaxError (/home/markpaul/projects/skyva-api/app/models/cart.rb:32: else without rescue is useless
    else
    ^~~~
/home/markpaul/projects/skyva-api/app/models/cart.rb:43: syntax error, unexpected `end', expecting end-of-input):
  
app/models/cart.rb:32: else without rescue is useless
app/models/cart.rb:43: syntax error, unexpected `end', expecting end-of-input
app/models/cart.rb:32: else without rescue is useless
app/models/cart.rb:43: syntax error, unexpected `end', expecting end-of-input
app/controllers/carts_controller.rb:11:in `add_to_cart'
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:07:49 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 77ms (ActiveRecord: 2.6ms | Allocations: 12080)


  
NameError (Rails couldn't find a valid model for Cart association. Please provide the :class_name option on the association declaration. If :class_name is already provided, make sure it's an ActiveRecord::Base subclass.):
  
app/controllers/carts_controller.rb:11:in `add_to_cart'
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:07:59 +0300
  
AbstractController::ActionNotFound (The action 'add_to_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:12:14 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
  
AbstractController::ActionNotFound (The action 'add_to_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:16:13 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 95ms (ActiveRecord: 5.0ms | Allocations: 27076)


Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:17:05 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 79ms (ActiveRecord: 3.7ms | Allocations: 9731)


  
NameError (undefined local variable or method `cart' for #<CartsController:0x00000000010180>):
  
app/controllers/carts_controller.rb:10:in `add_to_cart'
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:17:57 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 76ms (ActiveRecord: 3.6ms | Allocations: 7645)


Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:19:31 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 76ms (ActiveRecord: 3.6ms | Allocations: 7406)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:20:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.6ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `add_to_cart'
  [1m[36mProduct Load (0.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1274ms (Views: 0.3ms | ActiveRecord: 13.5ms | Allocations: 812369)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-02 16:22:25 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `add_to_cart'
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1310ms (Views: 0.4ms | ActiveRecord: 13.4ms | Allocations: 812356)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.7ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-10-03 11:04:13 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (1.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-03 08:04:14.136898"], ["updated_at", "2023-10-03 08:04:14.136898"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 131ms (Views: 0.5ms | ActiveRecord: 15.2ms | Allocations: 54775)


Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 11:04:35 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `add_to_cart'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1236ms (Views: 0.2ms | ActiveRecord: 5.4ms | Allocations: 764359)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 11:04:52 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1359ms (Views: 0.3ms | ActiveRecord: 12.5ms | Allocations: 812376)


Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 11:29:51 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `add_to_cart'
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 107ms (Views: 0.2ms | ActiveRecord: 7.1ms | Allocations: 29081)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-03 12:09:26 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthuara2@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthuara2@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Update (0.9ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-03 09:09:27.419464"], ["id", 1]]
  [1m[36mTRANSACTION (4.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 349ms (Views: 0.2ms | ActiveRecord: 13.7ms | Allocations: 33053)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 12:09:57 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.7ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `add_to_cart'
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1253ms (Views: 0.2ms | ActiveRecord: 15.4ms | Allocations: 812372)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 12:12:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1206ms (Views: 0.2ms | ActiveRecord: 9.7ms | Allocations: 812374)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 12:14:06 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:15:in `add_product'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1189ms (Views: 0.3ms | ActiveRecord: 10.3ms | Allocations: 812363)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 12:15:50 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
  
AbstractController::ActionNotFound (The action 'add_to_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 12:16:28 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `add_to_cart'
Completed 500 Internal Server Error in 104ms (ActiveRecord: 5.0ms | Allocations: 47773)


  
NoMethodError (undefined method `add_product' for #<Cart id: nil, user_id: 2, created_at: nil, updated_at: nil>):
  
app/controllers/carts_controller.rb:12:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 12:17:04 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 97ms (ActiveRecord: 4.4ms | Allocations: 27078)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-03 12:39:17 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 89ms (ActiveRecord: 6.1ms | Allocations: 27084)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/cart" for 127.0.0.1 at 2023-10-04 10:50:52 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [GET] "/cart"):
  
Started GET "/cart" for 127.0.0.1 at 2023-10-04 10:51:43 +0300
  
ActionController::RoutingError (No route matches [GET] "/cart"):
  
Started GET "/cart" for 127.0.0.1 at 2023-10-04 10:52:19 +0300
  
ActionController::RoutingError (No route matches [GET] "/cart"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/cart" for 127.0.0.1 at 2023-10-04 10:52:27 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [GET] "/cart"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/cart" for 127.0.0.1 at 2023-10-04 10:54:45 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [GET] "/cart"):
  
Started GET "/carts/1/get_cart" for 127.0.0.1 at 2023-10-04 10:55:21 +0300
  
AbstractController::ActionNotFound (The action 'get_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:27:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/carts/1/get_cart" for 127.0.0.1 at 2023-10-04 10:55:28 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
AbstractController::ActionNotFound (The action 'get_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:27:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/carts/1/get_cart" for 127.0.0.1 at 2023-10-04 10:57:09 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Processing by CartsController#get_cart as */*
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#get_cart, rendering head :no_content
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 204 No Content in 101ms (ActiveRecord: 13.4ms | Allocations: 27098)


Started GET "/carts/8/get_cart" for 127.0.0.1 at 2023-10-04 10:57:29 +0300
Processing by CartsController#get_cart as */*
  Parameters: {"id"=>"8"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#get_cart, rendering head :no_content
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 204 No Content in 4ms (ActiveRecord: 0.7ms | Allocations: 2182)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/carts/1/get_cart" for 127.0.0.1 at 2023-10-04 10:58:49 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Processing by CartsController#get_cart as */*
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 104ms (ActiveRecord: 4.6ms | Allocations: 28400)


  
NameError (undefined local variable or method `retrieve_cart_contents' for #<CartsController:0x0000000000a5c8>):
  
app/controllers/carts_controller.rb:9:in `get_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/carts/1/get_cart" for 127.0.0.1 at 2023-10-04 11:00:53 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Processing by CartsController#get_cart as */*
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 96ms (ActiveRecord: 5.1ms | Allocations: 25605)


  
SyntaxError (/home/markpaul/projects/skyva-api/app/models/cart.rb:33: syntax error, unexpected end-of-input):
  
app/models/cart.rb:33: syntax error, unexpected end-of-input
app/models/cart.rb:33: syntax error, unexpected end-of-input
app/controllers/carts_controller.rb:9:in `get_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from block (3 levels) in <class:Railtie> at /home/markpaul/.rbenv/versions/2.7.6/lib/ruby/gems/2.7.0/gems/actionpack-7.0.7/lib/action_controller/railtie.rb:80)
Started GET "/carts/1/get_cart" for 127.0.0.1 at 2023-10-04 11:01:48 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Processing by CartsController#get_cart as */*
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara2@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:9:in `get_cart'
Completed 404 Not Found in 102ms (ActiveRecord: 5.9ms | Allocations: 29517)


  
ActiveRecord::RecordNotFound (Couldn't find Cart with 'id'=1):
  
app/controllers/carts_controller.rb:9:in `get_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-04 11:28:12 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [POST] "/add_to_cart"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-04 11:29:04 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [POST] "/add_to_cart"):
  
Started POST "/carts/add_to_cart" for 127.0.0.1 at 2023-10-04 11:29:15 +0300
  
ActionController::RoutingError (No route matches [POST] "/carts/add_to_cart"):
  
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-04 11:29:23 +0300
  
ActionController::RoutingError (No route matches [POST] "/add_to_cart"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-04 11:29:33 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [POST] "/add_to_cart"):
  
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-04 11:30:16 +0300
  
ActionController::RoutingError (No route matches [POST] "/add_to_cart"):
  
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-04 11:48:17 +0300
  
ActionController::RoutingError (No route matches [POST] "/add_to_cart"):
  
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-04 11:49:13 +0300
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 104ms (ActiveRecord: 9.5ms | Allocations: 30025)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-05 10:03:16 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 144ms (ActiveRecord: 10.1ms | Allocations: 27074)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (8.1ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
Started POST "/carts/add_to_cart" for 127.0.0.1 at 2023-10-05 10:05:03 +0300
  
ActionController::RoutingError (No route matches [POST] "/carts/add_to_cart"):
  
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-05 10:05:12 +0300
  
ActionController::RoutingError (No route matches [POST] "/add_to_cart"):
  
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-05 10:05:34 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 8ms (ActiveRecord: 1.0ms | Allocations: 2401)


Started POST "/carts/90/add_to_cart" for 127.0.0.1 at 2023-10-05 10:05:40 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"90"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 7ms (ActiveRecord: 0.9ms | Allocations: 2162)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/90/add_to_cart" for 127.0.0.1 at 2023-10-05 10:15:02 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"90"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 131ms (ActiveRecord: 6.9ms | Allocations: 27079)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/90/add_to_cart" for 127.0.0.1 at 2023-10-05 10:19:32 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"90"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 128ms (ActiveRecord: 5.6ms | Allocations: 25480)


  
ArgumentError (wrong number of arguments (given 0, expected 3)):
  
app/controllers/carts_controller.rb:4:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/90/add_to_cart" for 127.0.0.1 at 2023-10-05 10:21:59 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"90"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (1.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
Completed 500 Internal Server Error in 160ms (ActiveRecord: 11.2ms | Allocations: 47439)


  
NoMethodError (undefined method `cart' for nil:NilClass):
  
app/controllers/carts_controller.rb:14:in `add_to_cart'
Started POST "/carts/90/add_to_cart" for 127.0.0.1 at 2023-10-05 10:23:09 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"90"}
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
Completed 500 Internal Server Error in 25ms (ActiveRecord: 6.4ms | Allocations: 7841)


  
NoMethodError (undefined method `cart' for nil:NilClass):
  
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/90/add_to_cart" for 127.0.0.1 at 2023-10-05 10:24:26 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"90"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:11:in `add_to_cart'
Completed 500 Internal Server Error in 155ms (ActiveRecord: 10.7ms | Allocations: 47437)


  
NoMethodError (undefined method `cart' for nil:NilClass):
  
app/controllers/carts_controller.rb:14:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/90/add_to_cart" for 127.0.0.1 at 2023-10-05 10:25:23 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"90"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara3@gmail.com"], ["LIMIT", 1]]
Current User: nil
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
Completed 500 Internal Server Error in 169ms (ActiveRecord: 12.4ms | Allocations: 47447)


  
NoMethodError (undefined method `cart' for nil:NilClass):
  
app/controllers/carts_controller.rb:15:in `add_to_cart'
Started POST "/auth" for 127.0.0.1 at 2023-10-05 10:26:27 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaulmuthuara3@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthuara3@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
Completed 422 Unprocessable Entity in 2511ms (Views: 0.7ms | ActiveRecord: 10.6ms | Allocations: 724516)


Started POST "/auth" for 127.0.0.1 at 2023-10-05 11:14:51 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaulmuthuara5@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthuara5@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Create (1.6ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaulmuthuara5@gmail.com"], ["created_at", "2023-10-05 08:14:51.875669"], ["updated_at", "2023-10-05 08:14:51.875669"]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Count (0.9ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  ↳ app/controllers/auth/registrations_controller.rb:9:in `block in create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Update (0.8ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-05 08:14:51.979412"], ["id", 3]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
Completed 200 OK in 501ms (Views: 0.3ms | ActiveRecord: 15.3ms | Allocations: 9574)


Started POST "/carts/90/add_to_cart" for 127.0.0.1 at 2023-10-05 11:15:17 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"90"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
Current User: nil
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
Completed 500 Internal Server Error in 101ms (ActiveRecord: 0.8ms | Allocations: 2150)


  
NoMethodError (undefined method `cart' for nil:NilClass):
  
app/controllers/carts_controller.rb:15:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-05 11:31:49 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
Current User: nil
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
Completed 500 Internal Server Error in 156ms (ActiveRecord: 10.6ms | Allocations: 47447)


  
NoMethodError (undefined method `cart' for nil:NilClass):
  
app/controllers/carts_controller.rb:15:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 09:46:30 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (1.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
Current User: nil
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
Completed 500 Internal Server Error in 119ms (ActiveRecord: 9.9ms | Allocations: 47451)


  
NoMethodError (undefined method `cart' for nil:NilClass):
  
app/controllers/carts_controller.rb:15:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 10:01:43 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 3, provider: "email", uid: "markpaulmuthuara5@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaulmuthuara5@gmail.com", created_at: "2023-10-05 08:14:51.875669000 +0000", updated_at: "2023-10-05 08:14:51.979412000 +0000", role: nil>
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:43:in `add_to_cart'
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Create (1.2ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 3], ["created_at", "2023-10-09 07:01:44.192733"], ["updated_at", "2023-10-09 07:01:44.192733"]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mOrderItem Load (0.8ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:58:in `add_to_cart'
Completed 500 Internal Server Error in 170ms (ActiveRecord: 16.9ms | Allocations: 95459)


  
NameError (undefined local variable or method `root_path' for #<CartsController:0x0000000000a780>
Did you mean?  cart_path):
  
app/controllers/carts_controller.rb:75:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 10:03:43 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 3, provider: "email", uid: "markpaulmuthuara5@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaulmuthuara5@gmail.com", created_at: "2023-10-05 08:14:51.875669000 +0000", updated_at: "2023-10-05 08:14:51.979412000 +0000", role: nil>
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:43:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:58:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 204 No Content in 155ms (ActiveRecord: 11.5ms | Allocations: 92212)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.7ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 10:22:31 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 3, provider: "email", uid: "markpaulmuthuara5@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaulmuthuara5@gmail.com", created_at: "2023-10-05 08:14:51.875669000 +0000", updated_at: "2023-10-05 08:14:51.979412000 +0000", role: nil>
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:43:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:59:in `add_to_cart'
Product added to cart: #<OrderItem id: nil, order_id: nil, product_id: 1, quantity: 2, price: nil, created_at: nil, updated_at: nil, cart_id: 1>
Error saving cart or order item.
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 204 No Content in 142ms (ActiveRecord: 7.4ms | Allocations: 29650)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_quantity" for 127.0.0.1 at 2023-10-09 10:35:00 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [POST] "/carts/1/add_quantity"):
  
Started POST "/carts/1/add_quantity" for 127.0.0.1 at 2023-10-09 10:36:09 +0300
  
ActionController::RoutingError (No route matches [POST] "/carts/1/add_quantity"):
  
Started PATCH "/carts/1/add_quantity" for 127.0.0.1 at 2023-10-09 10:38:04 +0300
  
ActionController::RoutingError (No route matches [PATCH] "/carts/1/add_quantity"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity" for 127.0.0.1 at 2023-10-09 10:38:32 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [PATCH] "/carts/1/add_quantity"):
  
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 10:45:04 +0300
  
ArgumentError (can't use member outside resource(s) scope):
  
config/routes.rb:17:in `block (3 levels) in <top (required)>'
config/routes.rb:12:in `block (2 levels) in <top (required)>'
config/routes.rb:11:in `block in <top (required)>'
config/routes.rb:3:in `<top (required)>'
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 10:45:47 +0300
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>1, "id"=>"1", "product_id"=>"1"}
Filter chain halted as :authenticate_user! rendered or redirected
Completed 401 Unauthorized in 1174ms (Views: 0.3ms | ActiveRecord: 0.0ms | Allocations: 726279)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 10:52:56 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>1, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:74:in `add_quantity'
Completed 500 Internal Server Error in 147ms (ActiveRecord: 7.8ms | Allocations: 47738)


  
NoMethodError (undefined method `cart_items' for #<Cart:0x00007f560c7e2660>):
  
app/controllers/carts_controller.rb:74:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 10:57:06 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>1, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:74:in `add_quantity'
Completed 500 Internal Server Error in 108ms (ActiveRecord: 6.7ms | Allocations: 49089)


  
NameError (Rails couldn't find a valid model for CartItem association. Please provide the :class_name option on the association declaration. If :class_name is already provided, make sure it's an ActiveRecord::Base subclass.):
  
app/controllers/carts_controller.rb:74:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 11:17:58 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>1, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.6ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:74:in `add_quantity'
Completed 500 Internal Server Error in 107ms (ActiveRecord: 8.5ms | Allocations: 49037)


  
NameError (Rails couldn't find a valid model for CartItem association. Please provide the :class_name option on the association declaration. If :class_name is already provided, make sure it's an ActiveRecord::Base subclass.):
  
app/controllers/carts_controller.rb:74:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 11:20:36 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>1, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:74:in `add_quantity'
Completed 500 Internal Server Error in 106ms (ActiveRecord: 5.7ms | Allocations: 49028)


  
NameError (Rails couldn't find a valid model for CartItem association. Please provide the :class_name option on the association declaration. If :class_name is already provided, make sure it's an ActiveRecord::Base subclass.):
  
app/controllers/carts_controller.rb:74:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 22:54:37 +0300
  
ActiveRecord::NoDatabaseError (We could not find your database: skyva_api. Which can be found in the database configuration file located at config/database.yml.

To resolve this issue:

- Did you create the database for this app, or delete it? You may need to create your database.
- Has the database name changed? Check your database.yml config has the correct database name.

To create your database, run:

        bin/rails db:create
):
  
activerecord (7.0.7) lib/active_record/connection_adapters/postgresql_adapter.rb:81:in `rescue in new_client'
activerecord (7.0.7) lib/active_record/connection_adapters/postgresql_adapter.rb:77:in `new_client'
activerecord (7.0.7) lib/active_record/connection_adapters/postgresql_adapter.rb:37:in `postgresql_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:656:in `public_send'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:656:in `new_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:700:in `checkout_new_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:679:in `try_to_checkout_new_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:640:in `acquire_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:341:in `checkout'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:181:in `connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_handler.rb:211:in `retrieve_connection'
activerecord (7.0.7) lib/active_record/connection_handling.rb:313:in `retrieve_connection'
activerecord (7.0.7) lib/active_record/connection_handling.rb:280:in `connection'
activerecord (7.0.7) lib/active_record/migration.rb:613:in `connection'
activerecord (7.0.7) lib/active_record/migration.rb:608:in `build_watcher'
activerecord (7.0.7) lib/active_record/migration.rb:590:in `block in call'
activerecord (7.0.7) lib/active_record/migration.rb:589:in `synchronize'
activerecord (7.0.7) lib/active_record/migration.rb:589:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 22:55:28 +0300
  
ActiveRecord::NoDatabaseError (We could not find your database: skyva_api. Which can be found in the database configuration file located at config/database.yml.

To resolve this issue:

- Did you create the database for this app, or delete it? You may need to create your database.
- Has the database name changed? Check your database.yml config has the correct database name.

To create your database, run:

        bin/rails db:create
):
  
activerecord (7.0.7) lib/active_record/connection_adapters/postgresql_adapter.rb:81:in `rescue in new_client'
activerecord (7.0.7) lib/active_record/connection_adapters/postgresql_adapter.rb:77:in `new_client'
activerecord (7.0.7) lib/active_record/connection_adapters/postgresql_adapter.rb:37:in `postgresql_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:656:in `public_send'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:656:in `new_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:700:in `checkout_new_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:679:in `try_to_checkout_new_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:640:in `acquire_connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:341:in `checkout'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_pool.rb:181:in `connection'
activerecord (7.0.7) lib/active_record/connection_adapters/abstract/connection_handler.rb:211:in `retrieve_connection'
activerecord (7.0.7) lib/active_record/connection_handling.rb:313:in `retrieve_connection'
activerecord (7.0.7) lib/active_record/connection_handling.rb:280:in `connection'
activerecord (7.0.7) lib/active_record/migration.rb:613:in `connection'
activerecord (7.0.7) lib/active_record/migration.rb:608:in `build_watcher'
activerecord (7.0.7) lib/active_record/migration.rb:590:in `block in call'
activerecord (7.0.7) lib/active_record/migration.rb:589:in `synchronize'
activerecord (7.0.7) lib/active_record/migration.rb:589:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (814.5ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (0.4ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (108.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (104.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to DeviseTokenAuthCreateUsers (20230819204134)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (83.2ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "provider" character varying DEFAULT 'email' NOT NULL, "uid" character varying DEFAULT '' NOT NULL, "encrypted_password" character varying DEFAULT '' NOT NULL, "reset_password_token" character varying, "reset_password_sent_at" timestamp(6), "allow_password_change" boolean DEFAULT FALSE, "remember_created_at" timestamp(6), "confirmation_token" character varying, "confirmed_at" timestamp(6), "confirmation_sent_at" timestamp(6), "unconfirmed_email" character varying, "name" character varying, "nickname" character varying, "image" character varying, "email" character varying, "tokens" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (39.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (39.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_uid_and_provider" ON "users" ("uid", "provider")[0m
  [1m[35m (40.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (40.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_confirmation_token" ON "users" ("confirmation_token")[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.0ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230819204134"]]
  [1m[36mTRANSACTION (18.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddRoleToUsers (20230821020342)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "users" ADD "role" integer[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821020342"]]
  [1m[36mTRANSACTION (7.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePosts (20230821021958)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (82.9ms)[0m  [1m[35mCREATE TABLE "posts" ("id" bigserial primary key, "title" character varying, "content" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821021958"]]
  [1m[36mTRANSACTION (13.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateActiveStorageTables (20230821023831)
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (73.0ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL)[0m
  [1m[35m (33.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key")[0m
  [1m[35m (66.4ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (29.7ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id")[0m
  [1m[35m (31.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id")[0m
  [1m[35m (82.6ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (39.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821023831"]]
  [1m[36mTRANSACTION (20.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (95.0ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (68.0ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateCategories (20230928093441)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (97.5ms)[0m  [1m[35mCREATE TABLE "categories" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093441"]]
  [1m[36mTRANSACTION (15.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrders (20230928093450)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (87.0ms)[0m  [1m[35mCREATE TABLE "orders" ("id" bigserial primary key, "user_id" bigint NOT NULL, "status" character varying, "total_amount" decimal, "shipping_address" text, "payment_details" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_f868b47f6a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (46.5ms)[0m  [1m[35mCREATE INDEX "index_orders_on_user_id" ON "orders" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093450"]]
  [1m[36mTRANSACTION (16.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (67.7ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (85.3ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[35m (39.1ms)[0m  [1m[35mCREATE INDEX "index_products_on_category_id" ON "products" ("category_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093423"]]
  [1m[36mTRANSACTION (16.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (93.1ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[35m (39.2ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_order_id" ON "order_items" ("order_id")[0m
  [1m[35m (40.5ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_product_id" ON "order_items" ("product_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093507"]]
  [1m[36mTRANSACTION (17.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCarts (20230928093648)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (32.0ms)[0m  [1m[35mCREATE TABLE "carts" ("id" bigserial primary key, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_ea59a35211"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (40.1ms)[0m  [1m[35mCREATE INDEX "index_carts_on_user_id" ON "carts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093648"]]
  [1m[36mTRANSACTION (18.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAddresses (20230928093657)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (83.0ms)[0m  [1m[35mCREATE TABLE "addresses" ("id" bigserial primary key, "user_id" bigint NOT NULL, "address_type" character varying, "street" character varying, "city" character varying, "state" character varying, "postal_code" character varying, "country" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_48c9e0c5a2"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (39.8ms)[0m  [1m[35mCREATE INDEX "index_addresses_on_user_id" ON "addresses" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093657"]]
  [1m[36mTRANSACTION (27.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateReceipts (20230928094034)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (37.8ms)[0m  [1m[35mCREATE TABLE "receipts" ("id" bigserial primary key, "order_id" bigint NOT NULL, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_de8c1572cc"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_b2d4d3fa14"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (39.5ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_order_id" ON "receipts" ("order_id")[0m
  [1m[35m (40.2ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_user_id" ON "receipts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928094034"]]
  [1m[36mTRANSACTION (15.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateBrands (20231002082120)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (86.6ms)[0m  [1m[35mCREATE TABLE "brands" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002082120"]]
  [1m[36mTRANSACTION (16.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCartReferenceToOrderItems (20231002130233)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.7ms)[0m  [1m[35mALTER TABLE "order_items" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (39.9ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_cart_id" ON "order_items" ("cart_id")[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "order_items" ADD CONSTRAINT "fk_rails_59f7f23852"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002130233"]]
  [1m[36mTRANSACTION (17.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "development"], ["created_at", "2023-10-09 19:59:10.766520"], ["updated_at", "2023-10-09 19:59:10.766520"]]
  [1m[36mTRANSACTION (14.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.4ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Clothes"], ["description", "Clothing category"], ["created_at", "2023-10-09 20:00:26.467386"], ["updated_at", "2023-10-09 20:00:26.467386"]]
  [1m[36mTRANSACTION (13.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.5ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Shoes"], ["description", "Footwear category"], ["created_at", "2023-10-09 20:00:26.484455"], ["updated_at", "2023-10-09 20:00:26.484455"]]
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.5ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Jewelry"], ["description", "Jewelry category"], ["created_at", "2023-10-09 20:00:26.492708"], ["updated_at", "2023-10-09 20:00:26.492708"]]
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.5ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Men"], ["description", "Men's clothing"], ["created_at", "2023-10-09 20:00:26.501681"], ["updated_at", "2023-10-09 20:00:26.501681"]]
  [1m[36mTRANSACTION (2.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.5ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Women"], ["description", "Women's clothing"], ["created_at", "2023-10-09 20:00:26.509944"], ["updated_at", "2023-10-09 20:00:26.509944"]]
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.4ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Hilpert Group"], ["description", "Quia est fugiat minima."], ["created_at", "2023-10-09 20:00:27.609775"], ["updated_at", "2023-10-09 20:00:27.609775"]]
  [1m[36mTRANSACTION (21.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.3ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Feil and Sons"], ["description", "Soluta neque deleniti sit."], ["created_at", "2023-10-09 20:00:27.634412"], ["updated_at", "2023-10-09 20:00:27.634412"]]
  [1m[36mTRANSACTION (5.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.3ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Cummings Group"], ["description", "Autem sunt necessitatibus voluptatem."], ["created_at", "2023-10-09 20:00:27.642495"], ["updated_at", "2023-10-09 20:00:27.642495"]]
  [1m[36mTRANSACTION (5.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.7ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Rempel LLC"], ["description", "Quisquam debitis ex recusandae."], ["created_at", "2023-10-09 20:00:27.651645"], ["updated_at", "2023-10-09 20:00:27.651645"]]
  [1m[36mTRANSACTION (2.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.3ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Schaefer LLC"], ["description", "Exercitationem non tempora nostrum."], ["created_at", "2023-10-09 20:00:27.659033"], ["updated_at", "2023-10-09 20:00:27.659033"]]
  [1m[36mTRANSACTION (5.4ms)[0m  [1m[35mCOMMIT[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 23:00:45 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
Filter chain halted as :authenticate_user! rendered or redirected
Completed 401 Unauthorized in 969ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 969826)


Started POST "/auth" for 127.0.0.1 at 2023-10-09 23:03:04 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaul@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaul@gmail.com"], ["created_at", "2023-10-09 20:03:04.442925"], ["updated_at", "2023-10-09 20:03:04.442925"]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (11.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  ↳ app/controllers/auth/registrations_controller.rb:9:in `block in create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = $1, "role" = $2 WHERE "users"."id" = $3[0m  [["updated_at", "2023-10-09 20:03:04.459341"], ["role", 1], ["id", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mTRANSACTION (3.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-09 20:03:04.517307"], ["id", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (2.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
Completed 200 OK in 309ms (Views: 0.3ms | ActiveRecord: 25.8ms | Allocations: 23900)


Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 23:03:23 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.6ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:74:in `add_quantity'
Completed 500 Internal Server Error in 117ms (ActiveRecord: 2.3ms | Allocations: 9196)


  
NoMethodError (undefined method `cart_items' for nil:NilClass

    cart_item = current_user.cart.cart_items.find(params[:cart_item_id])
                                 ^^^^^^^^^^^):
  
app/controllers/carts_controller.rb:74:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 23:10:14 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:84:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 404 Not Found in 92ms (Views: 0.2ms | ActiveRecord: 5.7ms | Allocations: 22615)


Started PATCH "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 23:11:11 +0300
  
ActionController::RoutingError (No route matches [PATCH] "/carts/1/add_to_cart"):
  
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 23:11:20 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
Filter chain halted as :authenticate_user! rendered or redirected
Completed 401 Unauthorized in 1032ms (Views: 0.1ms | ActiveRecord: 0.0ms | Allocations: 969514)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 23:11:41 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 1, provider: "email", uid: "markpaul@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul@gmail.com", created_at: "2023-10-09 20:03:04.442925000 +0000", updated_at: "2023-10-09 20:03:04.517307000 +0000", role: "admin">
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
Completed 500 Internal Server Error in 18ms (ActiveRecord: 2.3ms | Allocations: 8282)


  
NameError (undefined local variable or method `root_path' for #<CartsController:0x0000000000a2d0>

      redirect_to root_path # You can customize this redirect as needed
                  ^^^^^^^^^
Did you mean?  cart_path):
  
app/controllers/carts_controller.rb:17:in `add_to_cart'
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 23:12:31 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 1, provider: "email", uid: "markpaul@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul@gmail.com", created_at: "2023-10-09 20:03:04.442925000 +0000", updated_at: "2023-10-09 20:03:04.517307000 +0000", role: "admin">
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 204 No Content in 95ms (ActiveRecord: 5.3ms | Allocations: 12475)


Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 23:12:40 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:84:in `add_quantity'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 404 Not Found in 14ms (Views: 0.3ms | ActiveRecord: 2.3ms | Allocations: 5538)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 23:12:48 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 1, provider: "email", uid: "markpaul@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul@gmail.com", created_at: "2023-10-09 20:03:04.442925000 +0000", updated_at: "2023-10-09 20:03:04.517307000 +0000", role: "admin">
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 204 No Content in 6ms (ActiveRecord: 0.8ms | Allocations: 3144)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 23:12:49 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 1, provider: "email", uid: "markpaul@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul@gmail.com", created_at: "2023-10-09 20:03:04.442925000 +0000", updated_at: "2023-10-09 20:03:04.517307000 +0000", role: "admin">
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 204 No Content in 7ms (ActiveRecord: 1.0ms | Allocations: 3023)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
Started POST "/create_product" for 127.0.0.1 at 2023-10-09 23:17:00 +0300
  
ActionController::RoutingError (No route matches [POST] "/create_product"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-10-09 23:18:55 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [POST] "/create_product"):
  
Started POST "/create_product" for 127.0.0.1 at 2023-10-09 23:20:06 +0300
  
ActionController::RoutingError (No route matches [POST] "/create_product"):
  
Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:41 +0300
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (1.0ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:42.010970"], ["updated_at", "2023-10-09 20:30:42.010970"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (13.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 179ms (Views: 0.6ms | ActiveRecord: 30.1ms | Allocations: 35248)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:47 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:47.387355"], ["updated_at", "2023-10-09 20:30:47.387355"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (12.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 23ms (Views: 0.3ms | ActiveRecord: 14.1ms | Allocations: 5192)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:48 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:48.461521"], ["updated_at", "2023-10-09 20:30:48.461521"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (12.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 28ms (Views: 0.8ms | ActiveRecord: 14.9ms | Allocations: 5073)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:49 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:49.066294"], ["updated_at", "2023-10-09 20:30:49.066294"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (14.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 37ms (Views: 0.4ms | ActiveRecord: 17.1ms | Allocations: 5095)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:49 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:49.346531"], ["updated_at", "2023-10-09 20:30:49.346531"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (17.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 46ms (Views: 0.8ms | ActiveRecord: 20.7ms | Allocations: 5062)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:49 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:49.507244"], ["updated_at", "2023-10-09 20:30:49.507244"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 26ms (Views: 0.7ms | ActiveRecord: 11.3ms | Allocations: 5067)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:49 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:49.707533"], ["updated_at", "2023-10-09 20:30:49.707533"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (16.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 40ms (Views: 0.5ms | ActiveRecord: 19.3ms | Allocations: 5098)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:49 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.3ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:49.817995"], ["updated_at", "2023-10-09 20:30:49.817995"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (15.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 28ms (Views: 0.7ms | ActiveRecord: 16.9ms | Allocations: 5082)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:49 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:49.989281"], ["updated_at", "2023-10-09 20:30:49.989281"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (17.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 33ms (Views: 0.3ms | ActiveRecord: 19.8ms | Allocations: 5079)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:50 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:50.155331"], ["updated_at", "2023-10-09 20:30:50.155331"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (10.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 27ms (Views: 0.5ms | ActiveRecord: 12.6ms | Allocations: 5088)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:50 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:50.341376"], ["updated_at", "2023-10-09 20:30:50.341376"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (7.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 29ms (Views: 0.4ms | ActiveRecord: 10.0ms | Allocations: 5070)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:50 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.7ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (1.0ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:50.488910"], ["updated_at", "2023-10-09 20:30:50.488910"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 34ms (Views: 0.4ms | ActiveRecord: 11.8ms | Allocations: 5082)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:50 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:50.615822"], ["updated_at", "2023-10-09 20:30:50.615822"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (14.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 55ms (Views: 0.9ms | ActiveRecord: 16.6ms | Allocations: 5064)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:50 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:50.808210"], ["updated_at", "2023-10-09 20:30:50.808210"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (12.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 64ms (Views: 0.3ms | ActiveRecord: 14.6ms | Allocations: 5071)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:50 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.8ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:50.989123"], ["updated_at", "2023-10-09 20:30:50.989123"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (15.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 39ms (Views: 0.4ms | ActiveRecord: 18.6ms | Allocations: 5061)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:51 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:51.119763"], ["updated_at", "2023-10-09 20:30:51.119763"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (20.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 33ms (Views: 0.3ms | ActiveRecord: 22.2ms | Allocations: 5082)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:51 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:51.327538"], ["updated_at", "2023-10-09 20:30:51.327538"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (11.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 34ms (Views: 0.4ms | ActiveRecord: 14.7ms | Allocations: 5092)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:51 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (1.3ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:51.482672"], ["updated_at", "2023-10-09 20:30:51.482672"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (14.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 35ms (Views: 0.5ms | ActiveRecord: 17.3ms | Allocations: 5082)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:51 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:51.639623"], ["updated_at", "2023-10-09 20:30:51.639623"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (16.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 33ms (Views: 0.4ms | ActiveRecord: 18.6ms | Allocations: 5073)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:51 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:51.832473"], ["updated_at", "2023-10-09 20:30:51.832473"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (16.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 28ms (Views: 0.3ms | ActiveRecord: 18.0ms | Allocations: 5073)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:51 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:51.988116"], ["updated_at", "2023-10-09 20:30:51.988116"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (17.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 35ms (Views: 0.4ms | ActiveRecord: 20.0ms | Allocations: 5077)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:52 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:52.137700"], ["updated_at", "2023-10-09 20:30:52.137700"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (10.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 27ms (Views: 0.5ms | ActiveRecord: 12.6ms | Allocations: 5085)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:52 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (1.1ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:52.332533"], ["updated_at", "2023-10-09 20:30:52.332533"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (13.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 38ms (Views: 0.6ms | ActiveRecord: 16.2ms | Allocations: 5073)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:52 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.6ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (1.1ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:52.495967"], ["updated_at", "2023-10-09 20:30:52.495967"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 31ms (Views: 0.5ms | ActiveRecord: 12.2ms | Allocations: 5052)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:52 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:52.633880"], ["updated_at", "2023-10-09 20:30:52.633880"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (6.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 16ms (Views: 0.4ms | ActiveRecord: 8.0ms | Allocations: 5079)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:52 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:52.830677"], ["updated_at", "2023-10-09 20:30:52.830677"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (9.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 26ms (Views: 0.4ms | ActiveRecord: 11.1ms | Allocations: 5058)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:52 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:52.965177"], ["updated_at", "2023-10-09 20:30:52.965177"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (16.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 30ms (Views: 0.5ms | ActiveRecord: 17.6ms | Allocations: 5064)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:53 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.4ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (1.0ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:53.162205"], ["updated_at", "2023-10-09 20:30:53.162205"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 29ms (Views: 0.4ms | ActiveRecord: 11.6ms | Allocations: 5070)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:53 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:53.750807"], ["updated_at", "2023-10-09 20:30:53.750807"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (13.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 27ms (Views: 0.4ms | ActiveRecord: 15.3ms | Allocations: 5067)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-09 23:30:55 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>1}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 1], ["created_at", "2023-10-09 20:30:55.455653"], ["updated_at", "2023-10-09 20:30:55.455653"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (10.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 201 Created in 23ms (Views: 0.4ms | ActiveRecord: 12.0ms | Allocations: 5068)


Started POST "/auth" for 127.0.0.1 at 2023-10-09 23:31:23 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul1@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul1@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaul1@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaul1@gmail.com"], ["created_at", "2023-10-09 20:31:24.546947"], ["updated_at", "2023-10-09 20:31:24.546947"]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (8.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  ↳ app/controllers/auth/registrations_controller.rb:9:in `block in create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-09 20:31:24.609509"], ["id", 2]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mTRANSACTION (3.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:7:in `create'
Completed 200 OK in 1300ms (Views: 0.3ms | ActiveRecord: 15.4ms | Allocations: 977710)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-09 23:32:06 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:23:in `add_to_cart'
  [1m[36mCart Create (0.7ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 2], ["created_at", "2023-10-09 20:32:06.805325"], ["updated_at", "2023-10-09 20:32:06.805325"]]
  ↳ app/controllers/carts_controller.rb:23:in `add_to_cart'
  [1m[36mTRANSACTION (20.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:23:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:27:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 134ms (ActiveRecord: 29.2ms | Allocations: 21439)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 23:32:52 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:84:in `add_quantity'
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.5ms | Allocations: 5655)


  
NameError (Rails couldn't find a valid model for CartItem association. Please provide the :class_name option on the association declaration. If :class_name is already provided, make sure it's an ActiveRecord::Base subclass.

          raise NameError, msg
          ^^^^^):
  
app/controllers/carts_controller.rb:91:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 23:42:42 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:84:in `add_quantity'
Completed 404 Not Found in 103ms (ActiveRecord: 9.6ms | Allocations: 26786)


  
ActiveRecord::RecordNotFound (Couldn't find OrderItem without an ID):
  
app/controllers/carts_controller.rb:91:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 23:58:43 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:84:in `add_quantity'
Completed 404 Not Found in 103ms (ActiveRecord: 8.8ms | Allocations: 26791)


  
ActiveRecord::RecordNotFound (Couldn't find OrderItem without an ID):
  
app/controllers/carts_controller.rb:91:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-09 23:59:46 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:113:in `add_quantity'
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:120:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 107ms (Views: 0.3ms | ActiveRecord: 9.8ms | Allocations: 28887)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-10 00:00:57 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:113:in `add_quantity'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:120:in `add_quantity'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 107ms (Views: 0.4ms | ActiveRecord: 11.1ms | Allocations: 28887)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCart Load (0.9ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  [1m[36mOrderItem Load (1.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 00:34:32 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mOrderItem Load (0.7ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:27:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 123ms (ActiveRecord: 13.8ms | Allocations: 31913)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 00:34:41 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:27:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 14ms (ActiveRecord: 2.1ms | Allocations: 5107)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 00:40:51 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.8ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:68:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 132ms (Views: 0.2ms | ActiveRecord: 15.7ms | Allocations: 42801)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 00:44:36 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:68:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 131ms (Views: 0.3ms | ActiveRecord: 12.9ms | Allocations: 42773)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 00:48:44 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1076ms (Views: 0.2ms | ActiveRecord: 14.5ms | Allocations: 1012482)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-10 00:59:30 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:159:in `add_quantity'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:166:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 108ms (Views: 0.3ms | ActiveRecord: 8.5ms | Allocations: 28900)


  [1m[36mCart Load (0.8ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-10 11:09:26 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:159:in `add_quantity'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:166:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 43ms (Views: 0.2ms | ActiveRecord: 9.2ms | Allocations: 7132)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 11:24:09 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:68:in `add_to_cart'
Completed 500 Internal Server Error in 100ms (ActiveRecord: 11.1ms | Allocations: 19910)


  
NoMethodError (undefined method `orders' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:75:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 11:24:20 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:68:in `add_to_cart'
Completed 500 Internal Server Error in 128ms (ActiveRecord: 14.3ms | Allocations: 41422)


  
NoMethodError (undefined method `orders' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:75:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 11:25:49 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:68:in `add_to_cart'
Completed 500 Internal Server Error in 133ms (ActiveRecord: 11.1ms | Allocations: 41768)


  
NoMethodError (undefined method `orders' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:75:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 11:48:00 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:12:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:27:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 130ms (ActiveRecord: 13.3ms | Allocations: 43632)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 11:48:56 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:68:in `add_to_cart'
Completed 500 Internal Server Error in 99ms (ActiveRecord: 9.0ms | Allocations: 25803)


  
NoMethodError (undefined method `orders' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:75:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
  [1m[36mOrder Load (0.7ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 11:54:46 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:68:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1096ms (Views: 0.3ms | ActiveRecord: 13.9ms | Allocations: 1012954)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 11:59:37 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
Completed 500 Internal Server Error in 124ms (ActiveRecord: 9.8ms | Allocations: 37329)


  
NoMethodError (undefined method `orders' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:68:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:05:25 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."user_id" = $1 /* loading for inspect */ LIMIT $2[0m  [["user_id", 2], ["LIMIT", 11]]
Completed 500 Internal Server Error in 125ms (ActiveRecord: 10.5ms | Allocations: 38604)


  [1m[36mCACHE Order Load (0.0ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."user_id" = $1 /* loading for inspect */ LIMIT $2[0m  [["user_id", 2], ["LIMIT", 11]]
  
NoMethodError (private method `open' called for #<ActiveRecord::Associations::CollectionProxy []>):
  
app/controllers/carts_controller.rb:68:in `add_to_cart'
  [1m[36mCACHE Order Load (0.0ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."user_id" = $1 /* loading for inspect */ LIMIT $2[0m  [["user_id", 2], ["LIMIT", 11]]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:06:25 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mOrder Create (0.9ms)[0m  [1m[32mINSERT INTO "orders" ("user_id", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 2], ["status", "open"], ["created_at", "2023-10-10 09:06:25.799657"], ["updated_at", "2023-10-10 09:06:25.799657"]]
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mTRANSACTION (19.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1212ms (Views: 0.3ms | ActiveRecord: 36.4ms | Allocations: 1020559)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:07:48 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mOrder Create (0.4ms)[0m  [1m[32mINSERT INTO "orders" ("user_id", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 2], ["status", "open"], ["created_at", "2023-10-10 09:07:48.096554"], ["updated_at", "2023-10-10 09:07:48.096554"]]
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mTRANSACTION (17.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 47ms (Views: 0.6ms | ActiveRecord: 20.9ms | Allocations: 7840)


Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-10 12:08:03 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mOrder Create (0.5ms)[0m  [1m[32mINSERT INTO "orders" ("user_id", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 2], ["status", "open"], ["created_at", "2023-10-10 09:08:03.656409"], ["updated_at", "2023-10-10 09:08:03.656409"]]
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mTRANSACTION (58.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 79ms (Views: 0.2ms | ActiveRecord: 60.8ms | Allocations: 7730)


Started POST "/carts/add_to_cart" for 127.0.0.1 at 2023-10-10 12:08:09 +0300
  
ActionController::RoutingError (No route matches [POST] "/carts/add_to_cart"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:08:26 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mOrder Create (0.5ms)[0m  [1m[32mINSERT INTO "orders" ("user_id", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 2], ["status", "open"], ["created_at", "2023-10-10 09:08:26.690397"], ["updated_at", "2023-10-10 09:08:26.690397"]]
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mTRANSACTION (12.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:82:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1177ms (Views: 0.2ms | ActiveRecord: 29.0ms | Allocations: 1020570)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:16:29 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
Completed 500 Internal Server Error in 111ms (ActiveRecord: 10.6ms | Allocations: 29651)


  
NoMethodError (undefined method `cart' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:63:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:17:00 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
Completed 500 Internal Server Error in 95ms (ActiveRecord: 6.9ms | Allocations: 29641)


  
NoMethodError (undefined method `cart' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:63:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:19:43 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
Completed 500 Internal Server Error in 95ms (ActiveRecord: 7.8ms | Allocations: 29641)


  
NoMethodError (undefined method `cart' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:63:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:21:21 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
Completed 500 Internal Server Error in 129ms (ActiveRecord: 13.4ms | Allocations: 43633)


  
NoMethodError (undefined method `cart' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:71:in `add_to_cart'
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-10 12:21:46 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
Completed 500 Internal Server Error in 20ms (ActiveRecord: 1.1ms | Allocations: 8662)


  
NoMethodError (undefined method `cart' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:71:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:22:08 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
Completed 500 Internal Server Error in 129ms (ActiveRecord: 14.5ms | Allocations: 43632)


  
NoMethodError (undefined method `cart' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:71:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:23:50 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Current User: #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:63:in `add_to_cart'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:68:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1155ms (Views: 0.3ms | ActiveRecord: 15.8ms | Allocations: 1012651)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:25:18 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1082ms (Views: 0.3ms | ActiveRecord: 12.5ms | Allocations: 1012473)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:29:25 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
Completed 500 Internal Server Error in 114ms (ActiveRecord: 11.3ms | Allocations: 34765)


  
NoMethodError (undefined method `orders' for #<Cart id: 1, user_id: 2, created_at: "2023-10-09 20:32:06.805325000 +0000", updated_at: "2023-10-09 20:32:06.805325000 +0000">
Did you mean?  order_items):
  
app/controllers/carts_controller.rb:67:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:33:09 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
Completed 500 Internal Server Error in 116ms (ActiveRecord: 11.9ms | Allocations: 34488)


  
ActiveRecord::StatementInvalid (PG::UndefinedColumn: ERROR:  column orders.cart_id does not exist
LINE 1: SELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $...
                                              ^
):
  
app/controllers/carts_controller.rb:67:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to AddCartReferenceToOrders (20231010093453)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (13.9ms)[0m  [1m[35mALTER TABLE "orders" ADD "cart_id" bigint NOT NULL[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to AddCartReferenceToOrders (20231010093453)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" ORDER BY "carts"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "orders" ADD "cart_id" bigint DEFAULT 1 NOT NULL[0m
  [1m[35m (34.8ms)[0m  [1m[35mCREATE INDEX "index_orders_on_cart_id" ON "orders" ("cart_id")[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "orders" ADD CONSTRAINT "fk_rails_5cdf0e0ad4"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231010093453"]]
  [1m[36mTRANSACTION (14.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:43:48 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.6ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1155ms (Views: 0.2ms | ActiveRecord: 19.7ms | Allocations: 1018004)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:44:50 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1201ms (Views: 0.2ms | ActiveRecord: 15.7ms | Allocations: 1018048)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:55:03 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.7ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1091ms (Views: 0.2ms | ActiveRecord: 18.4ms | Allocations: 1018035)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-10 12:56:52 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [POST] "/add_to_cart"):
  
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:56:59 +0300
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1138ms (Views: 0.2ms | ActiveRecord: 17.5ms | Allocations: 1018002)


  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 12:59:29 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1163ms (Views: 0.2ms | ActiveRecord: 18.1ms | Allocations: 1018059)


  [1m[36mOrderItem Load (0.7ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 13:10:26 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1124ms (Views: 0.2ms | ActiveRecord: 17.2ms | Allocations: 1018054)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 13:13:09 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
Completed 500 Internal Server Error in 114ms (ActiveRecord: 10.8ms | Allocations: 31211)


  
ActiveModel::MissingAttributeError (can't write unknown attribute `current_cart_id`

          raise ActiveModel::MissingAttributeError, "can't write unknown attribute `#{name}`"
          ^^^^^):
  
app/controllers/carts_controller.rb:63:in `add_to_cart'
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 13:24:10 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1106ms (Views: 0.2ms | ActiveRecord: 15.6ms | Allocations: 1005858)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 13:25:33 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>80, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 80], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 93ms (Views: 0.3ms | ActiveRecord: 6.6ms | Allocations: 20189)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-10 13:26:46 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>10, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1158ms (Views: 0.2ms | ActiveRecord: 19.7ms | Allocations: 1018061)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-11 21:43:51 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (7.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>10, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (20.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (23.8ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (17.7ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (17.9ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (12.7ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1663ms (Views: 0.3ms | ActiveRecord: 153.3ms | Allocations: 1018061)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:19)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-11 22:08:47 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>10, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1148ms (Views: 0.2ms | ActiveRecord: 18.5ms | Allocations: 1018040)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-11 22:10:09 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>10, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 103ms (Views: 0.2ms | ActiveRecord: 12.8ms | Allocations: 28706)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-11 22:12:45 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>10, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
Completed 500 Internal Server Error in 99ms (ActiveRecord: 7.4ms | Allocations: 29580)


  
NoMethodError (undefined method `current_cart' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>
Did you mean?  current_password):
  
app/controllers/carts_controller.rb:62:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-11 22:13:19 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>10, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:53:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:67:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:70:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1131ms (Views: 0.3ms | ActiveRecord: 14.8ms | Allocations: 1018006)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-11 22:15:17 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>10, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:104:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:109:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:112:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 143ms (Views: 0.3ms | ActiveRecord: 15.2ms | Allocations: 46753)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-11 22:16:45 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>10, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:104:in `add_to_cart'
  [1m[36mOrder Load (0.6ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:109:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 10], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:112:in `add_to_cart'
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 16ms (Views: 0.3ms | ActiveRecord: 2.5ms | Allocations: 5189)


Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-11 22:23:50 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 50ms (ActiveRecord: 6.9ms | Allocations: 10541)


  
NoMethodError (undefined method `cart' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:196:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-11 22:24:05 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 83ms (ActiveRecord: 4.8ms | Allocations: 20987)


  
NoMethodError (undefined method `cart' for #<User id: 2, provider: "email", uid: "markpaul1@gmail.com", allow_password_change: [FILTERED], name: nil, nickname: nil, image: nil, email: "markpaul1@gmail.com", created_at: "2023-10-09 20:31:24.546947000 +0000", updated_at: "2023-10-09 20:31:24.609509000 +0000", role: nil>):
  
app/controllers/carts_controller.rb:196:in `add_quantity'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-11 22:28:57 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:196:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:203:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 107ms (Views: 0.3ms | ActiveRecord: 8.3ms | Allocations: 28838)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-11 22:31:03 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:196:in `add_quantity'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:203:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 111ms (Views: 0.4ms | ActiveRecord: 9.9ms | Allocations: 28819)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.7ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:33:04 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (5.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>0, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (20.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (21.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 0], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 238ms (Views: 0.3ms | ActiveRecord: 85.1ms | Allocations: 20181)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:33:11 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (1.1ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mCart Load (12.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:104:in `add_to_cart'
  [1m[36mOrder Load (17.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:109:in `add_to_cart'
  [1m[36mOrderItem Load (9.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:112:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 195ms (Views: 0.2ms | ActiveRecord: 59.9ms | Allocations: 29600)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:33:17 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>12, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 12], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:104:in `add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:109:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 12], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:112:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 31ms (Views: 0.1ms | ActiveRecord: 1.9ms | Allocations: 5187)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:33:25 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>12, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 12], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:104:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:109:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 12], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:112:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 13ms (Views: 0.1ms | ActiveRecord: 2.1ms | Allocations: 5089)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:33:36 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>12, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 12], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:104:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:109:in `add_to_cart'
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 12], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:112:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 13ms (Views: 0.2ms | ActiveRecord: 2.2ms | Allocations: 5067)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:33:39 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>12, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 12], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:104:in `add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:109:in `add_to_cart'
  [1m[36mOrderItem Load (0.8ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 12], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:112:in `add_to_cart'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 2.3ms | Allocations: 5059)


Started POST "/add_to_cart" for 127.0.0.1 at 2023-10-12 20:35:44 +0300
  
ActionController::RoutingError (No route matches [POST] "/add_to_cart"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
  [1m[36mOrder Load (0.7ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-12 20:37:19 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"product_id"=>"1", "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:196:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:203:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 10ms (Views: 0.2ms | ActiveRecord: 1.1ms | Allocations: 4020)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-12 20:37:44 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"product_id"=>"1", "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:196:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:203:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 104ms (Views: 0.2ms | ActiveRecord: 8.0ms | Allocations: 28820)


Started POST "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-12 20:39:20 +0300
  
ActionController::RoutingError (No route matches [POST] "/carts/1/add_quantity/1"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-12 20:39:31 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"product_id"=>"1", "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:196:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:203:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 105ms (Views: 0.2ms | ActiveRecord: 9.6ms | Allocations: 28822)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:47:58 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:104:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:109:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:112:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 148ms (Views: 0.2ms | ActiveRecord: 16.5ms | Allocations: 46763)


Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-12 20:49:14 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:196:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:203:in `add_quantity'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 11ms (Views: 0.2ms | ActiveRecord: 1.4ms | Allocations: 4145)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:50:09 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:144:in `add_to_cart'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:147:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 152ms (Views: 0.2ms | ActiveRecord: 20.4ms | Allocations: 47192)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:57:06 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:136: syntax error, unexpected '}', expecting `end'
    }
    ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:158: syntax error, unexpected '}', expecting '}'
... order_item_id: order_item.id }
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:160: syntax error, unexpected '}', expecting '}'
... add the product to the cart" }, status: :unprocessable_enti...
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:175: syntax error, unexpected '}', expecting '}'
...{ render json: @cart_contents }
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:185: syntax error, unexpected '}', expecting '}'
...items, cart_total: cart_total }
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:238: syntax error, unexpected '}', expecting '}'
...: 'User does not have a cart' }, status: :not_found
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:245: syntax error, unexpected '}', expecting '}'
...r item not found in the cart' }, status: :not_found
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:262: syntax error, unexpected '}', expecting '}'
...uantity updated successfully' }, status: :ok
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:272: syntax error, unexpected '}', expecting '}'
... message: 'Cart item removed' }
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:274: syntax error, unexpected '}', expecting '}'
...art_item.errors.full_messages }, status: :unprocessable_enti...
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:279: syntax error, unexpected '}', expecting '}'
...on: { message: 'Cart cleared' }
...                              ^
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:306: syntax error, unexpected end-of-input, expecting `end'):
  
app/controllers/carts_controller.rb:136: syntax error, unexpected '}', expecting `end'
app/controllers/carts_controller.rb:158: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:160: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:175: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:185: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:238: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:245: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:262: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:272: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:274: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:279: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:306: syntax error, unexpected end-of-input, expecting `end'
app/controllers/carts_controller.rb:136: syntax error, unexpected '}', expecting `end'
app/controllers/carts_controller.rb:158: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:160: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:175: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:185: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:238: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:245: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:262: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:272: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:274: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:279: syntax error, unexpected '}', expecting '}'
app/controllers/carts_controller.rb:306: syntax error, unexpected end-of-input, expecting `end'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 20:57:57 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:144:in `add_to_cart'
  [1m[36mOrderItem Load (0.7ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 1], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:147:in `add_to_cart'
Completed 500 Internal Server Error in 138ms (ActiveRecord: 14.6ms | Allocations: 44433)


  
NameError (uninitialized constant CartsController::YOUR_SPECIFIED_ID

      order_item = order.order_items.build(id: YOUR_SPECIFIED_ID, product: product, quantity: quantity)
                                               ^^^^^^^^^^^^^^^^^):
  
app/controllers/carts_controller.rb:154:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 21:00:10 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:144:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 139ms (Views: 0.2ms | ActiveRecord: 14.8ms | Allocations: 46473)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.7ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 21:34:13 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:144:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 144ms (Views: 0.3ms | ActiveRecord: 16.4ms | Allocations: 46839)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 21:34:44 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.8ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:144:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 175ms (Views: 0.3ms | ActiveRecord: 23.3ms | Allocations: 46433)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 21:46:13 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:144:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1351ms (Views: 0.2ms | ActiveRecord: 14.7ms | Allocations: 1016363)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 21:53:55 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:145:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1129ms (Views: 0.2ms | ActiveRecord: 17.5ms | Allocations: 1016346)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-12 21:54:24 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:145:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1077ms (Views: 0.3ms | ActiveRecord: 16.6ms | Allocations: 1016348)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 21:54:39 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:145:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1150ms (Views: 0.2ms | ActiveRecord: 18.2ms | Allocations: 1016351)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:21)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:03:53 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
Completed 500 Internal Server Error in 104ms (ActiveRecord: 8.0ms | Allocations: 28088)


  
ActiveRecord::StatementInvalid (PG::UndefinedColumn: ERROR:  column carts.status does not exist
LINE 1: ...".* FROM "carts" WHERE "carts"."user_id" = $1 AND "carts"."s...
                                                             ^
):
  
app/controllers/carts_controller.rb:139:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:08:26 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:145:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1101ms (Views: 0.2ms | ActiveRecord: 14.5ms | Allocations: 1016342)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:10:24 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:133:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:142:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:147:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1078ms (Views: 0.2ms | ActiveRecord: 15.7ms | Allocations: 1016353)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:12:36 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:146:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1082ms (Views: 0.2ms | ActiveRecord: 13.2ms | Allocations: 1016353)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:16:25 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1115ms (Views: 0.2ms | ActiveRecord: 14.2ms | Allocations: 1011018)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:20:15 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:130:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:139:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1102ms (Views: 0.2ms | ActiveRecord: 13.1ms | Allocations: 1011077)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:23:21 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1106ms (Views: 0.2ms | ActiveRecord: 13.6ms | Allocations: 1011099)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:26:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1072ms (Views: 0.2ms | ActiveRecord: 12.7ms | Allocations: 1011069)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:28:05 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1064ms (Views: 0.2ms | ActiveRecord: 13.1ms | Allocations: 1011104)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:29:11 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
Completed 500 Internal Server Error in 118ms (ActiveRecord: 9.4ms | Allocations: 35916)


  
NameError (undefined local variable or method `orders' for #<Cart id: 1, user_id: 2, created_at: "2023-10-09 20:32:06.805325000 +0000", updated_at: "2023-10-09 20:32:06.805325000 +0000">
Did you mean?  order_items):
  
app/models/cart.rb:9:in `open_order'
app/controllers/carts_controller.rb:157:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:30:10 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/models/cart.rb:20:in `open_order'
Completed 500 Internal Server Error in 127ms (ActiveRecord: 13.8ms | Allocations: 36813)


  
ActiveRecord::StatementInvalid (PG::UndefinedTable: ERROR:  missing FROM-clause entry for table "order"
LINE 1: ...der_items" WHERE "order_items"."cart_id" = $1 AND "order"."s...
                                                             ^
):
  
app/models/cart.rb:20:in `open_order'
app/controllers/carts_controller.rb:157:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:32:48 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (31.1ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" INNER JOIN "orders" ON "orders"."id" = "order_items"."order_id" WHERE "order_items"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/models/cart.rb:21:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1202ms (Views: 0.2ms | ActiveRecord: 54.3ms | Allocations: 1018891)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:37:51 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.7ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" INNER JOIN "orders" ON "orders"."id" = "order_items"."order_id" WHERE "order_items"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/models/cart.rb:29:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1096ms (Views: 0.2ms | ActiveRecord: 17.2ms | Allocations: 1018898)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:41:23 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1111ms (Views: 0.2ms | ActiveRecord: 18.2ms | Allocations: 1016962)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:42:28 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1087ms (Views: 0.2ms | ActiveRecord: 19.1ms | Allocations: 1016949)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:47:50 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1130ms (Views: 0.2ms | ActiveRecord: 17.8ms | Allocations: 1019617)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:51:39 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1182ms (Views: 0.2ms | ActiveRecord: 17.1ms | Allocations: 1019618)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-12 22:55:16 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1109ms (Views: 0.2ms | ActiveRecord: 21.8ms | Allocations: 1019972)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
  [1m[36mOrder Load (1.6ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-17 10:00:59 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mCACHE ActiveRecord::SchemaMigration Pluck (0.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActiveRecord::PendingMigrationError (

Migrations are pending. To resolve this issue, run:

        bin/rails db:migrate RAILS_ENV=development

You have 1 pending migration:

20231010093453_add_cart_reference_to_orders.rb


):
  
activerecord (7.0.7) lib/active_record/migration.rb:627:in `check_pending!'
activerecord (7.0.7) lib/active_record/migration.rb:592:in `block (2 levels) in call'
activesupport (7.0.7) lib/active_support/file_update_checker.rb:83:in `execute'
activerecord (7.0.7) lib/active_record/migration.rb:597:in `block in call'
activerecord (7.0.7) lib/active_record/migration.rb:589:in `synchronize'
activerecord (7.0.7) lib/active_record/migration.rb:589:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to AddCartReferenceToOrders (20231010093453)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCart Load (0.7ms)[0m  [1m[34mSELECT "carts".* FROM "carts" ORDER BY "carts"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (2.4ms)[0m  [1m[35mALTER TABLE "orders" ADD "cart_id" bigint DEFAULT 1 NOT NULL[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE INDEX "index_orders_on_cart_id" ON "orders" ("cart_id")[0m
  [1m[35m (4.3ms)[0m  [1m[35mALTER TABLE "orders" ADD CONSTRAINT "fk_rails_5cdf0e0ad4"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231010093453"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-17 10:01:30 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>1, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.6ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:245:in `add_quantity'
  [1m[36mOrderItem Load (0.9ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:252:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 404 Not Found in 118ms (Views: 0.2ms | ActiveRecord: 10.0ms | Allocations: 53922)


Started PATCH "/carts/add_to_cart" for 127.0.0.1 at 2023-10-17 10:03:38 +0300
  
AbstractController::ActionNotFound (The action 'update' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
Started PATCH "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-17 10:03:48 +0300
  
ActionController::RoutingError (No route matches [PATCH] "/carts/1/add_to_cart"):
  
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-17 10:03:58 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.1ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1194ms (Views: 0.2ms | ActiveRecord: 7.9ms | Allocations: 782638)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2023-10-17 11:03:59 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaulmuthuara9@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthuara9@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mUser Create (1.4ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaulmuthuara9@gmail.com"], ["created_at", "2023-10-17 08:04:00.575546"], ["updated_at", "2023-10-17 08:04:00.575546"]]
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:26:in `block in create'
  [1m[36mCart Create (0.8ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 4], ["created_at", "2023-10-17 08:04:00.596112"], ["updated_at", "2023-10-17 08:04:00.596112"]]
  ↳ app/controllers/auth/registrations_controller.rb:26:in `block in create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:26:in `block in create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-17 08:04:00.664323"], ["id", 4]]
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
Completed 200 OK in 1449ms (Views: 0.3ms | ActiveRecord: 21.6ms | Allocations: 772123)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-17 11:09:42 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura@gmail.com"], ["LIMIT", 1]]
Filter chain halted as :authenticate_user! rendered or redirected
Completed 401 Unauthorized in 26ms (Views: 0.5ms | ActiveRecord: 8.8ms | Allocations: 4165)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-17 11:09:44 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura@gmail.com"], ["LIMIT", 1]]
Filter chain halted as :authenticate_user! rendered or redirected
Completed 401 Unauthorized in 2ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 929)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-17 11:10:10 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura@gmail.com"], ["LIMIT", 1]]
Filter chain halted as :authenticate_user! rendered or redirected
Completed 401 Unauthorized in 1115ms (Views: 0.2ms | ActiveRecord: 1.7ms | Allocations: 724007)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-17 11:13:08 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1261ms (Views: 0.2ms | ActiveRecord: 12.7ms | Allocations: 832976)


Started POST "/carts/5/add_to_cart" for 127.0.0.1 at 2023-10-17 11:13:16 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"5"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 16ms (Views: 0.2ms | ActiveRecord: 2.6ms | Allocations: 7162)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-17 11:13:46 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1253ms (Views: 0.2ms | ActiveRecord: 14.0ms | Allocations: 833335)


Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-17 11:20:55 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.1ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.1ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 22ms (Views: 0.2ms | ActiveRecord: 4.6ms | Allocations: 10278)


Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-17 11:20:56 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 15ms (Views: 0.3ms | ActiveRecord: 2.1ms | Allocations: 7165)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
Started POST "/carts/4/add_to_cart" for 127.0.0.1 at 2023-10-17 11:21:38 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"4"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 15ms (Views: 0.2ms | ActiveRecord: 2.3ms | Allocations: 7142)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-17 11:48:09 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:150:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1295ms (Views: 0.6ms | ActiveRecord: 13.8ms | Allocations: 833335)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/4/add_to_cart" for 127.0.0.1 at 2023-10-17 12:03:58 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:321: syntax error, unexpected `end', expecting end-of-input):
  
app/controllers/carts_controller.rb:321: syntax error, unexpected `end', expecting end-of-input
app/controllers/carts_controller.rb:321: syntax error, unexpected `end', expecting end-of-input
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/4/add_to_cart" for 127.0.0.1 at 2023-10-17 12:05:20 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"4"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:148:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:31:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:35:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1281ms (Views: 0.5ms | ActiveRecord: 15.6ms | Allocations: 834137)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/4/add_to_cart" for 127.0.0.1 at 2023-10-17 12:57:03 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"4"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:148:in `add_to_cart'
Completed 500 Internal Server Error in 123ms (ActiveRecord: 9.1ms | Allocations: 68188)


  
NoMethodError (undefined method `orders' for #<Cart:0x00007f23c85b5ea8>
Did you mean?  order_items):
  
app/controllers/carts_controller.rb:155:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/4/add_to_cart" for 127.0.0.1 at 2023-10-17 13:01:44 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"4"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:148:in `add_to_cart'
  [1m[36mOrder Load (0.7ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:155:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1332ms (Views: 0.2ms | ActiveRecord: 15.4ms | Allocations: 833037)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/4/add_to_cart" for 127.0.0.1 at 2023-10-17 13:03:16 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"4"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:148:in `add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:155:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1312ms (Views: 0.2ms | ActiveRecord: 15.7ms | Allocations: 832686)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/4/add_to_cart" for 127.0.0.1 at 2023-10-18 09:46:36 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"4"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.7ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:148:in `add_to_cart'
  [1m[36mOrder Load (1.0ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:155:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1392ms (Views: 0.2ms | ActiveRecord: 22.8ms | Allocations: 832684)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 10:19:42 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:148:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:155:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1278ms (Views: 0.4ms | ActiveRecord: 14.6ms | Allocations: 832672)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 10:30:51 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:24:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:31:in `add_to_cart'
  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:38:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1248ms (Views: 0.2ms | ActiveRecord: 15.8ms | Allocations: 833038)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 10:54:09 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:69:in `add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:72:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1312ms (Views: 0.2ms | ActiveRecord: 14.0ms | Allocations: 833997)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 10:56:04 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:61:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 404 Not Found in 105ms (Views: 0.2ms | ActiveRecord: 6.3ms | Allocations: 48048)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/4/add_to_cart" for 127.0.0.1 at 2023-10-18 10:56:15 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"4"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:61:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 404 Not Found in 112ms (Views: 0.2ms | ActiveRecord: 7.2ms | Allocations: 48034)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 11:28:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:61:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 404 Not Found in 106ms (Views: 0.2ms | ActiveRecord: 5.8ms | Allocations: 48046)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 11:34:35 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:61:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:74:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:80:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 156ms (Views: 0.3ms | ActiveRecord: 13.3ms | Allocations: 111064)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 11:54:13 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:105:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 404 Not Found in 105ms (Views: 0.2ms | ActiveRecord: 6.6ms | Allocations: 48036)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/4/add_to_cart" for 127.0.0.1 at 2023-10-18 11:54:29 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"4"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:105:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 404 Not Found in 105ms (Views: 0.2ms | ActiveRecord: 6.5ms | Allocations: 48048)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 11:54:51 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:105:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 404 Not Found in 104ms (Views: 0.2ms | ActiveRecord: 6.1ms | Allocations: 48026)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:03:04 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:61:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:74:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:80:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 162ms (Views: 0.2ms | ActiveRecord: 14.8ms | Allocations: 111060)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:07:11 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:89:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1307ms (Views: 0.3ms | ActiveRecord: 16.1ms | Allocations: 831872)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:13:31 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 2], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:89:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1254ms (Views: 0.4ms | ActiveRecord: 14.2ms | Allocations: 832908)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:14:39 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
Completed 500 Internal Server Error in 105ms (ActiveRecord: 5.5ms | Allocations: 50153)


  
NameError (undefined local variable or method `order' for #<CartsController:0x0000000000a618>
Did you mean?  order_url):
  
app/controllers/carts_controller.rb:82:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:19:33 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mOrderItem Load (9.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 177ms (Views: 0.2ms | ActiveRecord: 24.5ms | Allocations: 114271)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:22:13 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.6ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:101:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:101:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:101:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 167ms (Views: 0.4ms | ActiveRecord: 17.3ms | Allocations: 116357)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:27:31 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:102:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:90:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 164ms (Views: 0.3ms | ActiveRecord: 16.3ms | Allocations: 115078)


Started POST "/carts/3/add_to_cart" for 127.0.0.1 at 2023-10-18 12:28:13 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"3"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:102:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:90:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 18ms (Views: 0.1ms | ActiveRecord: 2.9ms | Allocations: 7272)


Started POST "/carts/3/add_to_cart" for 127.0.0.1 at 2023-10-18 12:28:16 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"3"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:102:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:90:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 17ms (Views: 0.2ms | ActiveRecord: 2.9ms | Allocations: 7269)


Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:28:40 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:102:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:90:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 15ms (Views: 0.2ms | ActiveRecord: 2.2ms | Allocations: 7275)


Started PATCH "/carts/2/add_quantity/1" for 127.0.0.1 at 2023-10-18 12:29:42 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>1, "id"=>"2", "product_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:146:in `add_quantity'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:153:in `add_quantity'
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 404 Not Found in 71ms (Views: 0.1ms | ActiveRecord: 1.1ms | Allocations: 3618)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
  [1m[36mOrder Load (1.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:39:27 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>3, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.1ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.1ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:102:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:90:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 26ms (Views: 0.1ms | ActiveRecord: 4.7ms | Allocations: 10350)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[36mCart Load (1.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
  [1m[36mOrder Load (1.0ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
Started PATCH "/carts/2/add_quantity/1" for 127.0.0.1 at 2023-10-18 12:40:33 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>1, "id"=>"2", "product_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:146:in `add_quantity'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:153:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 404 Not Found in 6ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 3412)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/2/add_quantity/1" for 127.0.0.1 at 2023-10-18 12:40:56 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>1, "id"=>"2", "product_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara5@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:146:in `add_quantity'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:153:in `add_quantity'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 404 Not Found in 119ms (Views: 0.2ms | ActiveRecord: 8.6ms | Allocations: 55011)


Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:44:23 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:71:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:83:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.6ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:102:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:90:in `add_to_cart'
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 118ms (Views: 0.1ms | ActiveRecord: 8.4ms | Allocations: 63582)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:45:49 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:122:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:134:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:153:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
Completed 500 Internal Server Error in 168ms (ActiveRecord: 14.5ms | Allocations: 117125)


  
NameError (undefined local variable or method `order_item' for #<CartsController:0x0000000000a7f8>
Did you mean?  order_item_url):
  
app/controllers/carts_controller.rb:164:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:46:58 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:123:in `add_to_cart'
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:135:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:154:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:142:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 160ms (Views: 0.2ms | ActiveRecord: 14.7ms | Allocations: 115062)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:52:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:184:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:193:in `block in add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:195:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:191:in `add_to_cart'
Completed 500 Internal Server Error in 150ms (ActiveRecord: 11.0ms | Allocations: 99358)


  
NameError (undefined local variable or method `order_item' for #<CartsController:0x0000000000a758>
Did you mean?  order_item_url):
  
app/controllers/carts_controller.rb:205:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 12:58:48 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:123:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:135:in `add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:154:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:142:in `add_to_cart'
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 164ms (Views: 0.5ms | ActiveRecord: 17.4ms | Allocations: 115078)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 13:03:55 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:173:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:185:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 2], ["product_id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:192:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.1ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:204:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:195:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 171ms (Views: 0.2ms | ActiveRecord: 16.6ms | Allocations: 115465)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 13:04:55 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:173:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:185:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:205:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:191:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 162ms (Views: 0.2ms | ActiveRecord: 15.5ms | Allocations: 114975)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 13:08:43 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:173:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:185:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mOrderItem Create (8.7ms)[0m  [1m[32mINSERT INTO "order_items" ("product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["product_id", 30], ["quantity", 2], ["created_at", "2023-10-18 10:08:43.708415"], ["updated_at", "2023-10-18 10:08:43.708415"], ["cart_id", 2]]
  ↳ app/controllers/carts_controller.rb:205:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:191:in `add_to_cart'
Completed 500 Internal Server Error in 163ms (ActiveRecord: 22.0ms | Allocations: 112848)


  
ActiveRecord::NotNullViolation (PG::NotNullViolation: ERROR:  null value in column "order_id" violates not-null constraint
DETAIL:  Failing row contains (1, null, 30, 2, null, 2023-10-18 10:08:43.708415, 2023-10-18 10:08:43.708415, 2).
):
  
app/controllers/carts_controller.rb:205:in `block in add_to_cart'
app/controllers/carts_controller.rb:191:in `add_to_cart'
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 13:09:27 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:123:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:135:in `add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:154:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:142:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 4], ["LIMIT", 1]]
Completed 200 OK in 121ms (Views: 0.2ms | ActiveRecord: 13.1ms | Allocations: 38346)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 14:11:35 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:23:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:35:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mOrderItem Create (1.6ms)[0m  [1m[32mINSERT INTO "order_items" ("product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["product_id", 30], ["quantity", 2], ["created_at", "2023-10-18 11:11:35.538883"], ["updated_at", "2023-10-18 11:11:35.538883"], ["cart_id", 2]]
  ↳ app/controllers/carts_controller.rb:55:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:41:in `add_to_cart'
Completed 500 Internal Server Error in 180ms (ActiveRecord: 20.8ms | Allocations: 112832)


  
ActiveRecord::NotNullViolation (PG::NotNullViolation: ERROR:  null value in column "order_id" violates not-null constraint
DETAIL:  Failing row contains (2, null, 30, 2, null, 2023-10-18 11:11:35.538883, 2023-10-18 11:11:35.538883, 2).
):
  
app/controllers/carts_controller.rb:55:in `block in add_to_cart'
app/controllers/carts_controller.rb:41:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 14:17:11 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:34:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mOrderItem Create (0.7ms)[0m  [1m[32mINSERT INTO "order_items" ("product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["product_id", 30], ["quantity", 2], ["created_at", "2023-10-18 11:17:11.529381"], ["updated_at", "2023-10-18 11:17:11.529381"], ["cart_id", 2]]
  ↳ app/controllers/carts_controller.rb:48:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:40:in `add_to_cart'
Completed 500 Internal Server Error in 165ms (ActiveRecord: 17.7ms | Allocations: 112360)


  
ActiveRecord::NotNullViolation (PG::NotNullViolation: ERROR:  null value in column "order_id" violates not-null constraint
DETAIL:  Failing row contains (3, null, 30, 2, null, 2023-10-18 11:17:11.529381, 2023-10-18 11:17:11.529381, 2).
):
  
app/controllers/carts_controller.rb:48:in `block in add_to_cart'
app/controllers/carts_controller.rb:40:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 14:19:28 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:96: syntax error, unexpected constant, expecting `end'
...ender json: { message: "Product added to cart successfully",...
...                        ^~~~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:99: syntax error, unexpected constant, expecting `end'
#       errors << "User is invalid" if current_user....
                   ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:100: syntax error, unexpected constant, expecting `end'
#       errors << "Order is invalid" if order.errors....
                   ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:101: syntax error, unexpected constant, expecting `end'
#       errors << "Order item is invalid" if order_it...
                   ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:102: syntax error, unexpected constant, expecting `end'
...   render json: { error: "There was an error adding the prod...
...                          ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:114: syntax error, unexpected constant, expecting `end'
... render json: { error: "Product not found." }, status: :not_...
...                        ^~~~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:119: syntax error, unexpected constant, expecting `end'
...    render json: { error: "User not found." }, status: :not_...
...                           ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:144: syntax error, unexpected constant, expecting `end'
#         errors << "User is invalid" if current_user....
                     ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:145: syntax error, unexpected constant, expecting `end'
#         errors << "Cart is invalid" if current_cart....
                     ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:146: syntax error, unexpected constant, expecting `end'
#         errors << "Order is invalid" if order.errors....
                     ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:147: syntax error, unexpected constant, expecting `end'
#         errors << "Order item is invalid" if order_it...
                     ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:149: syntax error, unexpected constant, expecting `end'
...   render json: { error: "There was an error adding the prod...
...                          ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:153: syntax error, unexpected constant, expecting `end'
...ender json: { message: "Product added to cart successfully",...
...                        ^~~~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:166: syntax error, unexpected constant, expecting `end'
... render json: { error: "Product not found." }, status: :not_...
...                        ^~~~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:171: syntax error, unexpected constant, expecting `end'
...    render json: { error: "User not found." }, status: :not_...
...                           ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:196: syntax error, unexpected constant, expecting `end'
#       errors << "User is invalid" if current_user....
                   ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:197: syntax error, unexpected constant, expecting `end'
#       errors << "Cart is invalid" if current_cart....
                   ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:198: syntax error, unexpected constant, expecting `end'
#       errors << "Order is invalid" if order.errors....
                   ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:199: syntax error, unexpected constant, expecting `end'
#       errors << "Order item is invalid" if order_it...
                   ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:201: syntax error, unexpected constant, expecting `end'
...   render json: { error: "There was an error adding the prod...
...                          ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:205: syntax error, unexpected constant, expecting `end'
...ender json: { message: "Product added to cart successfully",...
...                        ^~~~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:216: syntax error, unexpected constant, expecting `end'
... render json: { error: "Product not found." }, status: :not_...
...                        ^~~~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:221: syntax error, unexpected constant, expecting `end'
...    render json: { error: "User not found." }, status: :not_...
...                           ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:249: syntax error, unexpected constant, expecting `end'
...   render json: { error: "There was an error adding the prod...
...                          ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:254: syntax error, unexpected constant, expecting `end'
#       errors << "User is invalid" if current_user....
                   ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:255: syntax error, unexpected constant, expecting `end'
#       errors << "Cart is invalid" if current_cart....
                   ^~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:256: syntax error, unexpected constant, expecting `end'
#       errors << "Order is invalid" if order.errors....
                   ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:258: syntax error, unexpected constant, expecting `end'
...   render json: { error: "There was an error adding the prod...
...                          ^~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:262: syntax error, unexpected constant, expecting `end'
...ender json: { message: "Product added to cart successfully",...
...                        ^~~~~~~
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:366: unterminated string meets end of file
/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:366: syntax error, unexpected end-of-input, expecting `end'):
  
app/controllers/carts_controller.rb:96: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:99: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:100: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:101: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:102: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:114: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:119: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:144: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:145: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:146: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:147: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:149: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:153: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:166: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:171: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:196: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:197: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:198: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:199: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:201: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:205: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:216: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:221: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:249: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:254: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:255: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:256: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:258: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:262: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:366: unterminated string meets end of file
app/controllers/carts_controller.rb:366: syntax error, unexpected end-of-input, expecting `end'
app/controllers/carts_controller.rb:96: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:99: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:100: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:101: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:102: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:114: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:119: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:144: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:145: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:146: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:147: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:149: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:153: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:166: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:171: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:196: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:197: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:198: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:199: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:201: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:205: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:216: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:221: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:249: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:254: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:255: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:256: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:258: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:262: syntax error, unexpected constant, expecting `end'
app/controllers/carts_controller.rb:366: unterminated string meets end of file
app/controllers/carts_controller.rb:366: syntax error, unexpected end-of-input, expecting `end'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/2/add_to_cart" for 127.0.0.1 at 2023-10-18 14:21:11 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>30, "quantity"=>2, "id"=>"2"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthuara9@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 30], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 4], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:34:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 2]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mOrderItem Create (0.7ms)[0m  [1m[32mINSERT INTO "order_items" ("product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["product_id", 30], ["quantity", 2], ["created_at", "2023-10-18 11:21:11.757247"], ["updated_at", "2023-10-18 11:21:11.757247"], ["cart_id", 2]]
  ↳ app/controllers/carts_controller.rb:46:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:40:in `add_to_cart'
Completed 500 Internal Server Error in 158ms (ActiveRecord: 14.7ms | Allocations: 112362)


  
ActiveRecord::NotNullViolation (PG::NotNullViolation: ERROR:  null value in column "order_id" violates not-null constraint
DETAIL:  Failing row contains (4, null, 30, 2, null, 2023-10-18 11:21:11.757247, 2023-10-18 11:21:11.757247, 2).
):
  
app/controllers/carts_controller.rb:46:in `block in add_to_cart'
app/controllers/carts_controller.rb:40:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-18 22:02:46 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (39.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (80.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (46.7ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mCart Load (100.0ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:34:in `add_to_cart'
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mOrderItem Load (43.0ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  ↳ app/models/cart.rb:34:in `open_order'
  [1m[36mCart Load (0.8ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/models/cart.rb:38:in `open_order'
  [1m[36mOrderItem Create (21.8ms)[0m  [1m[32mINSERT INTO "order_items" ("product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["product_id", 2], ["quantity", 22], ["created_at", "2023-10-18 19:02:51.053786"], ["updated_at", "2023-10-18 19:02:51.053786"], ["cart_id", 1]]
  ↳ app/controllers/carts_controller.rb:46:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:40:in `add_to_cart'
Completed 500 Internal Server Error in 1051ms (ActiveRecord: 460.0ms | Allocations: 49094)


  
ActiveRecord::NotNullViolation (PG::NotNullViolation: ERROR:  null value in column "order_id" of relation "order_items" violates not-null constraint
DETAIL:  Failing row contains (1, null, 2, 22, null, 2023-10-18 19:02:51.053786, 2023-10-18 19:02:51.053786, 1).
):
  
app/controllers/carts_controller.rb:46:in `block in add_to_cart'
app/controllers/carts_controller.rb:40:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-18 22:14:43 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:34:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:43:in `block in add_to_cart'
  [1m[36mOrder Load (36.9ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:46:in `block in add_to_cart'
  [1m[36mOrderItem Create (25.5ms)[0m  [1m[32mINSERT INTO "order_items" ("order_id", "product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["order_id", 1], ["product_id", 2], ["quantity", 22], ["created_at", "2023-10-18 19:14:43.848239"], ["updated_at", "2023-10-18 19:14:43.848239"], ["cart_id", 1]]
  ↳ app/controllers/carts_controller.rb:52:in `block in add_to_cart'
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:60:in `block in add_to_cart'
  [1m[36mTRANSACTION (12.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:41:in `add_to_cart'
Completed 500 Internal Server Error in 250ms (ActiveRecord: 91.7ms | Allocations: 53667)


  
NameError (undefined local variable or method `order_item' for #<CartsController:0x0000000000a348>

    render json: { message: "Product added to cart successfully", cart_id: current_user.current_cart.id, order_item_id: order_item.id }
                                                                                                                        ^^^^^^^^^^
Did you mean?  order_item_url):
  
app/controllers/carts_controller.rb:71:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-18 22:23:31 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:34:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:45:in `block in add_to_cart'
  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:48:in `block in add_to_cart'
  [1m[36mOrderItem Create (1.0ms)[0m  [1m[32mINSERT INTO "order_items" ("order_id", "product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["order_id", 1], ["product_id", 2], ["quantity", 22], ["created_at", "2023-10-18 19:23:31.556153"], ["updated_at", "2023-10-18 19:23:31.556153"], ["cart_id", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `block in add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:62:in `block in add_to_cart'
  [1m[36mTRANSACTION (17.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:43:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 170ms (Views: 0.2ms | ActiveRecord: 36.9ms | Allocations: 50886)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-18 22:49:30 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:254: syntax error, unexpected `end', expecting end-of-input):
  
app/controllers/carts_controller.rb:254: syntax error, unexpected `end', expecting end-of-input
app/controllers/carts_controller.rb:254: syntax error, unexpected `end', expecting end-of-input
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-18 22:50:04 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
  
NameError (undefined local variable or method `order_item' for CartsController:Class

    if order_item && order_item.id
       ^^^^^^^^^^):
  
app/controllers/carts_controller.rb:142:in `block in <class:CartsController>'
app/controllers/carts_controller.rb:4:in `<class:CartsController>'
app/controllers/carts_controller.rb:1:in `<top (required)>'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-18 22:56:12 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:244: syntax error, unexpected end-of-input, expecting `end'):
  
app/controllers/carts_controller.rb:244: syntax error, unexpected end-of-input, expecting `end'
app/controllers/carts_controller.rb:244: syntax error, unexpected end-of-input, expecting `end'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-18 22:57:17 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:76:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:88:in `add_to_cart'
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:108:in `block in add_to_cart'
  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:108:in `block in add_to_cart'
  [1m[36mCACHE Product Load (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:114:in `block in add_to_cart'
  [1m[36mOrderItem Update (0.6ms)[0m  [1m[33mUPDATE "order_items" SET "quantity" = $1, "updated_at" = $2 WHERE "order_items"."id" = $3[0m  [["quantity", 44], ["updated_at", "2023-10-18 19:57:17.607758"], ["id", 2]]
  ↳ app/controllers/carts_controller.rb:114:in `block in add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:122:in `block in add_to_cart'
  [1m[36mTRANSACTION (12.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:106:in `add_to_cart'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 183ms (Views: 0.4ms | ActiveRecord: 34.4ms | Allocations: 53107)


  [1m[36mOrderItem Load (1.1ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
Started PATCH "/carts/1/add_quantity/1" for 127.0.0.1 at 2023-10-18 23:09:56 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:179:in `add_quantity'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 58ms (Views: 0.2ms | ActiveRecord: 8.7ms | Allocations: 7186)


Started PATCH "/carts/1/add_quantity/3" for 127.0.0.1 at 2023-10-18 23:10:22 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"3"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:179:in `add_quantity'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 10ms (Views: 0.1ms | ActiveRecord: 1.4ms | Allocations: 3711)


Started PATCH "/carts/3/add_quantity/1" for 127.0.0.1 at 2023-10-18 23:10:31 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"3", "product_id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_quantity'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:179:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 10ms (Views: 0.1ms | ActiveRecord: 1.4ms | Allocations: 3704)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/3/add_quantity/1" for 127.0.0.1 at 2023-10-18 23:10:39 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"3", "product_id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:179:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 108ms (Views: 0.2ms | ActiveRecord: 8.5ms | Allocations: 28863)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/3" for 127.0.0.1 at 2023-10-18 23:14:47 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"3"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:179:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 108ms (Views: 0.2ms | ActiveRecord: 9.7ms | Allocations: 28860)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/2" for 127.0.0.1 at 2023-10-18 23:16:39 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>2, "id"=>"1", "product_id"=>"2"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:179:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 107ms (Views: 0.2ms | ActiveRecord: 9.4ms | Allocations: 28866)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2023-10-18 23:17:13 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>22, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:76:in `add_to_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:88:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:95:in `add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:108:in `block in add_to_cart'
  [1m[36mOrder Load (1.5ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 1], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:108:in `block in add_to_cart'
  [1m[36mCACHE Product Load (0.0ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:114:in `block in add_to_cart'
  [1m[36mOrderItem Update (0.5ms)[0m  [1m[33mUPDATE "order_items" SET "quantity" = $1, "updated_at" = $2 WHERE "order_items"."id" = $3[0m  [["quantity", 66], ["updated_at", "2023-10-18 20:17:13.144088"], ["id", 2]]
  ↳ app/controllers/carts_controller.rb:114:in `block in add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:122:in `block in add_to_cart'
  [1m[36mTRANSACTION (31.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:106:in `add_to_cart'
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 157ms (Views: 0.3ms | ActiveRecord: 46.9ms | Allocations: 28323)


Started PATCH "/carts/1/add_quantity/2" for 127.0.0.1 at 2023-10-18 23:26:39 +0300
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>4, "id"=>"1", "product_id"=>"2"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_quantity'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:179:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 36ms (Views: 0.1ms | ActiveRecord: 6.7ms | Allocations: 7034)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.8ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
Started PATCH "/carts/1/add_quantity/3" for 127.0.0.1 at 2023-10-18 23:31:29 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>4, "id"=>"1", "product_id"=>"3"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_quantity'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:179:in `add_quantity'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 102ms (Views: 0.2ms | ActiveRecord: 9.1ms | Allocations: 28857)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/2" for 127.0.0.1 at 2023-10-18 23:31:42 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>4, "id"=>"1", "product_id"=>"2"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:172:in `add_quantity'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" IS NULL LIMIT $2[0m  [["cart_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:179:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 114ms (Views: 0.2ms | ActiveRecord: 10.1ms | Allocations: 28857)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/2" for 127.0.0.1 at 2023-10-18 23:37:06 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>4, "id"=>"1", "product_id"=>"2"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:204:in `add_quantity'
  [1m[36mOrderItem Load (0.8ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" = $2 LIMIT $3[0m  [["cart_id", 1], ["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:212:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 404 Not Found in 103ms (Views: 0.3ms | ActiveRecord: 9.4ms | Allocations: 28887)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started PATCH "/carts/1/add_quantity/2" for 127.0.0.1 at 2023-10-18 23:41:14 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_quantity as */*
  Parameters: {"quantity"=>4, "id"=>"1", "product_id"=>"2"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:204:in `add_quantity'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."id" = $2 LIMIT $3[0m  [["cart_id", 1], ["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:212:in `add_quantity'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:229:in `add_quantity'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:229:in `add_quantity'
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:229:in `add_quantity'
  [1m[36mOrderItem Update (0.6ms)[0m  [1m[33mUPDATE "order_items" SET "quantity" = $1, "updated_at" = $2 WHERE "order_items"."id" = $3[0m  [["quantity", 70], ["updated_at", "2023-10-18 20:41:14.669328"], ["id", 2]]
  ↳ app/controllers/carts_controller.rb:229:in `add_quantity'
  [1m[36mTRANSACTION (13.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:229:in `add_quantity'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 161ms (Views: 0.3ms | ActiveRecord: 32.0ms | Allocations: 50556)


  [1m[36mOrderItem Load (0.9ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
Started DELETE "/carts/1/remove_item/2" for 127.0.0.1 at 2023-10-18 23:50:33 +0300
Processing by CartsController#remove_item as */*
  Parameters: {"id"=>"1", "product_id"=>"2"}
Filter chain halted as :authenticate_user! rendered or redirected
Completed 401 Unauthorized in 1368ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 969889)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started DELETE "/carts/1/remove_item/2" for 127.0.0.1 at 2023-10-18 23:50:57 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#remove_item as */*
  Parameters: {"id"=>"1", "product_id"=>"2"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 80ms (ActiveRecord: 5.4ms | Allocations: 14914)


  
ArgumentError (wrong number of arguments (given 0, expected 1)):
  
app/controllers/carts_controller.rb:166:in `remove_item'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started DELETE "/carts/1/remove_item/2" for 127.0.0.1 at 2023-10-18 23:52:31 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#remove_item as */*
  Parameters: {"id"=>"1", "product_id"=>"2"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
Completed 500 Internal Server Error in 75ms (ActiveRecord: 4.8ms | Allocations: 14914)


  
ArgumentError (wrong number of arguments (given 0, expected 1)):
  
app/controllers/carts_controller.rb:166:in `remove_item'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started DELETE "/carts/1/remove_item/2" for 127.0.0.1 at 2023-10-18 23:55:00 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#remove_item as */*
  Parameters: {"id"=>"1", "product_id"=>"2"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
No template found for CartsController#remove_item, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 204 No Content in 79ms (ActiveRecord: 6.1ms | Allocations: 16960)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started DELETE "/carts/1/remove_item/2" for 127.0.0.1 at 2023-10-18 23:56:47 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#remove_item as */*
  Parameters: {"id"=>"1", "product_id"=>"2"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:181:in `remove_item'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 1], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:181:in `remove_item'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:185:in `remove_item'
  [1m[36mOrderItem Destroy (0.2ms)[0m  [1m[31mDELETE FROM "order_items" WHERE "order_items"."id" = $1[0m  [["id", 2]]
  ↳ app/controllers/carts_controller.rb:185:in `remove_item'
  [1m[36mTRANSACTION (10.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:185:in `remove_item'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 129ms (Views: 0.5ms | ActiveRecord: 22.4ms | Allocations: 34224)


  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started DELETE "/carts/1/clear_cart" for 127.0.0.1 at 2023-10-18 23:59:28 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#clear_cart as */*
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:162:in `clear_cart'
Completed 500 Internal Server Error in 106ms (ActiveRecord: 7.6ms | Allocations: 27274)


  
NoMethodError (undefined method `cart_items' for #<Cart id: 1, user_id: 2, created_at: "2023-10-09 20:32:06.805325000 +0000", updated_at: "2023-10-09 20:32:06.805325000 +0000">):
  
app/controllers/carts_controller.rb:162:in `clear_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started DELETE "/carts/1/clear_cart" for 127.0.0.1 at 2023-10-19 00:01:04 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#clear_cart as */*
  Parameters: {"id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:162:in `clear_cart'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1[0m  [["cart_id", 1]]
  ↳ app/controllers/carts_controller.rb:162:in `clear_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:162:in `clear_cart'
  [1m[36mOrderItem Destroy (0.6ms)[0m  [1m[31mDELETE FROM "order_items" WHERE "order_items"."id" = $1[0m  [["id", 3]]
  ↳ app/controllers/carts_controller.rb:162:in `clear_cart'
  [1m[36mTRANSACTION (29.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:162:in `clear_cart'
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 161ms (Views: 0.2ms | ActiveRecord: 41.9ms | Allocations: 34709)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
<<<<<<< HEAD
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
=======
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (134.5ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (8.0ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
>>>>>>> ceb27d7649c9a9e5a144205fa3b3a48970921d3f
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
<<<<<<< HEAD
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
=======
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (91.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (87.5ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to DeviseTokenAuthCreateUsers (20230819204134)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (72.0ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "provider" character varying DEFAULT 'email' NOT NULL, "uid" character varying DEFAULT '' NOT NULL, "encrypted_password" character varying DEFAULT '' NOT NULL, "reset_password_token" character varying, "reset_password_sent_at" timestamp(6), "allow_password_change" boolean DEFAULT FALSE, "remember_created_at" timestamp(6), "confirmation_token" character varying, "confirmed_at" timestamp(6), "confirmation_sent_at" timestamp(6), "unconfirmed_email" character varying, "name" character varying, "nickname" character varying, "image" character varying, "email" character varying, "tokens" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (30.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (32.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_uid_and_provider" ON "users" ("uid", "provider")[0m
  [1m[35m (24.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (23.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_confirmation_token" ON "users" ("confirmation_token")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230819204134"]]
  [1m[36mTRANSACTION (13.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddRoleToUsers (20230821020342)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "users" ADD "role" integer[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821020342"]]
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePosts (20230821021958)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (73.7ms)[0m  [1m[35mCREATE TABLE "posts" ("id" bigserial primary key, "title" character varying, "content" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821021958"]]
  [1m[36mTRANSACTION (19.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateActiveStorageTables (20230821023831)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (57.9ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL)[0m
  [1m[35m (48.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key")[0m
  [1m[35m (49.7ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (23.0ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id")[0m
  [1m[35m (24.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id")[0m
  [1m[35m (49.6ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (24.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821023831"]]
  [1m[36mTRANSACTION (16.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (60.2ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
>>>>>>> ceb27d7649c9a9e5a144205fa3b3a48970921d3f
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
<<<<<<< HEAD
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
=======
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (108.6ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (0.9ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateCategories (20230928093441)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (69.1ms)[0m  [1m[35mCREATE TABLE "categories" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093441"]]
  [1m[36mTRANSACTION (21.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrders (20230928093450)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (69.7ms)[0m  [1m[35mCREATE TABLE "orders" ("id" bigserial primary key, "user_id" bigint NOT NULL, "status" character varying, "total_amount" decimal, "shipping_address" text, "payment_details" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_f868b47f6a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (30.3ms)[0m  [1m[35mCREATE INDEX "index_orders_on_user_id" ON "orders" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093450"]]
  [1m[36mTRANSACTION (20.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (72.0ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (84.3ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[35m (31.0ms)[0m  [1m[35mCREATE INDEX "index_products_on_category_id" ON "products" ("category_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093423"]]
  [1m[36mTRANSACTION (14.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (70.8ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[35m (30.7ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_order_id" ON "order_items" ("order_id")[0m
  [1m[35m (31.9ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_product_id" ON "order_items" ("product_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093507"]]
  [1m[36mTRANSACTION (14.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCarts (20230928093648)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (37.9ms)[0m  [1m[35mCREATE TABLE "carts" ("id" bigserial primary key, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_ea59a35211"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (47.7ms)[0m  [1m[35mCREATE INDEX "index_carts_on_user_id" ON "carts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093648"]]
  [1m[36mTRANSACTION (19.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAddresses (20230928093657)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (61.9ms)[0m  [1m[35mCREATE TABLE "addresses" ("id" bigserial primary key, "user_id" bigint NOT NULL, "address_type" character varying, "street" character varying, "city" character varying, "state" character varying, "postal_code" character varying, "country" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_48c9e0c5a2"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (38.8ms)[0m  [1m[35mCREATE INDEX "index_addresses_on_user_id" ON "addresses" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093657"]]
  [1m[36mTRANSACTION (89.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateReceipts (20230928094034)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (60.0ms)[0m  [1m[35mCREATE TABLE "receipts" ("id" bigserial primary key, "order_id" bigint NOT NULL, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_de8c1572cc"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_b2d4d3fa14"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (23.1ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_order_id" ON "receipts" ("order_id")[0m
  [1m[35m (24.3ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_user_id" ON "receipts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928094034"]]
  [1m[36mTRANSACTION (20.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateBrands (20231002082120)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (65.7ms)[0m  [1m[35mCREATE TABLE "brands" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002082120"]]
  [1m[36mTRANSACTION (18.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCartReferenceToOrderItems (20231002130233)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (1.0ms)[0m  [1m[35mALTER TABLE "order_items" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (37.1ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_cart_id" ON "order_items" ("cart_id")[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "order_items" ADD CONSTRAINT "fk_rails_59f7f23852"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002130233"]]
  [1m[36mTRANSACTION (15.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCartReferenceToOrders (20231010093453)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" ORDER BY "carts"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "orders" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (54.2ms)[0m  [1m[35mCREATE INDEX "index_orders_on_cart_id" ON "orders" ("cart_id")[0m
  [1m[35m (1.7ms)[0m  [1m[35mALTER TABLE "orders" ADD CONSTRAINT "fk_rails_5cdf0e0ad4"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231010093453"]]
  [1m[36mTRANSACTION (12.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.7ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "development"], ["created_at", "2023-10-29 13:05:00.409749"], ["updated_at", "2023-10-29 13:05:00.409749"]]
  [1m[36mTRANSACTION (9.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (1.1ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Clothes"], ["description", "Clothing category"], ["created_at", "2023-10-29 13:05:49.460330"], ["updated_at", "2023-10-29 13:05:49.460330"]]
  [1m[36mTRANSACTION (82.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.5ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Shoes"], ["description", "Footwear category"], ["created_at", "2023-10-29 13:05:49.551860"], ["updated_at", "2023-10-29 13:05:49.551860"]]
  [1m[36mTRANSACTION (33.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.5ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Jewelry"], ["description", "Jewelry category"], ["created_at", "2023-10-29 13:05:49.591429"], ["updated_at", "2023-10-29 13:05:49.591429"]]
  [1m[36mTRANSACTION (9.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.5ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Men"], ["description", "Men's clothing"], ["created_at", "2023-10-29 13:05:49.607157"], ["updated_at", "2023-10-29 13:05:49.607157"]]
  [1m[36mTRANSACTION (4.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.4ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Women"], ["description", "Women's clothing"], ["created_at", "2023-10-29 13:05:49.615607"], ["updated_at", "2023-10-29 13:05:49.615607"]]
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (1.1ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Swift-Batz"], ["description", "Voluptas inventore autem nemo."], ["created_at", "2023-10-29 13:05:51.096458"], ["updated_at", "2023-10-29 13:05:51.096458"]]
  [1m[36mTRANSACTION (19.6ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.6ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Gibson and Sons"], ["description", "Iste vitae animi molestiae."], ["created_at", "2023-10-29 13:05:51.125228"], ["updated_at", "2023-10-29 13:05:51.125228"]]
  [1m[36mTRANSACTION (2.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.8ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Glover-Lueilwitz"], ["description", "Laborum ea labore vel."], ["created_at", "2023-10-29 13:05:51.133531"], ["updated_at", "2023-10-29 13:05:51.133531"]]
  [1m[36mTRANSACTION (18.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.6ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Considine Group"], ["description", "Dolores sed consequatur sunt."], ["created_at", "2023-10-29 13:05:51.157455"], ["updated_at", "2023-10-29 13:05:51.157455"]]
  [1m[36mTRANSACTION (2.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.6ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Stanton, Pollich and Sanford"], ["description", "Modi et ipsum sit."], ["created_at", "2023-10-29 13:05:51.166064"], ["updated_at", "2023-10-29 13:05:51.166064"]]
  [1m[36mTRANSACTION (3.2ms)[0m  [1m[35mCOMMIT[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2023-10-29 16:19:01 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mUser Exists? (19.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mUser Create (1.3ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaul@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaul@gmail.com"], ["created_at", "2023-10-29 13:19:03.893641"], ["updated_at", "2023-10-29 13:19:03.893641"]]
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mTRANSACTION (16.9ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:26:in `block in create'
  [1m[36mCart Create (1.1ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 1], ["created_at", "2023-10-29 13:19:03.953954"], ["updated_at", "2023-10-29 13:19:03.953954"]]
  ↳ app/controllers/auth/registrations_controller.rb:26:in `block in create'
  [1m[36mTRANSACTION (6.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:26:in `block in create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mUser Update (0.8ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-29 13:19:04.022516"], ["id", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mTRANSACTION (4.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:23:in `create'
Completed 200 OK in 2530ms (Views: 0.5ms | ActiveRecord: 65.2ms | Allocations: 999913)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-29 16:20:38 +0300
Error occurred while parsing request parameters.
Contents:

"email": "markpaul@gmail.com",
"paswword": "markpaul"

Processing by DeviseTokenAuth::SessionsController#create as */*
Completed 400 Bad Request in 1ms (ActiveRecord: 0.0ms | Allocations: 267)


  
ActionDispatch::Http::Parameters::ParseError (Error occurred while parsing request parameters):
  
actionpack (7.0.7) lib/action_dispatch/http/parameters.rb:96:in `rescue in parse_formatted_parameters'
actionpack (7.0.7) lib/action_dispatch/http/parameters.rb:92:in `parse_formatted_parameters'
actionpack (7.0.7) lib/action_dispatch/http/request.rb:389:in `block in POST'
rack (2.2.8) lib/rack/request.rb:69:in `fetch'
rack (2.2.8) lib/rack/request.rb:69:in `fetch_header'
actionpack (7.0.7) lib/action_dispatch/http/request.rb:388:in `POST'
actionpack (7.0.7) lib/action_dispatch/http/parameters.rb:55:in `parameters'
actionpack (7.0.7) lib/action_controller/metal/strong_parameters.rb:1209:in `params'
devise_token_auth (1.2.2) app/controllers/devise_token_auth/sessions_controller.rb:130:in `resource_params'
devise_token_auth (1.2.2) app/controllers/devise_token_auth/sessions_controller.rb:14:in `create'
actionpack (7.0.7) lib/action_controller/metal/basic_implicit_render.rb:6:in `send_action'
actionpack (7.0.7) lib/abstract_controller/base.rb:215:in `process_action'
actionpack (7.0.7) lib/action_controller/metal/rendering.rb:165:in `process_action'
actionpack (7.0.7) lib/abstract_controller/callbacks.rb:234:in `block in process_action'
activesupport (7.0.7) lib/active_support/callbacks.rb:107:in `run_callbacks'
actionpack (7.0.7) lib/abstract_controller/callbacks.rb:233:in `process_action'
actionpack (7.0.7) lib/action_controller/metal/rescue.rb:23:in `process_action'
actionpack (7.0.7) lib/action_controller/metal/instrumentation.rb:67:in `block in process_action'
activesupport (7.0.7) lib/active_support/notifications.rb:206:in `block in instrument'
activesupport (7.0.7) lib/active_support/notifications/instrumenter.rb:24:in `instrument'
activesupport (7.0.7) lib/active_support/notifications.rb:206:in `instrument'
actionpack (7.0.7) lib/action_controller/metal/instrumentation.rb:66:in `process_action'
actionpack (7.0.7) lib/action_controller/metal/params_wrapper.rb:259:in `process_action'
activerecord (7.0.7) lib/active_record/railties/controller_runtime.rb:27:in `process_action'
actionpack (7.0.7) lib/abstract_controller/base.rb:151:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/mapper.rb:18:in `block in <class:Constraints>'
actionpack (7.0.7) lib/action_dispatch/routing/mapper.rb:48:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-29 16:21:22 +0300
Error occurred while parsing request parameters.
Contents:

"email": "markpaul@gmail.com",
"paswword": "markpaul"

Processing by DeviseTokenAuth::SessionsController#create as */*
Completed 400 Bad Request in 1ms (ActiveRecord: 0.0ms | Allocations: 124)


  
ActionDispatch::Http::Parameters::ParseError (Error occurred while parsing request parameters):
  
actionpack (7.0.7) lib/action_dispatch/http/parameters.rb:96:in `rescue in parse_formatted_parameters'
actionpack (7.0.7) lib/action_dispatch/http/parameters.rb:92:in `parse_formatted_parameters'
actionpack (7.0.7) lib/action_dispatch/http/request.rb:389:in `block in POST'
rack (2.2.8) lib/rack/request.rb:69:in `fetch'
rack (2.2.8) lib/rack/request.rb:69:in `fetch_header'
actionpack (7.0.7) lib/action_dispatch/http/request.rb:388:in `POST'
actionpack (7.0.7) lib/action_dispatch/http/parameters.rb:55:in `parameters'
actionpack (7.0.7) lib/action_controller/metal/strong_parameters.rb:1209:in `params'
devise_token_auth (1.2.2) app/controllers/devise_token_auth/sessions_controller.rb:130:in `resource_params'
devise_token_auth (1.2.2) app/controllers/devise_token_auth/sessions_controller.rb:14:in `create'
actionpack (7.0.7) lib/action_controller/metal/basic_implicit_render.rb:6:in `send_action'
actionpack (7.0.7) lib/abstract_controller/base.rb:215:in `process_action'
actionpack (7.0.7) lib/action_controller/metal/rendering.rb:165:in `process_action'
actionpack (7.0.7) lib/abstract_controller/callbacks.rb:234:in `block in process_action'
activesupport (7.0.7) lib/active_support/callbacks.rb:107:in `run_callbacks'
actionpack (7.0.7) lib/abstract_controller/callbacks.rb:233:in `process_action'
actionpack (7.0.7) lib/action_controller/metal/rescue.rb:23:in `process_action'
actionpack (7.0.7) lib/action_controller/metal/instrumentation.rb:67:in `block in process_action'
activesupport (7.0.7) lib/active_support/notifications.rb:206:in `block in instrument'
activesupport (7.0.7) lib/active_support/notifications/instrumenter.rb:24:in `instrument'
activesupport (7.0.7) lib/active_support/notifications.rb:206:in `instrument'
actionpack (7.0.7) lib/action_controller/metal/instrumentation.rb:66:in `process_action'
actionpack (7.0.7) lib/action_controller/metal/params_wrapper.rb:259:in `process_action'
activerecord (7.0.7) lib/active_record/railties/controller_runtime.rb:27:in `process_action'
actionpack (7.0.7) lib/abstract_controller/base.rb:151:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/mapper.rb:18:in `block in <class:Constraints>'
actionpack (7.0.7) lib/action_dispatch/routing/mapper.rb:48:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-29 16:22:15 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "paswword"=>"markpaul"}
[31mUnpermitted parameter: :paswword. Context: { controller: DeviseTokenAuth::SessionsController, action: create, request: #<ActionDispatch::Request:0x00007ffa193876b8>, params: {"email"=>"markpaul@gmail.com", "paswword"=>"markpaul", "controller"=>"devise_token_auth/sessions", "action"=>"create"} }[0m
[31mUnpermitted parameter: :paswword. Context: { controller: DeviseTokenAuth::SessionsController, action: create, request: #<ActionDispatch::Request:0x00007ffa193876b8>, params: {"email"=>"markpaul@gmail.com", "paswword"=>"markpaul", "controller"=>"devise_token_auth/sessions", "action"=>"create"} }[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
[31mUnpermitted parameter: :paswword. Context: { controller: DeviseTokenAuth::SessionsController, action: create, request: #<ActionDispatch::Request:0x00007ffa193876b8>, params: {"email"=>"markpaul@gmail.com", "paswword"=>"markpaul", "controller"=>"devise_token_auth/sessions", "action"=>"create"} }[0m
Completed 401 Unauthorized in 10ms (Views: 0.5ms | ActiveRecord: 0.6ms | Allocations: 2250)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-29 16:22:31 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Update (0.7ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-29 13:22:32.001253"], ["id", 1]]
  [1m[36mTRANSACTION (14.8ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 307ms (Views: 0.3ms | ActiveRecord: 17.8ms | Allocations: 7273)


Started POST "/auth/sign_in" for 127.0.0.1 at 2023-10-29 16:49:32 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (1.1ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Update (1.3ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-29 13:49:32.744951"], ["id", 1]]
  [1m[36mTRANSACTION (14.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 364ms (Views: 0.4ms | ActiveRecord: 29.6ms | Allocations: 16061)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2023-10-29 16:59:46 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:21:in `create'
  [1m[36mUser Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:21:in `create'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/auth/registrations_controller.rb:21:in `create'
Completed 422 Unprocessable Entity in 2078ms (Views: 0.8ms | ActiveRecord: 11.5ms | Allocations: 986969)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[36mCart Load (0.7ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
Started POST "/create_product" for 127.0.0.1 at 2023-10-29 17:14:28 +0300
  
ActionController::RoutingError (No route matches [POST] "/create_product"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-10-29 17:15:43 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
ActionController::RoutingError (No route matches [POST] "/create_product"):
  
Started POST "/create_product" for 127.0.0.1 at 2023-10-29 17:21:20 +0300
  
ActionController::RoutingError (No route matches [POST] "/create_product"):
  
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-10-29 17:22:00 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New product", "description"=>"the new products", "price"=>"30.50$", "size"=>"Medium", "stock_quantity"=>"2", "brand"=>"thrifted", "color"=>"Red", "category_id"=>1}}
Filter chain halted as :require_admin rendered or redirected
Completed 401 Unauthorized in 1ms (Views: 0.5ms | ActiveRecord: 0.0ms | Allocations: 505)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2023-10-29 17:22:25 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New product", "description"=>"the new products", "price"=>"30.50$", "size"=>"Medium", "stock_quantity"=>"2", "brand"=>"thrifted", "color"=>"Red", "category_id"=>1}}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
Filter chain halted as :require_admin rendered or redirected
Completed 401 Unauthorized in 229ms (Views: 0.4ms | ActiveRecord: 11.0ms | Allocations: 14642)


Started POST "/products/create_product" for 127.0.0.1 at 2023-10-29 17:25:25 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New product", "description"=>"the new products", "price"=>"30.50$", "size"=>"Medium", "stock_quantity"=>"2", "brand"=>"thrifted", "color"=>"Red", "category_id"=>1}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaul@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
Filter chain halted as :require_admin rendered or redirected
Completed 401 Unauthorized in 5ms (Views: 0.2ms | ActiveRecord: 0.4ms | Allocations: 1072)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.9ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5016.2ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (358.9ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (155.7ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (86.4ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (87.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to DeviseTokenAuthCreateUsers (20230819204134)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (75.4ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "provider" character varying DEFAULT 'email' NOT NULL, "uid" character varying DEFAULT '' NOT NULL, "encrypted_password" character varying DEFAULT '' NOT NULL, "reset_password_token" character varying, "reset_password_sent_at" timestamp(6), "allow_password_change" boolean DEFAULT FALSE, "remember_created_at" timestamp(6), "confirmation_token" character varying, "confirmed_at" timestamp(6), "confirmation_sent_at" timestamp(6), "unconfirmed_email" character varying, "name" character varying, "nickname" character varying, "image" character varying, "email" character varying, "tokens" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (39.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (39.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_uid_and_provider" ON "users" ("uid", "provider")[0m
  [1m[35m (40.4ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (23.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_confirmation_token" ON "users" ("confirmation_token")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230819204134"]]
  [1m[36mTRANSACTION (17.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddRoleToUsers (20230821020342)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "users" ADD "role" integer[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821020342"]]
  [1m[36mTRANSACTION (9.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePosts (20230821021958)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (72.9ms)[0m  [1m[35mCREATE TABLE "posts" ("id" bigserial primary key, "title" character varying, "content" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821021958"]]
  [1m[36mTRANSACTION (16.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateActiveStorageTables (20230821023831)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (114.7ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL)[0m
  [1m[35m (40.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key")[0m
  [1m[35m (81.6ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (57.2ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id")[0m
  [1m[35m (57.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id")[0m
  [1m[35m (81.9ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (43.2ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821023831"]]
  [1m[36mTRANSACTION (6.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCategories (20230928093441)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (64.9ms)[0m  [1m[35mCREATE TABLE "categories" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093441"]]
  [1m[36mTRANSACTION (18.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrders (20230928093450)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (65.4ms)[0m  [1m[35mCREATE TABLE "orders" ("id" bigserial primary key, "user_id" bigint NOT NULL, "status" character varying, "total_amount" decimal, "shipping_address" text, "payment_details" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_f868b47f6a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (30.7ms)[0m  [1m[35mCREATE INDEX "index_orders_on_user_id" ON "orders" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093450"]]
  [1m[36mTRANSACTION (22.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (59.6ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (77.3ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[35m (38.3ms)[0m  [1m[35mCREATE INDEX "index_products_on_category_id" ON "products" ("category_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093423"]]
  [1m[36mTRANSACTION (15.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (59.6ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[35m (47.3ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_order_id" ON "order_items" ("order_id")[0m
  [1m[35m (39.9ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_product_id" ON "order_items" ("product_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093507"]]
  [1m[36mTRANSACTION (13.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCarts (20230928093648)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (35.6ms)[0m  [1m[35mCREATE TABLE "carts" ("id" bigserial primary key, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_ea59a35211"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (31.2ms)[0m  [1m[35mCREATE INDEX "index_carts_on_user_id" ON "carts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093648"]]
  [1m[36mTRANSACTION (13.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAddresses (20230928093657)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (84.4ms)[0m  [1m[35mCREATE TABLE "addresses" ("id" bigserial primary key, "user_id" bigint NOT NULL, "address_type" character varying, "street" character varying, "city" character varying, "state" character varying, "postal_code" character varying, "country" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_48c9e0c5a2"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (39.1ms)[0m  [1m[35mCREATE INDEX "index_addresses_on_user_id" ON "addresses" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093657"]]
  [1m[36mTRANSACTION (14.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateReceipts (20230928094034)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (36.4ms)[0m  [1m[35mCREATE TABLE "receipts" ("id" bigserial primary key, "order_id" bigint NOT NULL, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_de8c1572cc"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_b2d4d3fa14"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (31.6ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_order_id" ON "receipts" ("order_id")[0m
  [1m[35m (31.4ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_user_id" ON "receipts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928094034"]]
  [1m[36mTRANSACTION (22.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateBrands (20231002082120)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (70.3ms)[0m  [1m[35mCREATE TABLE "brands" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.7ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002082120"]]
  [1m[36mTRANSACTION (12.2ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCartReferenceToOrderItems (20231002130233)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "order_items" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (35.5ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_cart_id" ON "order_items" ("cart_id")[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "order_items" ADD CONSTRAINT "fk_rails_59f7f23852"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002130233"]]
  [1m[36mTRANSACTION (16.9ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCartReferenceToOrders (20231010093453)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" ORDER BY "carts"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "orders" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (54.2ms)[0m  [1m[35mCREATE INDEX "index_orders_on_cart_id" ON "orders" ("cart_id")[0m
  [1m[35m (2.2ms)[0m  [1m[35mALTER TABLE "orders" ADD CONSTRAINT "fk_rails_5cdf0e0ad4"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231010093453"]]
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (1.0ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "development"], ["created_at", "2023-10-29 14:29:20.265019"], ["updated_at", "2023-10-29 14:29:20.265019"]]
  [1m[36mTRANSACTION (10.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2023-10-29 17:30:19 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:21:in `create'
  [1m[36mUser Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:21:in `create'
  [1m[36mUser Create (1.1ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaul@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaul@gmail.com"], ["created_at", "2023-10-29 14:30:22.349437"], ["updated_at", "2023-10-29 14:30:22.349437"]]
  ↳ app/controllers/auth/registrations_controller.rb:21:in `create'
  [1m[36mTRANSACTION (5.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:21:in `create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:24:in `block in create'
  [1m[36mCart Create (1.2ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 1], ["created_at", "2023-10-29 14:30:22.398669"], ["updated_at", "2023-10-29 14:30:22.398669"]]
  ↳ app/controllers/auth/registrations_controller.rb:24:in `block in create'
  [1m[36mTRANSACTION (5.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:24:in `block in create'
Completed 500 Internal Server Error in 2584ms (ActiveRecord: 30.4ms | Allocations: 996412)


  
ActiveModel::UnknownAttributeError (unknown attribute 'admin' for User.

          raise UnknownAttributeError.new(self, k.to_s)
          ^^^^^):
  
app/controllers/auth/registrations_controller.rb:28:in `block in create'
app/controllers/auth/registrations_controller.rb:21:in `create'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2023-10-29 17:35:19 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
Completed 422 Unprocessable Entity in 2620ms (Views: 0.6ms | ActiveRecord: 13.3ms | Allocations: 986977)


Started POST "/auth" for 127.0.0.1 at 2023-10-29 17:35:34 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul1@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul1@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Create (1.1ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaul1@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaul1@gmail.com"], ["created_at", "2023-10-29 14:35:34.336038"], ["updated_at", "2023-10-29 14:35:34.336038"]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mTRANSACTION (16.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:42:in `block in create'
  [1m[36mCart Create (1.7ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 2], ["created_at", "2023-10-29 14:35:34.400659"], ["updated_at", "2023-10-29 14:35:34.400659"]]
  ↳ app/controllers/auth/registrations_controller.rb:42:in `block in create'
  [1m[36mTRANSACTION (9.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:42:in `block in create'
  [1m[36mUser Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  ↳ app/controllers/auth/registrations_controller.rb:45:in `block in create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Update (1.1ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2023-10-29 14:35:34.477611"], ["id", 2]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mTRANSACTION (6.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
Completed 200 OK in 382ms (Views: 0.4ms | ActiveRecord: 45.1ms | Allocations: 17106)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2023-10-29 17:43:03 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul1@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul1@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
Completed 422 Unprocessable Entity in 270ms (Views: 0.5ms | ActiveRecord: 14.9ms | Allocations: 6385)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2023-10-29 17:43:22 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul1@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul1@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
Completed 422 Unprocessable Entity in 2638ms (Views: 0.6ms | ActiveRecord: 12.1ms | Allocations: 986894)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (5007.3ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.5ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.4ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (339.0ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (135.4ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (1.7ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (155.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (104.3ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to DeviseTokenAuthCreateUsers (20230819204134)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (82.8ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "provider" character varying DEFAULT 'email' NOT NULL, "uid" character varying DEFAULT '' NOT NULL, "encrypted_password" character varying DEFAULT '' NOT NULL, "reset_password_token" character varying, "reset_password_sent_at" timestamp(6), "allow_password_change" boolean DEFAULT FALSE, "remember_created_at" timestamp(6), "confirmation_token" character varying, "confirmed_at" timestamp(6), "confirmation_sent_at" timestamp(6), "unconfirmed_email" character varying, "name" character varying, "nickname" character varying, "image" character varying, "email" character varying, "tokens" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (38.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (39.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_uid_and_provider" ON "users" ("uid", "provider")[0m
  [1m[35m (58.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (39.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_confirmation_token" ON "users" ("confirmation_token")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.9ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230819204134"]]
  [1m[36mTRANSACTION (20.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddRoleToUsers (20230821020342)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.5ms)[0m  [1m[35mALTER TABLE "users" ADD "role" integer[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821020342"]]
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePosts (20230821021958)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (108.8ms)[0m  [1m[35mCREATE TABLE "posts" ("id" bigserial primary key, "title" character varying, "content" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821021958"]]
  [1m[36mTRANSACTION (23.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateActiveStorageTables (20230821023831)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (76.9ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL)[0m
  [1m[35m (31.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key")[0m
  [1m[35m (64.9ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (48.4ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id")[0m
  [1m[35m (40.1ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id")[0m
  [1m[35m (64.6ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (31.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821023831"]]
  [1m[36mTRANSACTION (19.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCategories (20230928093441)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (105.0ms)[0m  [1m[35mCREATE TABLE "categories" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093441"]]
  [1m[36mTRANSACTION (17.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrders (20230928093450)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (96.9ms)[0m  [1m[35mCREATE TABLE "orders" ("id" bigserial primary key, "user_id" bigint NOT NULL, "status" character varying, "total_amount" decimal, "shipping_address" text, "payment_details" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_f868b47f6a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (39.6ms)[0m  [1m[35mCREATE INDEX "index_orders_on_user_id" ON "orders" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093450"]]
  [1m[36mTRANSACTION (17.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (90.4ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.6ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
  [1m[35m (0.4ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (106.4ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[35m (46.2ms)[0m  [1m[35mCREATE INDEX "index_products_on_category_id" ON "products" ("category_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093423"]]
  [1m[36mTRANSACTION (13.7ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (94.2ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[35m (72.7ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_order_id" ON "order_items" ("order_id")[0m
  [1m[35m (40.1ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_product_id" ON "order_items" ("product_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093507"]]
  [1m[36mTRANSACTION (13.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCarts (20230928093648)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (52.4ms)[0m  [1m[35mCREATE TABLE "carts" ("id" bigserial primary key, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_ea59a35211"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (40.6ms)[0m  [1m[35mCREATE INDEX "index_carts_on_user_id" ON "carts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093648"]]
  [1m[36mTRANSACTION (13.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAddresses (20230928093657)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (111.7ms)[0m  [1m[35mCREATE TABLE "addresses" ("id" bigserial primary key, "user_id" bigint NOT NULL, "address_type" character varying, "street" character varying, "city" character varying, "state" character varying, "postal_code" character varying, "country" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_48c9e0c5a2"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (31.9ms)[0m  [1m[35mCREATE INDEX "index_addresses_on_user_id" ON "addresses" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093657"]]
  [1m[36mTRANSACTION (13.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateReceipts (20230928094034)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (55.3ms)[0m  [1m[35mCREATE TABLE "receipts" ("id" bigserial primary key, "order_id" bigint NOT NULL, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_de8c1572cc"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_b2d4d3fa14"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (30.6ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_order_id" ON "receipts" ("order_id")[0m
  [1m[35m (58.1ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_user_id" ON "receipts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928094034"]]
  [1m[36mTRANSACTION (18.0ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateBrands (20231002082120)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (89.2ms)[0m  [1m[35mCREATE TABLE "brands" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002082120"]]
  [1m[36mTRANSACTION (17.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCartReferenceToOrderItems (20231002130233)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "order_items" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (53.2ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_cart_id" ON "order_items" ("cart_id")[0m
  [1m[35m (1.4ms)[0m  [1m[35mALTER TABLE "order_items" ADD CONSTRAINT "fk_rails_59f7f23852"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002130233"]]
  [1m[36mTRANSACTION (15.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCartReferenceToOrders (20231010093453)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" ORDER BY "carts"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.6ms)[0m  [1m[35mALTER TABLE "orders" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (45.2ms)[0m  [1m[35mCREATE INDEX "index_orders_on_cart_id" ON "orders" ("cart_id")[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "orders" ADD CONSTRAINT "fk_rails_5cdf0e0ad4"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (1.1ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231010093453"]]
  [1m[36mTRANSACTION (12.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.6ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "development"], ["created_at", "2023-10-29 14:54:05.191911"], ["updated_at", "2023-10-29 14:54:05.191911"]]
  [1m[36mTRANSACTION (5.5ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.7ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2023-10-29 17:54:35 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Create (1.7ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["uid", "markpaul@gmail.com"], ["encrypted_password", "[FILTERED]"], ["email", "markpaul@gmail.com"], ["created_at", "2023-10-29 14:54:37.663409"], ["updated_at", "2023-10-29 14:54:37.663409"]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mTRANSACTION (16.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:42:in `block in create'
  [1m[36mCart Create (1.7ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 1], ["created_at", "2023-10-29 14:54:37.720177"], ["updated_at", "2023-10-29 14:54:37.720177"]]
  ↳ app/controllers/auth/registrations_controller.rb:42:in `block in create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:42:in `block in create'
  [1m[36mUser Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  ↳ app/controllers/auth/registrations_controller.rb:45:in `block in create'
Completed 500 Internal Server Error in 2444ms (ActiveRecord: 45.6ms | Allocations: 1000195)


  
NameError (undefined local variable or method `user' for #<Auth::RegistrationsController:0x0000000000a370>

                  user.update(role: 'admin')
                  ^^^^
Did you mean?  super):
  
app/controllers/auth/registrations_controller.rb:46:in `block in create'
app/controllers/auth/registrations_controller.rb:39:in `create'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2023-10-29 17:58:34 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (1.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"email"=>"markpaul@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mUser Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaul@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/auth/registrations_controller.rb:39:in `create'
Completed 422 Unprocessable Entity in 2617ms (Views: 0.9ms | ActiveRecord: 13.0ms | Allocations: 986977)


>>>>>>> ceb27d7649c9a9e5a144205fa3b3a48970921d3f
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/auth/sign_in" for 127.0.0.1 at 2024-02-02 13:43:15 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Update (8.6ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 10:43:15.984870"], ["id", 1]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 362ms (Views: 0.2ms | ActiveRecord: 17.9ms | Allocations: 33373)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 13:43:35 +0300
  
AbstractController::ActionNotFound (The action 'add_to_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/auth/sign_in" for 127.0.0.1 at 2024-02-02 13:57:55 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.3ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Update (0.6ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 10:57:56.431930"], ["id", 1]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 346ms (Views: 0.3ms | ActiveRecord: 7.3ms | Allocations: 33437)


Started POST "/auth" for 127.0.0.1 at 2024-02-02 13:57:59 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"user"=>{"name"=>"markpaul mwenda", "email"=>"markpaulmuthaura@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
Completed 422 Unprocessable Entity in 1450ms (Views: 0.4ms | ActiveRecord: 10.7ms | Allocations: 725178)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 13:58:54 +0300
  
AbstractController::ActionNotFound (The action 'add_to_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/auth/sign_in" for 127.0.0.1 at 2024-02-02 13:59:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.6ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Update (0.4ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 10:59:55.129871"], ["id", 1]]
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 346ms (Views: 0.3ms | ActiveRecord: 14.5ms | Allocations: 33551)


Started POST "/auth" for 127.0.0.1 at 2024-02-02 14:00:11 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"user"=>{"name"=>"user1", "email"=>"user1@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "user1@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
Completed 422 Unprocessable Entity in 1337ms (Views: 0.2ms | ActiveRecord: 2.0ms | Allocations: 724413)


Started POST "/auth" for 127.0.0.1 at 2024-02-02 14:00:33 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"user"=>{"name"=>"user1", "email"=>"user1@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "user1@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mUser Create (1.0ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "name", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["uid", "user1@gmail.com"], ["encrypted_password", "[FILTERED]"], ["name", "user1"], ["email", "user1@gmail.com"], ["created_at", "2024-02-02 11:00:33.775984"], ["updated_at", "2024-02-02 11:00:33.775984"]]
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:40:in `block in create'
  [1m[36mCart Create (0.9ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 3], ["created_at", "2024-02-02 11:00:33.800808"], ["updated_at", "2024-02-02 11:00:33.800808"]]
  ↳ app/controllers/auth/registrations_controller.rb:40:in `block in create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:40:in `block in create'
  [1m[36mUser Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  ↳ app/controllers/auth/registrations_controller.rb:45:in `block in create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 11:00:33.867708"], ["id", 3]]
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:37:in `create'
Completed 200 OK in 343ms (Views: 0.5ms | ActiveRecord: 10.1ms | Allocations: 29139)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 14:01:02 +0300
  
AbstractController::ActionNotFound (The action 'add_to_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mProduct Load (8.8ms)[0m  [1m[34mSELECT "products".* FROM "products"[0m
Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:01:52 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
Filter chain halted as :require_admin rendered or redirected
Completed 401 Unauthorized in 0ms (Views: 0.2ms | ActiveRecord: 0.0ms | Allocations: 236)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:02:02 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
Filter chain halted as :require_admin rendered or redirected
Completed 401 Unauthorized in 94ms (Views: 0.2ms | ActiveRecord: 4.3ms | Allocations: 26215)


Started POST "/auth/sign_in" for 127.0.0.1 at 2024-02-02 14:02:11 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 11:02:11.791570"], ["id", 1]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 295ms (Views: 0.2ms | ActiveRecord: 3.5ms | Allocations: 9479)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:02:27 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
Filter chain halted as :require_admin rendered or redirected
Completed 401 Unauthorized in 64ms (Views: 0.2ms | ActiveRecord: 0.3ms | Allocations: 960)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:04:43 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
Filter chain halted as :require_admin rendered or redirected
Completed 401 Unauthorized in 84ms (Views: 0.2ms | ActiveRecord: 4.1ms | Allocations: 25872)


Started POST "/auth/sign_in" for 127.0.0.1 at 2024-02-02 14:33:29 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (1.0ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Update (0.6ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 11:33:30.218308"], ["id", 1]]
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 356ms (Views: 0.3ms | ActiveRecord: 16.9ms | Allocations: 17045)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Destroy (9.8ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.3ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mActiveRecord::SchemaMigration Pluck (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Pluck (0.1ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[35m (29.6ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
  [1m[35m (0.1ms)[0m  [1m[35mDROP DATABASE IF EXISTS "skyva_api"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (111.8ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
  [1m[35m (0.7ms)[0m  [1m[35mCREATE DATABASE "skyva_api" ENCODING = 'unicode'[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (13.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[35m (10.6ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to DeviseTokenAuthCreateUsers (20230819204134)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "provider" character varying DEFAULT 'email' NOT NULL, "uid" character varying DEFAULT '' NOT NULL, "encrypted_password" character varying DEFAULT '' NOT NULL, "reset_password_token" character varying, "reset_password_sent_at" timestamp(6), "allow_password_change" boolean DEFAULT FALSE, "remember_created_at" timestamp(6), "confirmation_token" character varying, "confirmed_at" timestamp(6), "confirmation_sent_at" timestamp(6), "unconfirmed_email" character varying, "name" character varying, "nickname" character varying, "image" character varying, "email" character varying, "tokens" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_uid_and_provider" ON "users" ("uid", "provider")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_reset_password_token" ON "users" ("reset_password_token")[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_confirmation_token" ON "users" ("confirmation_token")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230819204134"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddRoleToUsers (20230821020342)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "users" ADD "role" integer[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821020342"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreatePosts (20230821021958)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.4ms)[0m  [1m[35mCREATE TABLE "posts" ("id" bigserial primary key, "title" character varying, "content" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821021958"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateActiveStorageTables (20230821023831)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.2ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key")[0m
  [1m[35m (8.6ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id")[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id")[0m
  [1m[35m (8.6ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL, CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
)[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230821023831"]]
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.4ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.5ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateCategories (20230928093441)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.8ms)[0m  [1m[35mCREATE TABLE "categories" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093441"]]
  [1m[36mTRANSACTION (4.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrders (20230928093450)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (15.1ms)[0m  [1m[35mCREATE TABLE "orders" ("id" bigserial primary key, "user_id" bigint NOT NULL, "status" character varying, "total_amount" decimal, "shipping_address" text, "payment_details" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_f868b47f6a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE INDEX "index_orders_on_user_id" ON "orders" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.8ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093450"]]
  [1m[36mTRANSACTION (4.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (15.5ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[35m (0.1ms)[0m  [1m[34mSELECT pg_try_advisory_lock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
Migrating to CreateProducts (20230928093423)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.7ms)[0m  [1m[35mCREATE TABLE "products" ("id" bigserial primary key, "name" character varying, "description" text, "price" decimal, "size" character varying, "color" character varying, "brand" character varying, "stock_quantity" integer, "category_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_fb915499a4"
FOREIGN KEY ("category_id")
  REFERENCES "categories" ("id")
)[0m
  [1m[35m (3.9ms)[0m  [1m[35mCREATE INDEX "index_products_on_category_id" ON "products" ("category_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093423"]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateOrderItems (20230928093507)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.7ms)[0m  [1m[35mCREATE TABLE "order_items" ("id" bigserial primary key, "order_id" bigint NOT NULL, "product_id" bigint NOT NULL, "quantity" integer, "price" decimal, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_e3cb28f071"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_f1a29ddd47"
FOREIGN KEY ("product_id")
  REFERENCES "products" ("id")
)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_order_id" ON "order_items" ("order_id")[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_product_id" ON "order_items" ("product_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.5ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093507"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateCarts (20230928093648)
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE TABLE "carts" ("id" bigserial primary key, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_ea59a35211"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE INDEX "index_carts_on_user_id" ON "carts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093648"]]
  [1m[36mTRANSACTION (1.6ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateAddresses (20230928093657)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (8.6ms)[0m  [1m[35mCREATE TABLE "addresses" ("id" bigserial primary key, "user_id" bigint NOT NULL, "address_type" character varying, "street" character varying, "city" character varying, "state" character varying, "postal_code" character varying, "country" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_48c9e0c5a2"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE INDEX "index_addresses_on_user_id" ON "addresses" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928093657"]]
  [1m[36mTRANSACTION (1.8ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateReceipts (20230928094034)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "receipts" ("id" bigserial primary key, "order_id" bigint NOT NULL, "user_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, CONSTRAINT "fk_rails_de8c1572cc"
FOREIGN KEY ("order_id")
  REFERENCES "orders" ("id")
, CONSTRAINT "fk_rails_b2d4d3fa14"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
)[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_order_id" ON "receipts" ("order_id")[0m
  [1m[35m (3.8ms)[0m  [1m[35mCREATE INDEX "index_receipts_on_user_id" ON "receipts" ("user_id")[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20230928094034"]]
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to CreateBrands (20231002082120)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (7.4ms)[0m  [1m[35mCREATE TABLE "brands" ("id" bigserial primary key, "name" character varying, "description" text, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.6ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002082120"]]
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCartReferenceToOrderItems (20231002130233)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.4ms)[0m  [1m[35mALTER TABLE "order_items" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE INDEX "index_order_items_on_cart_id" ON "order_items" ("cart_id")[0m
  [1m[35m (0.8ms)[0m  [1m[35mALTER TABLE "order_items" ADD CONSTRAINT "fk_rails_59f7f23852"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231002130233"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddCartReferenceToOrders (20231010093453)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCart Load (0.1ms)[0m  [1m[34mSELECT "carts".* FROM "carts" ORDER BY "carts"."id" ASC LIMIT $1[0m  [["LIMIT", 1]]
  [1m[35m (0.2ms)[0m  [1m[35mALTER TABLE "orders" ADD "cart_id" bigint NOT NULL[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE INDEX "index_orders_on_cart_id" ON "orders" ("cart_id")[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "orders" ADD CONSTRAINT "fk_rails_5cdf0e0ad4"
FOREIGN KEY ("cart_id")
  REFERENCES "carts" ("id")
[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20231010093453"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
Migrating to AddAdminToUsers (20240129171916)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[35m (0.3ms)[0m  [1m[35mALTER TABLE "users" ADD "admin" boolean[0m
  [1m[36mActiveRecord::SchemaMigration Create (0.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" ("version") VALUES ($1) RETURNING "version"[0m  [["version", "20240129171916"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT "ar_internal_metadata".* FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 LIMIT $2[0m  [["key", "environment"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mActiveRecord::InternalMetadata Create (0.4ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "key"[0m  [["key", "environment"], ["value", "development"], ["created_at", "2024-02-02 11:40:41.677088"], ["updated_at", "2024-02-02 11:40:41.677088"]]
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  [1m[35m (0.3ms)[0m  [1m[34mSELECT pg_advisory_unlock(3422183495574815895)[0m
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.5ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Clothes"], ["description", "Clothing category"], ["created_at", "2024-02-02 11:41:01.151538"], ["updated_at", "2024-02-02 11:41:01.151538"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Shoes"], ["description", "Footwear category"], ["created_at", "2024-02-02 11:41:01.155662"], ["updated_at", "2024-02-02 11:41:01.155662"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Jewelry"], ["description", "Jewelry category"], ["created_at", "2024-02-02 11:41:01.158686"], ["updated_at", "2024-02-02 11:41:01.158686"]]
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.2ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Men"], ["description", "Men's clothing"], ["created_at", "2024-02-02 11:41:01.161365"], ["updated_at", "2024-02-02 11:41:01.161365"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mCategory Create (0.3ms)[0m  [1m[32mINSERT INTO "categories" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Women"], ["description", "Women's clothing"], ["created_at", "2024-02-02 11:41:01.171467"], ["updated_at", "2024-02-02 11:41:01.171467"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.5ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Harber, O'Hara and Roob"], ["description", "Accusamus tenetur reiciendis sint."], ["created_at", "2024-02-02 11:41:02.113185"], ["updated_at", "2024-02-02 11:41:02.113185"]]
  [1m[36mTRANSACTION (8.3ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.5ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Waters Group"], ["description", "Cum omnis quas maxime."], ["created_at", "2024-02-02 11:41:02.125070"], ["updated_at", "2024-02-02 11:41:02.125070"]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.3ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Swaniawski and Sons"], ["description", "Nostrum voluptas eveniet ad."], ["created_at", "2024-02-02 11:41:02.128878"], ["updated_at", "2024-02-02 11:41:02.128878"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.3ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Emmerich LLC"], ["description", "Eum quos nihil autem."], ["created_at", "2024-02-02 11:41:02.132494"], ["updated_at", "2024-02-02 11:41:02.132494"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  [1m[36mBrand Create (0.2ms)[0m  [1m[32mINSERT INTO "brands" ("name", "description", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["name", "Shields Inc"], ["description", "Adipisci nihil sed facilis."], ["created_at", "2024-02-02 11:41:02.136094"], ["updated_at", "2024-02-02 11:41:02.136094"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2024-02-02 14:43:18 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"user"=>{"name"=>"markpaul mwenda", "email"=>"markpaulmuthaura@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "name", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["uid", "markpaulmuthaura@gmail.com"], ["encrypted_password", "[FILTERED]"], ["name", "markpaul mwenda"], ["email", "markpaulmuthaura@gmail.com"], ["created_at", "2024-02-02 11:43:20.457912"], ["updated_at", "2024-02-02 11:43:20.457912"]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:6:in `block in create'
  [1m[36mCart Create (0.8ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 1], ["created_at", "2024-02-02 11:43:20.479714"], ["updated_at", "2024-02-02 11:43:20.479714"]]
  ↳ app/controllers/auth/registrations_controller.rb:6:in `block in create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:6:in `block in create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 11:43:20.547357"], ["id", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
Completed 200 OK in 1496ms (Views: 0.2ms | ActiveRecord: 16.0ms | Allocations: 774976)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/auth" for 127.0.0.1 at 2024-02-02 14:44:19 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"user"=>{"name"=>"markpaul mwenda", "email"=>"markpaulmuthaura2@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura2@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "name", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["encrypted_password", "[FILTERED]"], ["name", "markpaul mwenda"], ["email", "markpaulmuthaura2@gmail.com"], ["created_at", "2024-02-02 11:44:20.909541"], ["updated_at", "2024-02-02 11:44:20.909541"]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mTRANSACTION (8.8ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:6:in `block in create'
  [1m[36mCart Create (0.7ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 2], ["created_at", "2024-02-02 11:44:20.940661"], ["updated_at", "2024-02-02 11:44:20.940661"]]
  ↳ app/controllers/auth/registrations_controller.rb:6:in `block in create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:6:in `block in create'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mUser Update (0.3ms)[0m  [1m[33mUPDATE "users" SET "updated_at" = $1, "role" = $2, "admin" = $3 WHERE "users"."id" = $4[0m  [["updated_at", "2024-02-02 11:44:20.946106"], ["role", 1], ["admin", true], ["id", 2]]
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:10:in `block in create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Update (0.4ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 11:44:21.012525"], ["id", 2]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
Completed 200 OK in 1508ms (Views: 0.4ms | ActiveRecord: 21.9ms | Allocations: 776721)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:10 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:10.430763"], ["updated_at", "2024-02-02 11:45:10.430763"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 104ms (Views: 0.3ms | ActiveRecord: 7.5ms | Allocations: 27966)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:30 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:30.243301"], ["updated_at", "2024-02-02 11:45:30.243301"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 21ms (Views: 0.4ms | ActiveRecord: 10.4ms | Allocations: 4688)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:30 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:30.486501"], ["updated_at", "2024-02-02 11:45:30.486501"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.4ms | ActiveRecord: 10.0ms | Allocations: 4696)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:30 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (1.2ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:30.693678"], ["updated_at", "2024-02-02 11:45:30.693678"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 22ms (Views: 0.4ms | ActiveRecord: 11.2ms | Allocations: 4682)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:30 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:30.885773"], ["updated_at", "2024-02-02 11:45:30.885773"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 11ms (Views: 0.3ms | ActiveRecord: 2.5ms | Allocations: 4668)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:31 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:31.054874"], ["updated_at", "2024-02-02 11:45:31.054874"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.4ms | ActiveRecord: 10.1ms | Allocations: 4662)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:31 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:31.274671"], ["updated_at", "2024-02-02 11:45:31.274671"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 17ms (Views: 0.3ms | ActiveRecord: 9.8ms | Allocations: 4662)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:31 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.9ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:31.549321"], ["updated_at", "2024-02-02 11:45:31.549321"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 14ms (Views: 0.4ms | ActiveRecord: 3.0ms | Allocations: 4658)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:31 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.5ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:31.728294"], ["updated_at", "2024-02-02 11:45:31.728294"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.5ms | ActiveRecord: 10.1ms | Allocations: 4666)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:31 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:31.922493"], ["updated_at", "2024-02-02 11:45:31.922493"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.4ms | ActiveRecord: 10.0ms | Allocations: 4664)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:32 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:32.207270"], ["updated_at", "2024-02-02 11:45:32.207270"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.3ms | ActiveRecord: 9.9ms | Allocations: 4660)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:32 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.1ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:32.537512"], ["updated_at", "2024-02-02 11:45:32.537512"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.8ms | ActiveRecord: 9.8ms | Allocations: 4664)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:32 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.3ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:32.805812"], ["updated_at", "2024-02-02 11:45:32.805812"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 11ms (Views: 0.4ms | ActiveRecord: 2.2ms | Allocations: 4657)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:33 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:33.238939"], ["updated_at", "2024-02-02 11:45:33.238939"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.4ms | ActiveRecord: 10.5ms | Allocations: 4670)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:33 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:33.475934"], ["updated_at", "2024-02-02 11:45:33.475934"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.7ms | ActiveRecord: 10.4ms | Allocations: 4664)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:33 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:33.695644"], ["updated_at", "2024-02-02 11:45:33.695644"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.3ms | ActiveRecord: 9.7ms | Allocations: 4666)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:34 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.8ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:34.130339"], ["updated_at", "2024-02-02 11:45:34.130339"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.3ms | ActiveRecord: 10.1ms | Allocations: 4678)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:34 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.7ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:34.373493"], ["updated_at", "2024-02-02 11:45:34.373493"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 25ms (Views: 0.6ms | ActiveRecord: 10.7ms | Allocations: 4676)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:35 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:35.210421"], ["updated_at", "2024-02-02 11:45:35.210421"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 14ms (Views: 0.3ms | ActiveRecord: 2.9ms | Allocations: 4666)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:35 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:35.679605"], ["updated_at", "2024-02-02 11:45:35.679605"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.4ms | ActiveRecord: 10.2ms | Allocations: 4674)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:36 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:36.268299"], ["updated_at", "2024-02-02 11:45:36.268299"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 12ms (Views: 0.3ms | ActiveRecord: 2.7ms | Allocations: 4664)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:36 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:36.782760"], ["updated_at", "2024-02-02 11:45:36.782760"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 21ms (Views: 0.4ms | ActiveRecord: 10.7ms | Allocations: 4670)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:36 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:36.982212"], ["updated_at", "2024-02-02 11:45:36.982212"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 22ms (Views: 0.6ms | ActiveRecord: 10.6ms | Allocations: 4660)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:37 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:37.169621"], ["updated_at", "2024-02-02 11:45:37.169621"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.4ms | ActiveRecord: 9.8ms | Allocations: 4672)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:37 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:37.321324"], ["updated_at", "2024-02-02 11:45:37.321324"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 18ms (Views: 0.6ms | ActiveRecord: 9.8ms | Allocations: 4666)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:37 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:37.657055"], ["updated_at", "2024-02-02 11:45:37.657055"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 20ms (Views: 0.4ms | ActiveRecord: 10.1ms | Allocations: 4666)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:38 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.6ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:38.071844"], ["updated_at", "2024-02-02 11:45:38.071844"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.7ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.4ms | ActiveRecord: 10.0ms | Allocations: 4656)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:38 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.4ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:38.354617"], ["updated_at", "2024-02-02 11:45:38.354617"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 19ms (Views: 0.3ms | ActiveRecord: 9.9ms | Allocations: 4664)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:38 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.2ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:38.756026"], ["updated_at", "2024-02-02 11:45:38.756026"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 22ms (Views: 0.7ms | ActiveRecord: 10.0ms | Allocations: 4664)


Started POST "/create_product" for 127.0.0.1 at 2024-02-02 14:45:39 +0300
Processing by ProductsController#create as */*
  Parameters: {"product"=>{"name"=>"New Product", "description"=>"A description of the new product", "price"=>29.99, "size"=>"Medium", "stock_quantity"=>6, "brand"=>"LV", "color"=>"Blue", "category_id"=>2}}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "markpaulmuthaura2@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:42:in `require_admin'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mCategory Load (0.3ms)[0m  [1m[34mSELECT "categories".* FROM "categories" WHERE "categories"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mProduct Create (0.5ms)[0m  [1m[32mINSERT INTO "products" ("name", "description", "price", "size", "color", "brand", "stock_quantity", "category_id", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10) RETURNING "id"[0m  [["name", "New Product"], ["description", "A description of the new product"], ["price", "29.99"], ["size", "Medium"], ["color", "Blue"], ["brand", "LV"], ["stock_quantity", 6], ["category_id", 2], ["created_at", "2024-02-02 11:45:39.336824"], ["updated_at", "2024-02-02 11:45:39.336824"]]
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/products_controller.rb:10:in `create'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 201 Created in 24ms (Views: 0.6ms | ActiveRecord: 10.4ms | Allocations: 4658)


Started POST "/auth/sign_in" for 127.0.0.1 at 2024-02-02 14:46:13 +0300
Processing by DeviseTokenAuth::SessionsController#create as */*
  Parameters: {"email"=>"markpaulmuthaura2@gmail.com", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."email" = $1 AND "users"."provider" = $2 LIMIT $3[0m  [["email", "markpaulmuthaura2@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  [1m[36mUser Load (0.5ms)[0m  [1m[37mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2 FOR UPDATE[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Update (0.8ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 11:46:13.952349"], ["id", 2]]
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mCOMMIT[0m
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 ORDER BY "users"."id" ASC LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
Completed 200 OK in 320ms (Views: 0.2ms | ActiveRecord: 3.9ms | Allocations: 8114)


Started POST "/auth" for 127.0.0.1 at 2024-02-02 14:46:33 +0300
Processing by Auth::RegistrationsController#create as */*
  Parameters: {"user"=>{"name"=>"user1", "email"=>"user1@gmail.com", "password"=>"[FILTERED]", "password_confirmation"=>"[FILTERED]"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE LOWER("users"."email") = LOWER($1) AND "users"."provider" = $2 LIMIT $3[0m  [["email", "user1@gmail.com"], ["provider", "email"], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("uid", "encrypted_password", "name", "email", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["uid", "user1@gmail.com"], ["encrypted_password", "[FILTERED]"], ["name", "user1"], ["email", "user1@gmail.com"], ["created_at", "2024-02-02 11:46:34.120441"], ["updated_at", "2024-02-02 11:46:34.120441"]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mTRANSACTION (11.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:6:in `block in create'
  [1m[36mCart Create (0.6ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 3], ["created_at", "2024-02-02 11:46:34.134994"], ["updated_at", "2024-02-02 11:46:34.134994"]]
  ↳ app/controllers/auth/registrations_controller.rb:6:in `block in create'
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:6:in `block in create'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE "users" SET "tokens" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["tokens", "[FILTERED]"], ["updated_at", "2024-02-02 11:46:34.200752"], ["id", 3]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/auth/registrations_controller.rb:3:in `create'
Completed 200 OK in 314ms (Views: 0.2ms | ActiveRecord: 16.9ms | Allocations: 7444)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 14:47:09 +0300
  
AbstractController::ActionNotFound (The action 'add_to_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 14:49:37 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
  
AbstractController::ActionNotFound (The action 'add_to_cart' could not be found for CartsController):
  
actionpack (7.0.7) lib/abstract_controller/base.rb:146:in `process'
actionview (7.0.7) lib/action_view/rendering.rb:39:in `process'
actionpack (7.0.7) lib/action_controller/metal.rb:188:in `dispatch'
actionpack (7.0.7) lib/action_controller/metal.rb:251:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:49:in `dispatch'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:50:in `block in serve'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `each'
actionpack (7.0.7) lib/action_dispatch/journey/router.rb:32:in `serve'
actionpack (7.0.7) lib/action_dispatch/routing/route_set.rb:852:in `call'
rack (2.2.8) lib/rack/session/abstract/id.rb:266:in `context'
rack (2.2.8) lib/rack/session/abstract/id.rb:260:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/cookies.rb:704:in `call'
warden (1.2.9) lib/warden/manager.rb:36:in `block in call'
warden (1.2.9) lib/warden/manager.rb:34:in `catch'
warden (1.2.9) lib/warden/manager.rb:34:in `call'
rack (2.2.8) lib/rack/etag.rb:27:in `call'
rack (2.2.8) lib/rack/conditional_get.rb:40:in `call'
rack (2.2.8) lib/rack/head.rb:12:in `call'
activerecord (7.0.7) lib/active_record/migration.rb:603:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call'
activesupport (7.0.7) lib/active_support/callbacks.rb:99:in `run_callbacks'
actionpack (7.0.7) lib/action_dispatch/middleware/callbacks.rb:26:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/actionable_exceptions.rb:17:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/debug_exceptions.rb:28:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/show_exceptions.rb:29:in `call'
railties (7.0.7) lib/rails/rack/logger.rb:40:in `call_app'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `block in call'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `block in tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:37:in `tagged'
activesupport (7.0.7) lib/active_support/tagged_logging.rb:99:in `tagged'
railties (7.0.7) lib/rails/rack/logger.rb:25:in `call'
sprockets-rails (3.4.2) lib/sprockets/rails/quiet_assets.rb:13:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/remote_ip.rb:93:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/request_id.rb:26:in `call'
rack (2.2.8) lib/rack/runtime.rb:22:in `call'
activesupport (7.0.7) lib/active_support/cache/strategy/local_cache_middleware.rb:29:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:61:in `block in call'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:26:in `collect_events'
actionpack (7.0.7) lib/action_dispatch/middleware/server_timing.rb:60:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/executor.rb:14:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/static.rb:23:in `call'
rack (2.2.8) lib/rack/sendfile.rb:110:in `call'
actionpack (7.0.7) lib/action_dispatch/middleware/host_authorization.rb:137:in `call'
rack-cors (2.0.1) lib/rack/cors.rb:102:in `call'
railties (7.0.7) lib/rails/engine.rb:530:in `call'
puma (5.6.7) lib/puma/configuration.rb:252:in `call'
puma (5.6.7) lib/puma/request.rb:77:in `block in handle_request'
puma (5.6.7) lib/puma/thread_pool.rb:340:in `with_force_shutdown'
puma (5.6.7) lib/puma/request.rb:76:in `handle_request'
puma (5.6.7) lib/puma/server.rb:443:in `process_client'
puma (5.6.7) lib/puma/thread_pool.rb:147:in `block in spawn_thread'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 14:52:57 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:18:in `add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:23:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1345ms (Views: 0.2ms | ActiveRecord: 14.7ms | Allocations: 833250)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 14:57:20 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
  
NameError (undefined local variable or method `current_cart' for CartsController:Class):
  
app/controllers/carts_controller.rb:25:in `block in <class:CartsController>'
app/controllers/carts_controller.rb:4:in `<class:CartsController>'
app/controllers/carts_controller.rb:1:in `<top (required)>'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 14:58:57 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:25:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:33:in `add_to_cart'
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:46:in `block in add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:46:in `block in add_to_cart'
  [1m[36mOrderItem Create (0.9ms)[0m  [1m[32mINSERT INTO "order_items" ("product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["product_id", 1], ["quantity", 2], ["created_at", "2024-02-02 11:58:58.022076"], ["updated_at", "2024-02-02 11:58:58.022076"], ["cart_id", 3]]
  ↳ app/controllers/carts_controller.rb:52:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:44:in `add_to_cart'
Completed 500 Internal Server Error in 168ms (ActiveRecord: 15.4ms | Allocations: 112852)


  
ActiveRecord::NotNullViolation (PG::NotNullViolation: ERROR:  null value in column "order_id" violates not-null constraint
DETAIL:  Failing row contains (1, null, 1, 2, null, 2024-02-02 11:58:58.022076, 2024-02-02 11:58:58.022076, 3).
):
  
app/controllers/carts_controller.rb:52:in `block in add_to_cart'
app/controllers/carts_controller.rb:44:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:00:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
  
NameError (undefined local variable or method `current_cart' for CartsController:Class):
  
app/controllers/carts_controller.rb:22:in `block (2 levels) in <class:CartsController>'
app/controllers/carts_controller.rb:20:in `block in <class:CartsController>'
app/controllers/carts_controller.rb:4:in `<class:CartsController>'
app/controllers/carts_controller.rb:1:in `<top (required)>'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:07:04 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
  
NameError (undefined local variable or method `current_cart' for CartsController:Class):
  
app/controllers/carts_controller.rb:22:in `block (2 levels) in <class:CartsController>'
app/controllers/carts_controller.rb:20:in `block in <class:CartsController>'
app/controllers/carts_controller.rb:4:in `<class:CartsController>'
app/controllers/carts_controller.rb:1:in `<top (required)>'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:13:16 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
Completed 500 Internal Server Error in 127ms (ActiveRecord: 9.8ms | Allocations: 71703)


  
NameError (undefined local variable or method `current_cart' for #<CartsController:0x0000000000a9d8>
Did you mean?  @current_cart):
  
app/controllers/carts_controller.rb:29:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:26:40 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:29:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:29:in `add_to_cart'
  [1m[36mCart Create (0.6ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 3], ["created_at", "2024-02-02 12:26:40.798990"], ["updated_at", "2024-02-02 12:26:40.798990"]]
  ↳ app/controllers/carts_controller.rb:29:in `add_to_cart'
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:29:in `add_to_cart'
Completed 422 Unprocessable Entity in 130ms (ActiveRecord: 11.9ms | Allocations: 72509)


  
ActiveRecord::RecordNotSaved (Failed to remove the existing associated current_cart. The record failed to save after its foreign key was set to nil.):
  
app/controllers/carts_controller.rb:29:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:34:57 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (1.1ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.6ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:29:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:29:in `add_to_cart'
  [1m[36mCart Create (0.9ms)[0m  [1m[32mINSERT INTO "carts" ("user_id", "created_at", "updated_at") VALUES ($1, $2, $3) RETURNING "id"[0m  [["user_id", 3], ["created_at", "2024-02-02 12:34:57.649174"], ["updated_at", "2024-02-02 12:34:57.649174"]]
  ↳ app/controllers/carts_controller.rb:29:in `add_to_cart'
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:29:in `add_to_cart'
Completed 422 Unprocessable Entity in 127ms (ActiveRecord: 13.8ms | Allocations: 72513)


  
ActiveRecord::RecordNotSaved (Failed to remove the existing associated current_cart. The record failed to save after its foreign key was set to nil.):
  
app/controllers/carts_controller.rb:29:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:40:37 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mOrderItem Load (0.7ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:32:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:45:in `block in add_to_cart'
  [1m[36mOrder Load (0.6ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:45:in `block in add_to_cart'
  [1m[36mOrderItem Create (0.9ms)[0m  [1m[32mINSERT INTO "order_items" ("product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["product_id", 1], ["quantity", 2], ["created_at", "2024-02-02 12:40:37.601107"], ["updated_at", "2024-02-02 12:40:37.601107"], ["cart_id", 3]]
  ↳ app/controllers/carts_controller.rb:51:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:43:in `add_to_cart'
Completed 500 Internal Server Error in 164ms (ActiveRecord: 15.3ms | Allocations: 112594)


  
ActiveRecord::NotNullViolation (PG::NotNullViolation: ERROR:  null value in column "order_id" violates not-null constraint
DETAIL:  Failing row contains (2, null, 1, 2, null, 2024-02-02 12:40:37.601107, 2024-02-02 12:40:37.601107, 3).
):
  
app/controllers/carts_controller.rb:51:in `block in add_to_cart'
app/controllers/carts_controller.rb:43:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:45:03 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:32:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:45:in `block in add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:45:in `block in add_to_cart'
  [1m[36mOrderItem Create (0.7ms)[0m  [1m[32mINSERT INTO "order_items" ("product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["product_id", 1], ["quantity", 2], ["created_at", "2024-02-02 12:45:03.732047"], ["updated_at", "2024-02-02 12:45:03.732047"], ["cart_id", 3]]
  ↳ app/controllers/carts_controller.rb:51:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:43:in `add_to_cart'
Completed 500 Internal Server Error in 158ms (ActiveRecord: 15.1ms | Allocations: 112595)


  
ActiveRecord::NotNullViolation (PG::NotNullViolation: ERROR:  null value in column "order_id" violates not-null constraint
DETAIL:  Failing row contains (3, null, 1, 2, null, 2024-02-02 12:45:03.732047, 2024-02-02 12:45:03.732047, 3).
):
  
app/controllers/carts_controller.rb:51:in `block in add_to_cart'
app/controllers/carts_controller.rb:43:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:45:52 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:32:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:45:in `block in add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:45:in `block in add_to_cart'
  [1m[36mOrderItem Create (0.6ms)[0m  [1m[32mINSERT INTO "order_items" ("product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["product_id", 1], ["quantity", 2], ["created_at", "2024-02-02 12:45:53.227802"], ["updated_at", "2024-02-02 12:45:53.227802"], ["cart_id", 3]]
  ↳ app/controllers/carts_controller.rb:51:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:43:in `add_to_cart'
Completed 500 Internal Server Error in 152ms (ActiveRecord: 14.4ms | Allocations: 112593)


  
ActiveRecord::NotNullViolation (PG::NotNullViolation: ERROR:  null value in column "order_id" violates not-null constraint
DETAIL:  Failing row contains (4, null, 1, 2, null, 2024-02-02 12:45:53.227802, 2024-02-02 12:45:53.227802, 3).
):
  
app/controllers/carts_controller.rb:51:in `block in add_to_cart'
app/controllers/carts_controller.rb:43:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:47:09 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>1, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:22:in `add_to_cart'
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 1], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:32:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:45:in `block in add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:45:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:43:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 200 OK in 1236ms (Views: 0.2ms | ActiveRecord: 15.7ms | Allocations: 834041)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
  [1m[36mOrderItem Load (0.5ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
  [1m[36mCart Load (0.7ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:51:34 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:76:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:86:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:99:in `block in add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:99:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:97:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 204 No Content in 1200ms (ActiveRecord: 13.5ms | Allocations: 834552)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrder Load (0.7ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:54:58 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:76:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:86:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:99:in `block in add_to_cart'
  [1m[36mOrder Load (0.2ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:99:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:97:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 204 No Content in 1217ms (ActiveRecord: 13.1ms | Allocations: 834559)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:57:00 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:236: syntax error, unexpected `end', expecting end-of-input):
  
app/controllers/carts_controller.rb:236: syntax error, unexpected `end', expecting end-of-input
app/controllers/carts_controller.rb:236: syntax error, unexpected `end', expecting end-of-input
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:59:18 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:230: syntax error, unexpected end-of-input, expecting `end'):
  
app/controllers/carts_controller.rb:230: syntax error, unexpected end-of-input, expecting `end'
app/controllers/carts_controller.rb:230: syntax error, unexpected end-of-input, expecting `end'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 15:59:59 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:76:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:86:in `add_to_cart'
Completed 500 Internal Server Error in 133ms (ActiveRecord: 10.4ms | Allocations: 93960)


  
NameError (undefined local variable or method `order' for #<CartsController:0x0000000000a758>
Did you mean?  order_url):
  
app/controllers/carts_controller.rb:105:in `block in add_to_cart'
app/controllers/carts_controller.rb:101:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:01:38 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:76:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:86:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:97:in `add_to_cart'
No template found for CartsController#add_to_cart, rendering head :no_content
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 204 No Content in 1206ms (ActiveRecord: 14.6ms | Allocations: 833714)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:03:51 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.5ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:76:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:86:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:99:in `block in add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:99:in `block in add_to_cart'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:97:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:114:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:114:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:114:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 422 Unprocessable Entity in 1210ms (Views: 0.2ms | ActiveRecord: 14.7ms | Allocations: 837064)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:06:00 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:237: syntax error, unexpected end-of-input, expecting `end'):
  
app/controllers/carts_controller.rb:237: syntax error, unexpected end-of-input, expecting `end'
app/controllers/carts_controller.rb:237: syntax error, unexpected end-of-input, expecting `end'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:06:16 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:76:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:86:in `add_to_cart'
Starting transaction...
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:103:in `block in add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:103:in `block in add_to_cart'
Found or created order: #<Order id: nil, user_id: nil, status: "open", total_amount: nil, shipping_address: nil, payment_details: nil, created_at: nil, updated_at: nil, cart_id: 3>
Errors: ["User must exist"]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:99:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:123:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:123:in `add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:123:in `add_to_cart'
Completed 500 Internal Server Error in 1264ms (ActiveRecord: 14.5ms | Allocations: 836009)


  
ActiveRecord::Rollback (ActiveRecord::Rollback):
  
app/controllers/carts_controller.rb:127:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:11:42 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:79:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:89:in `add_to_cart'
Starting transaction...
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:106:in `block in add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."cart_id" = $1 AND "orders"."status" = $2 LIMIT $3[0m  [["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:106:in `block in add_to_cart'
Found or created order: #<Order id: nil, user_id: nil, status: "open", total_amount: nil, shipping_address: nil, payment_details: nil, created_at: nil, updated_at: nil, cart_id: 3>
Errors: ["User must exist"]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:102:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:126:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:126:in `add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:126:in `add_to_cart'
Completed 500 Internal Server Error in 1214ms (ActiveRecord: 13.4ms | Allocations: 836013)


  
ActiveRecord::Rollback (ActiveRecord::Rollback):
  
app/controllers/carts_controller.rb:130:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:16:51 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:79:in `add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:89:in `add_to_cart'
Starting transaction...
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:107:in `block in add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."user_id" = $1 AND "orders"."cart_id" = $2 AND "orders"."status" = $3 LIMIT $4[0m  [["user_id", 3], ["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:107:in `block in add_to_cart'
  [1m[36mOrder Create (1.0ms)[0m  [1m[32mINSERT INTO "orders" ("user_id", "status", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["user_id", 3], ["status", "open"], ["created_at", "2024-02-02 13:16:51.921362"], ["updated_at", "2024-02-02 13:16:51.921362"], ["cart_id", 3]]
  ↳ app/controllers/carts_controller.rb:107:in `block in add_to_cart'
Found or created order: #<Order id: 1, user_id: 3, status: "open", total_amount: nil, shipping_address: nil, payment_details: nil, created_at: "2024-02-02 13:16:51.921362000 +0000", updated_at: "2024-02-02 13:16:51.921362000 +0000", cart_id: 3>
Errors: ["Order must exist"]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:103:in `add_to_cart'
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:132:in `add_to_cart'
  [1m[36mOrder Create (0.8ms)[0m  [1m[32mINSERT INTO "orders" ("user_id", "status", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["user_id", 3], ["status", "open"], ["created_at", "2024-02-02 13:16:51.921362"], ["updated_at", "2024-02-02 13:16:51.921362"], ["cart_id", 3]]
  ↳ app/controllers/carts_controller.rb:132:in `add_to_cart'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:132:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:132:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:132:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:132:in `add_to_cart'
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 200 OK in 1261ms (Views: 0.2ms | ActiveRecord: 27.4ms | Allocations: 840222)


  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrderItem Load (0.6ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
  [1m[36mOrder Load (1.0ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
  [1m[36mCart Load (0.5ms)[0m  [1m[34mSELECT "carts".* FROM "carts"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:23:54 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:26:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:36:in `add_to_cart'
Starting transaction...
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:54:in `block in add_to_cart'
  [1m[36mOrder Load (0.5ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."user_id" = $1 AND "orders"."cart_id" = $2 AND "orders"."status" = $3 LIMIT $4[0m  [["user_id", 3], ["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:54:in `block in add_to_cart'
Found or created order: #<Order id: 2, user_id: 3, status: "open", total_amount: nil, shipping_address: nil, payment_details: nil, created_at: "2024-02-02 13:16:51.921362000 +0000", updated_at: "2024-02-02 13:16:51.921362000 +0000", cart_id: 3>
  [1m[36mCart Load (0.1ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:69:in `block in add_to_cart'
Errors: ["Order must exist"]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:50:in `add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:88:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:88:in `add_to_cart'
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:88:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 200 OK in 1210ms (Views: 0.2ms | ActiveRecord: 16.0ms | Allocations: 838179)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:26:57 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.4ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:26:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:38:in `add_to_cart'
Order Item created: #<OrderItem id: nil, order_id: nil, product_id: 2, quantity: 2, price: nil, created_at: nil, updated_at: nil, cart_id: 3>
Completed 500 Internal Server Error in 133ms (ActiveRecord: 11.1ms | Allocations: 94005)


  
NameError (undefined local variable or method `order' for #<CartsController:0x0000000000a758>
Did you mean?  order_url):
  
app/controllers/carts_controller.rb:52:in `add_to_cart'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:29:19 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:26:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:38:in `add_to_cart'
Order Item created: #<OrderItem id: nil, order_id: nil, product_id: 2, quantity: 2, price: nil, created_at: nil, updated_at: nil, cart_id: 3>
Completed 500 Internal Server Error in 135ms (ActiveRecord: 10.1ms | Allocations: 94010)


  
NameError (undefined local variable or method `order' for #<CartsController:0x0000000000a758>
Did you mean?  order_url):
  
app/controllers/carts_controller.rb:52:in `add_to_cart'
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:29:34 +0300
  
SyntaxError (/home/markpaul/projects/skyva-api/app/controllers/carts_controller.rb:128: syntax error, unexpected `end'):
  
app/controllers/carts_controller.rb:128: syntax error, unexpected `end'
app/controllers/carts_controller.rb:128: syntax error, unexpected `end'
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:30:01 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:79:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."cart_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["cart_id", 3], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:89:in `add_to_cart'
Starting transaction...
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:107:in `block in add_to_cart'
  [1m[36mOrder Load (0.3ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."user_id" = $1 AND "orders"."cart_id" = $2 AND "orders"."status" = $3 LIMIT $4[0m  [["user_id", 3], ["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:107:in `block in add_to_cart'
Found or created order: #<Order id: 2, user_id: 3, status: "open", total_amount: nil, shipping_address: nil, payment_details: nil, created_at: "2024-02-02 13:16:51.921362000 +0000", updated_at: "2024-02-02 13:16:51.921362000 +0000", cart_id: 3>
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:113:in `block in add_to_cart'
Errors: ["Order must exist"]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  ↳ app/controllers/carts_controller.rb:103:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:126:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:126:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:126:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 200 OK in 1220ms (Views: 0.2ms | ActiveRecord: 14.7ms | Allocations: 838196)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrder Load (1.0ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:36:32 +0300
  [1m[36mActiveRecord::SchemaMigration Pluck (0.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
DEPRECATION WARNING: Non-URL-safe CSRF tokens are deprecated. Use 6.1 defaults or above. (called from <top (required)> at /home/markpaul/projects/skyva-api/app/controllers/application_controller.rb:1)
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>2, "quantity"=>2, "id"=>"1"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."user_id" = $1 AND "orders"."cart_id" = $2 AND "orders"."status" = $3 LIMIT $4[0m  [["user_id", 3], ["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:151:in `add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 2], ["product_id", 2], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:154:in `add_to_cart'
Starting transaction...
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:169:in `block in add_to_cart'
  [1m[36mCart Load (0.1ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:169:in `block in add_to_cart'
  [1m[36mOrderItem Create (0.7ms)[0m  [1m[32mINSERT INTO "order_items" ("order_id", "product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["order_id", 2], ["product_id", 2], ["quantity", 2], ["created_at", "2024-02-02 13:36:33.012297"], ["updated_at", "2024-02-02 13:36:33.012297"], ["cart_id", 3]]
  ↳ app/controllers/carts_controller.rb:169:in `block in add_to_cart'
  [1m[36mTRANSACTION (8.6ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:165:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:181:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:181:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:181:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 200 OK in 174ms (Views: 0.2ms | ActiveRecord: 23.5ms | Allocations: 117542)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
  [1m[36mOrderItem Load (1.0ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items"[0m
  [1m[36mProduct Load (0.5ms)[0m  [1m[34mSELECT "products".* FROM "products"[0m
Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:43:00 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>9, "quantity"=>1, "id"=>"1"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.3ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 9], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."user_id" = $1 AND "orders"."cart_id" = $2 AND "orders"."status" = $3 LIMIT $4[0m  [["user_id", 3], ["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:151:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 2], ["product_id", 9], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:154:in `add_to_cart'
Starting transaction...
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:169:in `block in add_to_cart'
  [1m[36mCart Load (0.1ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:169:in `block in add_to_cart'
  [1m[36mOrderItem Create (1.1ms)[0m  [1m[32mINSERT INTO "order_items" ("order_id", "product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["order_id", 2], ["product_id", 9], ["quantity", 1], ["created_at", "2024-02-02 13:43:00.335265"], ["updated_at", "2024-02-02 13:43:00.335265"], ["cart_id", 3]]
  ↳ app/controllers/carts_controller.rb:169:in `block in add_to_cart'
  [1m[36mOrderItem Load (0.2ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1[0m  [["order_id", 2]]
  ↳ app/models/order.rb:8:in `calculate_total_amount'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/models/order.rb:8:in `block in calculate_total_amount'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 9], ["LIMIT", 1]]
  ↳ app/models/order.rb:8:in `block in calculate_total_amount'
  [1m[36mOrder Update (0.3ms)[0m  [1m[33mUPDATE "orders" SET "total_amount" = $1, "updated_at" = $2 WHERE "orders"."id" = $3[0m  [["total_amount", "89.97"], ["updated_at", "2024-02-02 13:43:00.343358"], ["id", 2]]
  ↳ app/models/order_item.rb:16:in `update_order_total_amount'
  [1m[36mTRANSACTION (8.4ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:165:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:181:in `add_to_cart'
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:181:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:181:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 200 OK in 123ms (Views: 0.3ms | ActiveRecord: 13.9ms | Allocations: 41770)


Started POST "/carts/1/add_to_cart" for 127.0.0.1 at 2024-02-02 16:43:15 +0300
Processing by CartsController#add_to_cart as */*
  Parameters: {"product_id"=>7, "quantity"=>1, "id"=>"1"}
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."uid" = $1 LIMIT $2[0m  [["uid", "user1@gmail.com"], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."user_id" = $1 LIMIT $2[0m  [["user_id", 3], ["LIMIT", 1]]
  ↳ app/controllers/application_controller.rb:14:in `set_current_cart'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 7], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:141:in `add_to_cart'
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders" WHERE "orders"."user_id" = $1 AND "orders"."cart_id" = $2 AND "orders"."status" = $3 LIMIT $4[0m  [["user_id", 3], ["cart_id", 3], ["status", "open"], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:151:in `add_to_cart'
  [1m[36mOrderItem Load (0.3ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1 AND "order_items"."product_id" = $2 LIMIT $3[0m  [["order_id", 2], ["product_id", 7], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:154:in `add_to_cart'
Starting transaction...
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:169:in `block in add_to_cart'
  [1m[36mCart Load (0.2ms)[0m  [1m[34mSELECT "carts".* FROM "carts" WHERE "carts"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:169:in `block in add_to_cart'
  [1m[36mOrderItem Create (0.5ms)[0m  [1m[32mINSERT INTO "order_items" ("order_id", "product_id", "quantity", "created_at", "updated_at", "cart_id") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["order_id", 2], ["product_id", 7], ["quantity", 1], ["created_at", "2024-02-02 13:43:15.271652"], ["updated_at", "2024-02-02 13:43:15.271652"], ["cart_id", 3]]
  ↳ app/controllers/carts_controller.rb:169:in `block in add_to_cart'
  [1m[36mOrderItem Load (0.4ms)[0m  [1m[34mSELECT "order_items".* FROM "order_items" WHERE "order_items"."order_id" = $1[0m  [["order_id", 2]]
  ↳ app/models/order.rb:8:in `calculate_total_amount'
  [1m[36mProduct Load (0.3ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  ↳ app/models/order.rb:8:in `block in calculate_total_amount'
  [1m[36mProduct Load (0.4ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 9], ["LIMIT", 1]]
  ↳ app/models/order.rb:8:in `block in calculate_total_amount'
  [1m[36mProduct Load (0.2ms)[0m  [1m[34mSELECT "products".* FROM "products" WHERE "products"."id" = $1 LIMIT $2[0m  [["id", 7], ["LIMIT", 1]]
  ↳ app/models/order.rb:8:in `block in calculate_total_amount'
  [1m[36mOrder Update (0.3ms)[0m  [1m[33mUPDATE "orders" SET "total_amount" = $1, "updated_at" = $2 WHERE "orders"."id" = $3[0m  [["total_amount", "119.96"], ["updated_at", "2024-02-02 13:43:15.279999"], ["id", 2]]
  ↳ app/models/order_item.rb:16:in `update_order_total_amount'
  [1m[36mTRANSACTION (8.5ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:165:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
  ↳ app/controllers/carts_controller.rb:181:in `add_to_cart'
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
  ↳ app/controllers/carts_controller.rb:181:in `add_to_cart'
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mCOMMIT[0m
  ↳ app/controllers/carts_controller.rb:181:in `add_to_cart'
  [1m[36mUser Load (0.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 3], ["LIMIT", 1]]
Completed 200 OK in 37ms (Views: 0.1ms | ActiveRecord: 13.3ms | Allocations: 12512)


DEPRECATION WARNING: Using legacy connection handling is deprecated. Please set
`legacy_connection_handling` to `false` in your application.

The new connection handling does not support `connection_handlers`
getter and setter.

Read more about how to migrate at: https://guides.rubyonrails.org/active_record_multiple_databases.html#migrate-to-the-new-connection-handling
 (called from <top (required)> at /home/markpaul/projects/skyva-api/app/models/user.rb:3)
  [1m[36mOrder Load (0.4ms)[0m  [1m[34mSELECT "orders".* FROM "orders"[0m
